const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-AgentTab.js","assets/chunk-xterm.js","assets/chunk-react-vendor.js"])))=>i.map(i=>d[i]);
import{r as Xt,a as Zt}from"./chunk-react-vendor.js";import{g as Dt}from"./chunk-xterm.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();var Ct={exports:{}},ut={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var It;function Ss(){if(It)return ut;It=1;var t=Xt(),s=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(l,x,c){var d,h={},g=null,j=null;c!==void 0&&(g=""+c),x.key!==void 0&&(g=""+x.key),x.ref!==void 0&&(j=x.ref);for(d in x)r.call(x,d)&&!o.hasOwnProperty(d)&&(h[d]=x[d]);if(l&&l.defaultProps)for(d in x=l.defaultProps,x)h[d]===void 0&&(h[d]=x[d]);return{$$typeof:s,type:l,key:g,ref:j,props:h,_owner:a.current}}return ut.Fragment=n,ut.jsx=i,ut.jsxs=i,ut}var Pt;function $s(){return Pt||(Pt=1,Ct.exports=Ss()),Ct.exports}var e=$s(),u=Xt();const ye=Dt(u);var bt={},kt;function Ts(){if(kt)return bt;kt=1;var t=Zt();return bt.createRoot=t.createRoot,bt.hydrateRoot=t.hydrateRoot,bt}var Es=Ts();const As=Dt(Es);function m(...t){return t.filter(Boolean).join(" ")}function _s({actors:t,activeTab:s,onTabChange:n,unreadChatCount:r,isDark:a,onAddAgent:o,canAddAgent:i=!0}){const l=u.useRef(null),x=u.useRef(null);return u.useEffect(()=>{if(x.current&&l.current){const c=l.current,d=x.current,h=c.getBoundingClientRect(),g=d.getBoundingClientRect();g.left<h.left?c.scrollLeft-=h.left-g.left+16:g.right>h.right&&(c.scrollLeft+=g.right-h.right+16)}},[s]),e.jsxs("div",{ref:l,className:m("flex items-center gap-1.5 px-3 py-1.5 overflow-x-auto border-b sticky top-0 z-10 backdrop-blur-md",a?"border-white/5 bg-slate-900/70":"border-black/5 bg-white/70"),style:{scrollbarWidth:"none",msOverflowStyle:"none"},role:"tablist","aria-label":"Navigation tabs",children:[e.jsxs("button",{ref:s==="chat"?x:null,onClick:()=>n("chat"),className:m("relative flex items-center gap-2 px-3 py-2 text-sm font-medium whitespace-nowrap transition-all rounded-lg",s==="chat"?a?"bg-white/10 text-white":"bg-black/5 text-gray-900":a?"text-slate-400 hover:text-slate-200 hover:bg-white/5":"text-gray-500 hover:text-gray-700 hover:bg-black/5"),role:"tab","aria-selected":s==="chat",children:[e.jsx("span",{children:"Chat"}),r>0&&e.jsx("span",{className:m("text-[10px] px-1.5 py-0.5 rounded-full font-bold",a?"bg-cyan-500/20 text-cyan-300":"bg-cyan-100 text-cyan-700"),children:r})]}),e.jsx("div",{className:`w-px h-4 flex-shrink-0 ${a?"bg-white/10":"bg-black/8"}`}),t.map(c=>{const d=s===c.id,h=c.running??c.enabled??!1;return e.jsxs("button",{ref:d?x:null,onClick:()=>n(c.id),className:m("relative flex items-center gap-2 px-3 py-2 text-sm font-medium whitespace-nowrap transition-all rounded-lg",d?a?"bg-white/10 text-white":"bg-black/5 text-gray-900":a?"text-slate-400 hover:text-slate-200 hover:bg-white/5":"text-gray-500 hover:text-gray-700 hover:bg-black/5"),role:"tab","aria-selected":d,children:[e.jsx("span",{className:m("w-2 h-2 rounded-full transition-all",h?"bg-emerald-500":a?"bg-slate-600":"bg-gray-300")}),e.jsx("span",{children:c.id}),c.role==="foreman"&&e.jsx("span",{className:m("text-[9px] px-1.5 py-0.5 rounded",a?"bg-amber-500/20 text-amber-400":"bg-amber-100 text-amber-600"),children:"F"}),(c.unread_count??0)>0&&e.jsx("span",{className:m("text-[10px] px-1.5 py-0.5 rounded-full font-bold",a?"bg-indigo-500/20 text-indigo-300":"bg-indigo-100 text-indigo-700"),children:c.unread_count})]},c.id)}),o&&e.jsxs("button",{onClick:o,disabled:!i,className:m("ml-1 flex items-center gap-1 rounded-lg px-2.5 py-1.5 text-xs font-medium transition-all disabled:opacity-30 whitespace-nowrap border",a?"border-white/10 text-slate-300 hover:bg-white/5":"border-black/10 text-gray-600 hover:bg-black/5"),title:t.length===0?"Add your first agent (foreman)":"Add agent","aria-label":"Add agent",children:[e.jsx("span",{className:"text-sm leading-none",children:"+"}),e.jsx("span",{className:"hidden sm:inline",children:"Add"})]})]})}function Rs({isOpen:t,isDark:s,maxFileMb:n}){return t?e.jsxs("div",{className:"fixed inset-0 z-[60]",children:[e.jsx("div",{className:m("absolute inset-0 backdrop-blur-sm",s?"bg-black/60":"bg-black/40"),"aria-hidden":"true"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-6",children:e.jsxs("div",{className:m("w-full max-w-sm rounded-2xl border px-6 py-5 text-center shadow-2xl",s?"bg-slate-900/90 border-slate-700 text-slate-100":"bg-white/90 border-gray-200 text-gray-900"),role:"dialog","aria-label":"Drop files to attach",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“Ž"}),e.jsx("div",{className:"text-sm font-semibold",children:"Drop files to attach"}),e.jsx("div",{className:m("text-xs mt-1",s?"text-slate-400":"text-gray-500"),children:"Added to the composer. Click Send when ready."}),e.jsxs("div",{className:m("text-[11px] mt-3",s?"text-slate-500":"text-gray-500"),children:["Max ",n,"MB per file."]})]})})]}):null}function De(t,s){return{ok:!1,error:{code:t,message:s}}}async function P(t,s){let n;try{n=await fetch(t,{...s,headers:{"content-type":"application/json",...(s==null?void 0:s.headers)||{}}})}catch(a){return De("NETWORK_ERROR",a instanceof Error?a.message:"Network request failed")}const r=await n.text();if(!r)return n.ok?{ok:!0,result:{}}:De("EMPTY_RESPONSE",`Server returned ${n.status} with empty body`);try{return JSON.parse(r)}catch{return De("PARSE_ERROR",`Invalid JSON response: ${r.slice(0,100)}`)}}async function es(t,s,n){let r;try{r=await fetch(t,{...n||{},method:(n==null?void 0:n.method)||"POST",body:s,headers:{...(n==null?void 0:n.headers)||{}}})}catch(o){return De("NETWORK_ERROR",o instanceof Error?o.message:"Network request failed")}const a=await r.text();if(!a)return r.ok?{ok:!0,result:{}}:De("EMPTY_RESPONSE",`Server returned ${r.status} with empty body`);try{return JSON.parse(a)}catch{return De("PARSE_ERROR",`Invalid JSON response: ${a.slice(0,100)}`)}}async function Ls(){return P("/api/v1/groups")}async function Ms(t){return P(`/api/v1/groups/${encodeURIComponent(t)}`)}async function Os(t,s=""){return P("/api/v1/groups",{method:"POST",body:JSON.stringify({title:t,topic:s,by:"user"})})}async function Is(t,s,n){return P(`/api/v1/groups/${encodeURIComponent(t)}`,{method:"PUT",body:JSON.stringify({title:s.trim(),topic:n.trim(),by:"user"})})}async function Ps(t){return P(`/api/v1/groups/${encodeURIComponent(t)}?confirm=${encodeURIComponent(t)}&by=user`,{method:"DELETE"})}async function ks(t,s){return P(`/api/v1/groups/${encodeURIComponent(t)}/attach`,{method:"POST",body:JSON.stringify({path:s,by:"user"})})}async function Bs(t){return P(`/api/v1/groups/${encodeURIComponent(t)}/start?by=user`,{method:"POST"})}async function Fs(t){return P(`/api/v1/groups/${encodeURIComponent(t)}/stop?by=user`,{method:"POST"})}async function Us(t,s){return P(`/api/v1/groups/${encodeURIComponent(t)}/state?state=${encodeURIComponent(s)}&by=user`,{method:"POST"})}async function zs(t,s=120){return P(`/api/v1/groups/${encodeURIComponent(t)}/ledger/tail?lines=${s}&with_read_status=true`)}async function _t(t){return P(`/api/v1/groups/${encodeURIComponent(t)}/actors?include_unread=true`)}async function Gs(t,s,n,r,a){return P(`/api/v1/groups/${encodeURIComponent(t)}/actors`,{method:"POST",body:JSON.stringify({actor_id:s,role:n,runner:"pty",runtime:r,command:a,env:{},default_scope_key:"",by:"user"})})}async function Ws(t,s,n,r,a){return P(`/api/v1/groups/${encodeURIComponent(t)}/actors/${encodeURIComponent(s)}`,{method:"POST",body:JSON.stringify({runtime:n,command:r.trim(),title:a.trim(),by:"user"})})}async function Js(t,s){return P(`/api/v1/groups/${encodeURIComponent(t)}/actors/${encodeURIComponent(s)}?by=user`,{method:"DELETE"})}async function qs(t,s){return P(`/api/v1/groups/${encodeURIComponent(t)}/actors/${encodeURIComponent(s)}/start`,{method:"POST"})}async function Vs(t,s){return P(`/api/v1/groups/${encodeURIComponent(t)}/actors/${encodeURIComponent(s)}/stop`,{method:"POST"})}async function Hs(t,s){return P(`/api/v1/groups/${encodeURIComponent(t)}/actors/${encodeURIComponent(s)}/restart?by=user`,{method:"POST"})}async function ts(t){return P(`/api/v1/groups/${encodeURIComponent(t)}/context`)}async function Ks(t,s){return P(`/api/v1/groups/${encodeURIComponent(t)}/context`,{method:"POST",body:JSON.stringify({ops:[{op:"vision.update",vision:s}],by:"user"})})}async function Ys(t,s){return P(`/api/v1/groups/${encodeURIComponent(t)}/context`,{method:"POST",body:JSON.stringify({ops:[{op:"sketch.update",sketch:s}],by:"user"})})}async function ss(t){return P(`/api/v1/groups/${encodeURIComponent(t)}/settings`)}async function Qs(t,s){return P(`/api/v1/groups/${encodeURIComponent(t)}/settings`,{method:"PUT",body:JSON.stringify({...s,by:"user"})})}async function rs(t,s,n=200){return P(`/api/v1/groups/${encodeURIComponent(t)}/inbox/${encodeURIComponent(s)}?by=user&limit=${n}`)}async function Xs(t,s,n){return P(`/api/v1/groups/${encodeURIComponent(t)}/inbox/${encodeURIComponent(s)}/read`,{method:"POST",body:JSON.stringify({event_id:n,by:"user"})})}async function Zs(t,s,n,r){if(r&&r.length>0){const a=new FormData;a.append("by","user"),a.append("text",s),a.append("to_json",JSON.stringify(n)),a.append("path","");for(const o of r)a.append("files",o);return es(`/api/v1/groups/${encodeURIComponent(t)}/send_upload`,a)}return P(`/api/v1/groups/${encodeURIComponent(t)}/send`,{method:"POST",body:JSON.stringify({text:s,by:"user",to:n,path:""})})}async function Ds(t,s,n,r,a){if(a&&a.length>0){const o=new FormData;o.append("by","user"),o.append("text",s),o.append("to_json",JSON.stringify(n)),o.append("reply_to",r);for(const i of a)o.append("files",i);return es(`/api/v1/groups/${encodeURIComponent(t)}/reply_upload`,o)}return P(`/api/v1/groups/${encodeURIComponent(t)}/reply`,{method:"POST",body:JSON.stringify({text:s,by:"user",to:n,reply_to:r})})}async function er(){return P("/api/v1/runtimes")}async function tr(){return P("/api/v1/fs/recent")}async function sr(t){return P(`/api/v1/fs/list?path=${encodeURIComponent(t)}`)}async function rr(t){return P(`/api/im/status?group_id=${encodeURIComponent(t)}`)}async function nr(t){return P(`/api/im/config?group_id=${encodeURIComponent(t)}`)}async function ar(t,s,n,r){return P("/api/im/set",{method:"POST",body:JSON.stringify({group_id:t,platform:s,bot_token_env:n,app_token_env:s==="slack"?r:void 0})})}async function lr(t){return P("/api/im/unset",{method:"POST",body:JSON.stringify({group_id:t})})}async function or(t){return P("/api/im/start",{method:"POST",body:JSON.stringify({group_id:t})})}async function ir(t){return P("/api/im/stop",{method:"POST",body:JSON.stringify({group_id:t})})}async function cr(){return P("/api/v1/observability")}async function dr(t,s){return P("/api/v1/observability",{method:"PUT",body:JSON.stringify({by:"user",developer_mode:t,log_level:s})})}async function xr(t){return P(`/api/v1/debug/snapshot?group_id=${encodeURIComponent(t)}`)}async function ur(t,s,n=8e3,r=!0,a=!0){const o=new URLSearchParams({actor_id:s,max_chars:String(n),strip_ansi:String(r),compact:String(a)});return P(`/api/v1/groups/${encodeURIComponent(t)}/terminal/tail?${o.toString()}`)}async function mr(t,s){return P(`/api/v1/groups/${encodeURIComponent(t)}/terminal/clear?actor_id=${encodeURIComponent(s)}`,{method:"POST"})}async function hr(t,s,n=200){const r=new URLSearchParams({component:t,group_id:s,lines:String(n)});return P(`/api/v1/debug/tail_logs?${r.toString()}`)}async function gr(t,s){return P("/api/v1/debug/clear_logs",{method:"POST",body:JSON.stringify({component:t,group_id:s,by:"user"})})}function br({isOpen:t,onClose:s,groupId:n,context:r,onUpdateVision:a,onUpdateSketch:o,busy:i,isDark:l}){var Ce;const[x,c]=u.useState(!1),[d,h]=u.useState(!1),[g,j]=u.useState(""),[N,y]=u.useState(""),[b,M]=u.useState(null),[v,f]=u.useState(!1),[T,k]=u.useState(""),[O,U]=u.useState(!1),[p,w]=u.useState(""),[E,S]=u.useState(!1),[z,J]=u.useState(!1),[A,R]=u.useState(!1),[B,q]=u.useState(""),V=u.useMemo(()=>{const C=b!=null&&b.path?String(b.path):"";return C||"PROJECT.md"},[b==null?void 0:b.path]),Y=u.useMemo(()=>`PROJECT.md updated. Please re-read and align. (${V})`,[V]);u.useEffect(()=>{if(!t||!n)return;let C=!1;return f(!0),k(""),U(!1),q(""),S(!1),(async()=>{var ce;const D=await P(`/api/v1/groups/${encodeURIComponent(n)}/project_md`);if(!C){if(!D.ok){M(null),k(((ce=D.error)==null?void 0:ce.message)||"Failed to load PROJECT.md"),f(!1);return}M(D.result),f(!1)}})(),()=>{C=!0}},[n,t]);const X=()=>{j((r==null?void 0:r.vision)||""),c(!0)},Q=async()=>{await a(g),c(!1)},oe=()=>{y((r==null?void 0:r.sketch)||""),h(!0)},ne=async()=>{await o(N),h(!1)},ie=()=>{w(b!=null&&b.content?String(b.content):""),k(""),U(!0)},we=async()=>{var C;if(n){f(!0),k(""),q("");try{const D=await P(`/api/v1/groups/${encodeURIComponent(n)}/project_md`,{method:"PUT",body:JSON.stringify({content:p,by:"user"})});if(!D.ok){k(((C=D.error)==null?void 0:C.message)||"Failed to save PROJECT.md");return}M(D.result),U(!1),J(!1),S(!0)}finally{f(!1)}}},xe=async()=>{var C;if(!n){S(!1);return}R(!0),q("");try{if(z){const D=await P(`/api/v1/groups/${encodeURIComponent(n)}/send`,{method:"POST",body:JSON.stringify({text:Y,by:"user",to:["@all"],path:""})});if(!D.ok){q(((C=D.error)==null?void 0:C.message)||"Failed to notify agents");return}}S(!1)}finally{R(!1)}};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-fade-in",children:[e.jsx("div",{className:l?"absolute inset-0 bg-black/60":"absolute inset-0 bg-black/40",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:`relative rounded-xl border shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col animate-scale-in ${l?"bg-slate-900 border-slate-700":"bg-white border-gray-200"}`,role:"dialog","aria-modal":"true","aria-labelledby":"context-modal-title",children:[e.jsxs("div",{className:`flex items-center justify-between px-5 py-4 border-b ${l?"border-slate-800":"border-gray-200"}`,children:[e.jsx("h2",{id:"context-modal-title",className:`text-lg font-semibold ${l?"text-slate-100":"text-gray-900"}`,children:"ðŸ“‹ Project Context"}),e.jsx("button",{onClick:s,className:`text-xl leading-none min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg transition-colors ${l?"text-slate-400 hover:text-slate-200 hover:bg-slate-800":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,"aria-label":"Close context modal",children:"Ã—"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:`text-sm font-medium ${l?"text-slate-300":"text-gray-700"}`,children:"PROJECT.md"}),e.jsx("div",{className:`text-[11px] truncate ${l?"text-slate-500":"text-gray-500"}`,title:V,children:v?"Loadingâ€¦":b!=null&&b.found?V:b!=null&&b.path?`Missing: ${b.path}`:"Missing"})]}),!O&&e.jsx("button",{onClick:ie,disabled:v||!n,className:`text-xs min-h-[36px] px-2 rounded transition-colors disabled:opacity-50 ${l?"text-slate-400 hover:text-slate-200":"text-gray-500 hover:text-gray-700"}`,children:b!=null&&b.found?"âœï¸ Edit":"ï¼‹ Create"})]}),T&&e.jsx("div",{className:`mb-2 text-xs rounded-lg border px-3 py-2 ${l?"border-rose-500/30 bg-rose-500/10 text-rose-300":"border-rose-300 bg-rose-50 text-rose-700"}`,children:T}),O?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:p,onChange:C=>w(C.target.value),className:`w-full h-64 px-3 py-2 border rounded-lg text-sm resize-none font-mono transition-colors ${l?"bg-slate-800 border-slate-700 text-slate-200 focus:border-slate-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,placeholder:"Write your project constitution hereâ€¦"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:we,disabled:v||!n,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white text-sm rounded-lg disabled:opacity-50 min-h-[44px] transition-colors",children:v?"Saving...":"Save"}),e.jsx("button",{onClick:()=>U(!1),disabled:v,className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors disabled:opacity-50 ${l?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Cancel"})]})]}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm whitespace-pre-wrap min-h-[60px] max-h-[220px] overflow-auto ${l?"bg-slate-800/50 text-slate-300":"bg-gray-50 text-gray-700"}`,children:b!=null&&b.found&&b.content?String(b.content):e.jsx("span",{className:l?"text-slate-500 italic":"text-gray-400 italic",children:"No PROJECT.md found"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:`text-sm font-medium ${l?"text-slate-300":"text-gray-700"}`,children:"Vision"}),!x&&e.jsx("button",{onClick:X,className:`text-xs min-h-[36px] px-2 rounded transition-colors ${l?"text-slate-400 hover:text-slate-200":"text-gray-500 hover:text-gray-700"}`,children:"âœï¸ Edit"})]}),x?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:g,onChange:C=>j(C.target.value),className:`w-full h-32 px-3 py-2 border rounded-lg text-sm resize-none transition-colors ${l?"bg-slate-800 border-slate-700 text-slate-200 focus:border-slate-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,placeholder:"Describe the project vision..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Q,disabled:i,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white text-sm rounded-lg disabled:opacity-50 min-h-[44px] transition-colors",children:i?"Saving...":"Save"}),e.jsx("button",{onClick:()=>c(!1),className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors ${l?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Cancel"})]})]}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm whitespace-pre-wrap min-h-[60px] ${l?"bg-slate-800/50 text-slate-300":"bg-gray-50 text-gray-700"}`,children:(r==null?void 0:r.vision)||e.jsx("span",{className:l?"text-slate-500 italic":"text-gray-400 italic",children:"No vision set"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:`text-sm font-medium ${l?"text-slate-300":"text-gray-700"}`,children:"Sketch"}),!d&&e.jsx("button",{onClick:oe,className:`text-xs min-h-[36px] px-2 rounded transition-colors ${l?"text-slate-400 hover:text-slate-200":"text-gray-500 hover:text-gray-700"}`,children:"âœï¸ Edit"})]}),d?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:N,onChange:C=>y(C.target.value),className:`w-full h-32 px-3 py-2 border rounded-lg text-sm resize-none transition-colors ${l?"bg-slate-800 border-slate-700 text-slate-200 focus:border-slate-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,placeholder:"Technical sketch or architecture notes..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ne,disabled:i,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white text-sm rounded-lg disabled:opacity-50 min-h-[44px] transition-colors",children:i?"Saving...":"Save"}),e.jsx("button",{onClick:()=>h(!1),className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors ${l?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Cancel"})]})]}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm whitespace-pre-wrap min-h-[60px] ${l?"bg-slate-800/50 text-slate-300":"bg-gray-50 text-gray-700"}`,children:(r==null?void 0:r.sketch)||e.jsx("span",{className:l?"text-slate-500 italic":"text-gray-400 italic",children:"No sketch set"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium mb-2 ${l?"text-slate-300":"text-gray-700"}`,children:"Milestones"}),r!=null&&r.milestones&&r.milestones.length>0?e.jsx("div",{className:"space-y-2",children:r.milestones.map(C=>e.jsxs("div",{className:`px-3 py-2 rounded-lg space-y-1 ${l?"bg-slate-800/50":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:m("text-[11px] px-1.5 py-0.5 rounded flex-shrink-0",l?"bg-slate-700 text-slate-300":"bg-gray-200 text-gray-700"),children:C.id}),e.jsx("span",{className:`text-sm font-medium min-w-0 truncate ${l?"text-slate-200":"text-gray-800"}`,children:C.name}),e.jsx("span",{className:m("text-[11px] px-2 py-0.5 rounded flex-shrink-0 ml-auto",C.status==="done"?l?"bg-emerald-900/50 text-emerald-300":"bg-emerald-100 text-emerald-700":C.status==="active"?l?"bg-blue-900/50 text-blue-300":"bg-blue-100 text-blue-700":l?"bg-slate-700 text-slate-400":"bg-gray-200 text-gray-600"),children:C.status||"pending"})]}),(C.started||C.completed)&&e.jsxs("div",{className:`text-[11px] ${l?"text-slate-500":"text-gray-500"}`,children:[C.started?`started ${C.started}`:"",C.started&&C.completed?" Â· ":"",C.completed?`completed ${C.completed}`:""]}),C.description&&e.jsx("div",{className:`text-xs whitespace-pre-wrap ${l?"text-slate-400":"text-gray-600"}`,children:C.description})]},C.id))}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No milestones"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium mb-2 ${l?"text-slate-300":"text-gray-700"}`,children:"Tasks"}),r!=null&&r.tasks_summary?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`px-3 py-2 rounded-lg text-xs ${l?"bg-slate-800/50 text-slate-300":"bg-gray-50 text-gray-700"}`,children:["total ",r.tasks_summary.total," Â· active ",r.tasks_summary.active," Â· planned ",r.tasks_summary.planned," Â· done ",r.tasks_summary.done]}),r.active_task?e.jsxs("div",{className:`px-3 py-2 rounded-lg ${l?"bg-slate-800/50":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:`text-[11px] px-1.5 py-0.5 rounded ${l?"bg-slate-700 text-slate-300":"bg-gray-200 text-gray-700"}`,children:r.active_task.id}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:`text-sm font-medium truncate ${l?"text-slate-200":"text-gray-800"}`,children:r.active_task.name}),r.active_task.goal&&e.jsx("div",{className:`text-xs mt-0.5 whitespace-pre-wrap ${l?"text-slate-400":"text-gray-600"}`,children:r.active_task.goal})]}),e.jsx("span",{className:m("text-[11px] px-2 py-0.5 rounded flex-shrink-0",r.active_task.status==="done"?l?"bg-emerald-900/50 text-emerald-300":"bg-emerald-100 text-emerald-700":r.active_task.status==="active"?l?"bg-blue-900/50 text-blue-300":"bg-blue-100 text-blue-700":l?"bg-slate-700 text-slate-400":"bg-gray-200 text-gray-600"),children:r.active_task.status||"planned"})]}),(r.active_task.assignee||r.active_task.milestone)&&e.jsxs("div",{className:`text-[11px] mt-1 ${l?"text-slate-500":"text-gray-500"}`,children:[r.active_task.milestone?`milestone ${r.active_task.milestone}`:"",r.active_task.milestone&&r.active_task.assignee?" Â· ":"",r.active_task.assignee?`assignee ${r.active_task.assignee}`:""]}),Array.isArray(r.active_task.steps)&&r.active_task.steps.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:r.active_task.steps.map(C=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:`text-[11px] px-1.5 py-0.5 rounded ${l?"bg-slate-700 text-slate-300":"bg-gray-200 text-gray-700"}`,children:C.id}),e.jsxs("div",{className:`text-xs flex-1 ${l?"text-slate-300":"text-gray-700"}`,children:[C.name,C.acceptance?e.jsx("div",{className:m("mt-0.5 whitespace-pre-wrap",l?"text-slate-500":"text-gray-500"),children:C.acceptance}):null]}),e.jsx("span",{className:`text-[11px] ${l?"text-slate-500":"text-gray-500"}`,children:C.status||""})]},C.id))})]}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No active task"})]}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No task summary"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium mb-2 ${l?"text-slate-300":"text-gray-700"}`,children:"Notes"}),r!=null&&r.notes&&r.notes.length>0?e.jsx("div",{className:"space-y-2",children:r.notes.map(C=>e.jsxs("div",{className:`px-3 py-2 rounded-lg ${l?"bg-slate-800/50":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${l?"bg-slate-700 text-slate-300":"bg-gray-200 text-gray-700"}`,children:C.id}),typeof C.ttl=="number"&&e.jsxs("span",{className:`text-[11px] ${l?"text-slate-500":"text-gray-500"}`,children:["ttl ",C.ttl]}),C.expiring?e.jsx("span",{className:`text-[11px] ${l?"text-amber-300":"text-amber-600"}`,children:"expiring"}):null]}),e.jsx("div",{className:`text-xs mt-1 whitespace-pre-wrap ${l?"text-slate-300":"text-gray-700"}`,children:C.content})]},C.id))}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No notes"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium mb-2 ${l?"text-slate-300":"text-gray-700"}`,children:"References"}),r!=null&&r.references&&r.references.length>0?e.jsx("div",{className:"space-y-2",children:r.references.map(C=>e.jsxs("div",{className:`px-3 py-2 rounded-lg ${l?"bg-slate-800/50":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${l?"bg-slate-700 text-slate-400":"bg-gray-200 text-gray-600"}`,children:C.id}),e.jsx("a",{href:C.url,target:"_blank",rel:"noopener noreferrer",className:`text-sm truncate hover:underline ${l?"text-blue-400":"text-blue-600"}`,title:C.url,children:C.url})]}),C.note?e.jsx("div",{className:`text-xs mt-1 whitespace-pre-wrap ${l?"text-slate-400":"text-gray-600"}`,children:C.note}):null]},C.id))}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No references"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium mb-2 ${l?"text-slate-300":"text-gray-700"}`,children:"Presence"}),(Ce=r==null?void 0:r.presence)!=null&&Ce.agents&&r.presence.agents.length>0?e.jsx("div",{className:"space-y-2",children:r.presence.agents.map(C=>e.jsxs("div",{className:`px-3 py-2 rounded-lg ${l?"bg-slate-800/50":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium ${l?"text-slate-200":"text-gray-800"}`,children:C.id}),C.updated_at?e.jsx("span",{className:`text-[11px] ml-auto ${l?"text-slate-500":"text-gray-500"}`,children:C.updated_at}):null]}),C.status?e.jsx("div",{className:`text-xs mt-1 whitespace-pre-wrap ${l?"text-slate-300":"text-gray-700"}`,children:C.status}):e.jsx("div",{className:`text-xs mt-1 italic ${l?"text-slate-500":"text-gray-500"}`,children:"No status"})]},C.id))}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No presence"})]})]})]}),E&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 animate-fade-in",children:[e.jsx("div",{className:l?"absolute inset-0 bg-black/70":"absolute inset-0 bg-black/50",onClick:()=>{A||S(!1)},"aria-hidden":"true"}),e.jsxs("div",{className:`relative w-full max-w-md rounded-xl border shadow-2xl p-4 ${l?"bg-slate-900 border-slate-700":"bg-white border-gray-200"}`,role:"dialog","aria-modal":"true","aria-label":"Project updated",children:[e.jsx("div",{className:`text-sm font-semibold ${l?"text-slate-100":"text-gray-900"}`,children:"PROJECT.md saved"}),e.jsx("div",{className:`text-xs mt-1 ${l?"text-slate-400":"text-gray-500"}`,children:V}),B&&e.jsx("div",{className:`mt-3 text-xs rounded-lg border px-3 py-2 ${l?"border-rose-500/30 bg-rose-500/10 text-rose-300":"border-rose-300 bg-rose-50 text-rose-700"}`,children:B}),e.jsxs("label",{className:`mt-3 flex items-center gap-2 text-sm ${l?"text-slate-200":"text-gray-800"}`,children:[e.jsx("input",{type:"checkbox",checked:z,onChange:C=>J(C.target.checked),disabled:A}),"Notify agents in chat (@all)"]}),e.jsx("div",{className:`mt-2 text-[11px] rounded-lg px-3 py-2 whitespace-pre-wrap ${l?"bg-slate-800/60 text-slate-300":"bg-gray-50 text-gray-700"}`,children:Y}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:xe,disabled:A,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded-lg disabled:opacity-50 min-h-[44px] transition-colors",children:A?"Working...":"Done"}),e.jsx("button",{onClick:()=>S(!1),disabled:A,className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors disabled:opacity-50 ${l?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Close"})]})]})]})]}):null}const te=t=>`w-full px-3 py-2.5 rounded-lg border text-sm min-h-[44px] transition-colors ${t?"bg-slate-800 border-slate-700 text-slate-200 focus:border-slate-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,de=t=>`block text-xs mb-1 ${t?"text-slate-400":"text-gray-500"}`,vt=t=>"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white text-sm rounded-lg disabled:opacity-50 min-h-[44px] transition-colors font-medium",Me=t=>`rounded-lg border p-3 ${t?"border-slate-800 bg-slate-950/30":"border-gray-200 bg-gray-50"}`,et=t=>`mt-2 p-2 rounded overflow-x-auto whitespace-pre text-[11px] ${t?"bg-slate-900 text-slate-200":"bg-white text-gray-800 border border-gray-200"}`;function pr({isDark:t,busy:s,nudgeSeconds:n,setNudgeSeconds:r,idleSeconds:a,setIdleSeconds:o,keepaliveSeconds:i,setKeepaliveSeconds:l,silenceSeconds:x,setSilenceSeconds:c,deliveryInterval:d,setDeliveryInterval:h,standupInterval:g,setStandupInterval:j,onSave:N}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Group Timing"}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-500"}`,children:"These settings apply to the current working group."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:de(t),children:"Nudge After (sec)"}),e.jsx("input",{type:"number",value:n,onChange:y=>r(Number(y.target.value)),className:te(t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:de(t),children:"Actor Idle (sec)"}),e.jsx("input",{type:"number",value:a,onChange:y=>o(Number(y.target.value)),className:te(t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:de(t),children:"Keepalive (sec)"}),e.jsx("input",{type:"number",value:i,onChange:y=>l(Number(y.target.value)),className:te(t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:de(t),children:"Silence (sec)"}),e.jsx("input",{type:"number",value:x,onChange:y=>c(Number(y.target.value)),className:te(t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:de(t),children:"Delivery Interval (sec)"}),e.jsx("input",{type:"number",value:d,onChange:y=>h(Number(y.target.value)),className:te(t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:de(t),children:"Standup Interval (sec)"}),e.jsx("input",{type:"number",value:g,onChange:y=>j(Number(y.target.value)),className:te(t)}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-400"}`,children:"Periodic review reminder (default 900 = 15 min)"})]})]}),e.jsx("button",{onClick:N,disabled:s,className:vt(),children:s?"Saving...":"Save Timing Settings"})]})}function fr({isDark:t,groupId:s,imStatus:n,imPlatform:r,setImPlatform:a,imBotTokenEnv:o,setImBotTokenEnv:i,imAppTokenEnv:l,setImAppTokenEnv:x,imBusy:c,onSaveConfig:d,onRemoveConfig:h,onStartBridge:g,onStopBridge:j}){const N=()=>{switch(r){case"telegram":return"Bot Token (token or env var)";case"slack":return"Bot Token (xoxb- or env var)";case"discord":return"Bot Token (token or env var)"}},y=()=>{switch(r){case"telegram":return"TELEGRAM_BOT_TOKEN (or 123456:ABC...)";case"slack":return"SLACK_BOT_TOKEN (or xoxb-...)";case"discord":return"DISCORD_BOT_TOKEN (or <token>)"}},b=()=>!(!o||r==="slack"&&!l);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"IM Bridge"}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-500"}`,children:"Connect this group to Telegram, Slack, or Discord."})]}),n&&e.jsxs("div",{className:Me(t),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${n.running?"bg-emerald-500":"bg-gray-400"}`}),e.jsx("span",{className:`text-sm ${t?"text-slate-300":"text-gray-700"}`,children:n.running?"Running":"Stopped"}),n.running&&n.pid&&e.jsxs("span",{className:`text-xs ${t?"text-slate-500":"text-gray-500"}`,children:["(PID: ",n.pid,")"]})]}),n.configured&&e.jsxs("div",{className:`text-xs mt-1 ${t?"text-slate-400":"text-gray-500"}`,children:["Platform: ",n.platform," â€¢ Subscribers: ",n.subscribers]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:de(t),children:"Platform"}),e.jsxs("select",{value:r,onChange:M=>a(M.target.value),className:te(t),children:[e.jsx("option",{value:"telegram",children:"Telegram"}),e.jsx("option",{value:"slack",children:"Slack"}),e.jsx("option",{value:"discord",children:"Discord"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:de(t),children:N()}),e.jsx("input",{type:"text",value:o,onChange:M=>i(M.target.value),placeholder:y(),className:`${te(t)} placeholder:${t?"text-slate-600":"text-gray-400"}`}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-400"}`,children:r==="slack"?"Paste xoxb-â€¦ token or an env var name; required for outbound messages.":"Paste the bot token or an env var name; required for bot authentication."})]}),r==="slack"&&e.jsxs("div",{children:[e.jsx("label",{className:de(t),children:"App Token (xapp- or env var)"}),e.jsx("input",{type:"text",value:l,onChange:M=>x(M.target.value),placeholder:"SLACK_APP_TOKEN (or xapp-...)",className:`${te(t)} placeholder:${t?"text-slate-600":"text-gray-400"}`}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-400"}`,children:"Optional; needed for inbound messages (Socket Mode)."})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:d,disabled:c||!b(),className:vt(),children:c?"Saving...":"Save Config"}),(n==null?void 0:n.configured)&&e.jsxs(e.Fragment,{children:[n.running?e.jsx("button",{onClick:j,disabled:c,className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors font-medium ${t?"bg-red-900/50 hover:bg-red-800/50 text-red-300":"bg-red-100 hover:bg-red-200 text-red-700"} disabled:opacity-50`,children:"Stop Bridge"}):e.jsx("button",{onClick:g,disabled:c,className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors font-medium ${t?"bg-blue-900/50 hover:bg-blue-800/50 text-blue-300":"bg-blue-100 hover:bg-blue-200 text-blue-700"} disabled:opacity-50`,children:"Start Bridge"}),e.jsx("button",{onClick:h,disabled:c,className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors font-medium ${t?"bg-slate-800 hover:bg-slate-700 text-slate-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"} disabled:opacity-50`,children:"Remove Config"})]})]}),e.jsxs("div",{className:`text-xs space-y-1 ${t?"text-slate-500":"text-gray-500"}`,children:[e.jsx("p",{children:"To use IM Bridge:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-0.5 ml-2",children:[e.jsx("li",{children:"Create a bot on your IM platform"}),e.jsx("li",{children:"Set the token(s) as environment variable(s)"}),e.jsx("li",{children:"Save the config and start the bridge"}),e.jsx("li",{children:"In your IM chat, send /subscribe to receive messages"})]})]})]})}function yr({isDark:t,busy:s,groupId:n,devActors:r,terminalVisibility:a,setTerminalVisibility:o,terminalNotifyTail:i,setTerminalNotifyTail:l,terminalNotifyLines:x,setTerminalNotifyLines:c,onSaveTranscriptSettings:d,tailActorId:h,setTailActorId:g,tailMaxChars:j,setTailMaxChars:N,tailStripAnsi:y,setTailStripAnsi:b,tailCompact:M,setTailCompact:v,tailText:f,tailHint:T,tailErr:k,tailBusy:O,tailCopyInfo:U,onLoadTail:p,onCopyTail:w,onClearTail:E}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Terminal transcript"}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-500"}`,children:"Readable tail for troubleshooting. User can always view; agent access is controlled by the policy below."})]}),e.jsxs("div",{className:Me(t),children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Policy"}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs mb-1 ${t?"text-slate-400":"text-gray-600"}`,children:"Visibility to agents"}),e.jsxs("select",{value:a,onChange:S=>{const z=S.target.value;(z==="off"||z==="foreman"||z==="all")&&o(z)},className:te(t),children:[e.jsx("option",{value:"off",children:"off (agents cannot read others)"}),e.jsx("option",{value:"foreman",children:"foreman (foreman can read peers)"}),e.jsx("option",{value:"all",children:"all (any agent can read others)"})]}),e.jsx("div",{className:`mt-1 text-[11px] ${t?"text-slate-500":"text-gray-600"}`,children:"Tip: This only affects agents. The Web UI user can always view transcripts."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:`inline-flex items-center gap-2 text-sm ${t?"text-slate-300":"text-gray-700"}`,children:[e.jsx("input",{type:"checkbox",checked:i,onChange:S=>l(S.target.checked),className:"h-4 w-4"}),"Include tail in idle notifications"]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs mb-1 ${t?"text-slate-400":"text-gray-600"}`,children:"Notification lines"}),e.jsx("input",{type:"number",value:x,min:1,max:80,onChange:S=>c(Number(S.target.value||20)),disabled:!i,className:`${te(t)} disabled:opacity-60`})]})]}),e.jsx("button",{onClick:d,disabled:s,className:vt(),children:s?"Saving...":"Save transcript settings"})]})]}),e.jsxs("div",{className:Me(t),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Tail viewer"}),e.jsx("div",{className:`text-xs mt-0.5 ${t?"text-slate-500":"text-gray-600"}`,children:"Best-effort transcript tail from the actor PTY ring buffer."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,disabled:!n||!h||O,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-800 hover:bg-slate-700 text-slate-200":"bg-white hover:bg-gray-50 text-gray-800 border border-gray-200"} disabled:opacity-50`,children:O?"Loading...":"Refresh"}),e.jsx("button",{onClick:()=>w(50),disabled:!f.trim(),className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-900 hover:bg-slate-800 text-slate-300 border border-slate-800":"bg-white hover:bg-gray-50 text-gray-700 border border-gray-200"} disabled:opacity-50`,children:"Copy last 50 lines"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2",children:[e.jsx("label",{className:`block text-xs ${t?"text-slate-400":"text-gray-600"}`,children:"Actor"}),e.jsxs("select",{value:h,onChange:S=>g(S.target.value),className:te(t),children:[r.map(S=>e.jsxs("option",{value:S.id,children:[S.id,S.role?` (${S.role})`:""]},S.id)),!r.length&&e.jsx("option",{value:"",children:"(no actors)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs mb-1 ${t?"text-slate-400":"text-gray-600"}`,children:"Max chars"}),e.jsx("input",{type:"number",value:j,min:1e3,max:2e5,onChange:S=>N(Number(S.target.value||8e3)),className:te(t)})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsx("button",{onClick:E,disabled:!n||!h||O,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-rose-900/30 hover:bg-rose-900/40 text-rose-200 border border-rose-900/30":"bg-rose-50 hover:bg-rose-100 text-rose-700 border border-rose-200"} disabled:opacity-50`,children:"Clear (truncate)"})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:`inline-flex items-center gap-2 text-sm ${t?"text-slate-300":"text-gray-700"}`,children:[e.jsx("input",{type:"checkbox",checked:y,onChange:S=>b(S.target.checked),className:"h-4 w-4"}),"Strip ANSI"]}),e.jsxs("label",{className:`inline-flex items-center gap-2 text-sm ${t?"text-slate-300":"text-gray-700"}`,children:[e.jsx("input",{type:"checkbox",checked:M,disabled:!y,onChange:S=>v(S.target.checked),className:"h-4 w-4"}),"Compact repeated frames"]})]})]}),!!U&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-emerald-300":"text-emerald-700"}`,children:U}),k&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-rose-300":"text-rose-600"}`,children:k}),T&&!k&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-slate-500":"text-gray-600"}`,children:T}),e.jsx("pre",{className:`${et(t)} max-h-[300px] overflow-y-auto`,children:e.jsx("code",{children:f||"â€”"})})]})]})}function vr({isDark:t}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Remote Access (Phone)"}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-500"}`,children:'Recommended for "anywhere access": use Cloudflare Tunnel or Tailscale. CCCC does not manage these for you yetâ€”this is a setup guide.'}),e.jsxs("div",{className:`mt-2 rounded-lg border px-3 py-2 text-[11px] ${t?"border-amber-500/30 bg-amber-500/10 text-amber-200":"border-amber-200 bg-amber-50 text-amber-800"}`,children:[e.jsx("div",{className:"font-medium",children:"Security note"}),e.jsxs("div",{className:"mt-1",children:["Treat the Web UI as ",e.jsx("span",{className:"font-medium",children:"high privilege"})," (it can control agents and access project files). Do not expose it to the public internet without access control (e.g., Cloudflare Access)."]})]})]}),e.jsxs("div",{className:Me(t),children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Cloudflare Tunnel (recommended)"}),e.jsx("div",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-600"}`,children:"Easiest for phone access: no VPN app required. Pair with Cloudflare Zero Trust Access for login protection."}),e.jsx("div",{className:`mt-3 text-xs font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Quick (temporary URL)"}),e.jsx("pre",{className:et(t),children:e.jsx("code",{children:`# Install cloudflared first, then:
cloudflared tunnel --url http://127.0.0.1:8848
# It will print a https://....trycloudflare.com URL`})}),e.jsx("div",{className:`mt-3 text-xs font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Stable (your domain)"}),e.jsx("pre",{className:et(t),children:e.jsx("code",{children:`# 1) Authenticate
cloudflared tunnel login

# 2) Create a named tunnel
cloudflared tunnel create cccc

# 3) Route DNS (replace with your hostname)
cloudflared tunnel route dns cccc cccc.example.com

# 4) Create ~/.cloudflared/config.yml (example):
# tunnel: <TUNNEL-UUID>
# credentials-file: /home/<you>/.cloudflared/<TUNNEL-UUID>.json
# ingress:
#   - hostname: cccc.example.com
#     service: http://127.0.0.1:8848
#   - service: http_status:404

# 5) Run
cloudflared tunnel run cccc`})}),e.jsx("div",{className:`mt-2 text-[11px] ${t?"text-slate-500":"text-gray-600"}`,children:'Tip: In Cloudflare Zero Trust â†’ Access â†’ Applications, create a "Self-hosted" app for your hostname to require login.'})]}),e.jsxs("div",{className:Me(t),children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Tailscale (VPN)"}),e.jsx("div",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-600"}`,children:"Strong option if you're okay installing Tailscale on your phone. You can keep CCCC bound to a private interface."}),e.jsx("pre",{className:et(t),children:e.jsx("code",{children:`# 1) Install Tailscale on the server + phone, then on the server:
tailscale up

# 2) Get your tailnet IP
TAILSCALE_IP=$(tailscale ip -4)

# 3) Bind Web UI to that IP (so it's only reachable via tailnet)
CCCC_WEB_HOST=$TAILSCALE_IP CCCC_WEB_PORT=8848 cccc

# 4) On phone browser:
# http://<TAILSCALE_IP>:8848/ui/`})})]}),e.jsx("div",{className:`text-xs ${t?"text-slate-500":"text-gray-500"}`,children:'Phone tip: On iOS/Android you can "Add to Home Screen" for an app-like launcher (PWA-style).'})]})}function jr({isDark:t,groupId:s,developerMode:n,setDeveloperMode:r,logLevel:a,setLogLevel:o,obsBusy:i,onSaveObservability:l,debugSnapshot:x,debugSnapshotErr:c,debugSnapshotBusy:d,onLoadDebugSnapshot:h,onClearDebugSnapshot:g,logComponent:j,setLogComponent:N,logLines:y,setLogLines:b,logText:M,logErr:v,logBusy:f,onLoadLogTail:T,onClearLogs:k}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Developer Mode (Global)"}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-500"}`,children:"These settings apply to the whole CCCC instance (daemon + Web). Use this only when debugging."}),e.jsxs("div",{className:`mt-2 rounded-lg border px-3 py-2 text-[11px] ${t?"border-amber-500/30 bg-amber-500/10 text-amber-200":"border-amber-200 bg-amber-50 text-amber-800"}`,children:[e.jsx("div",{className:"font-medium",children:"Warning"}),e.jsx("div",{className:"mt-1",children:"Developer mode enables verbose logs and extra diagnostics. Only enable it when you need it."})]})]}),e.jsxs("div",{className:Me(t),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Enable developer mode"}),e.jsx("div",{className:`text-xs mt-0.5 ${t?"text-slate-500":"text-gray-600"}`,children:"Enables debug snapshot and log tail tools."})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:n,onChange:O=>r(O.target.checked)}),e.jsx("div",{className:`w-11 h-6 rounded-full transition-colors ${n?t?"bg-emerald-600":"bg-emerald-500":t?"bg-slate-700":"bg-gray-300"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform mt-0.5 ${n?"translate-x-5":"translate-x-0.5"}`})})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:de(t),children:"Log level"}),e.jsxs("select",{value:a,onChange:O=>o(O.target.value==="DEBUG"?"DEBUG":"INFO"),className:te(t),children:[e.jsx("option",{value:"INFO",children:"INFO"}),e.jsx("option",{value:"DEBUG",children:"DEBUG"})]})]}),e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsx("button",{onClick:l,disabled:i,className:vt(),children:i?"Saving...":"Save Developer Settings"})})]}),e.jsxs("div",{className:Me(t),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Debug snapshot (this group)"}),e.jsx("div",{className:`text-xs mt-0.5 ${t?"text-slate-500":"text-gray-600"}`,children:"Shows daemon/actors state + delivery throttle summary (developer mode only)."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,disabled:!n||!s||d,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-800 hover:bg-slate-700 text-slate-200":"bg-white hover:bg-gray-50 text-gray-800 border border-gray-200"} disabled:opacity-50`,children:d?"Loading...":"Refresh"}),e.jsx("button",{onClick:g,disabled:d,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-900 hover:bg-slate-800 text-slate-300 border border-slate-800":"bg-white hover:bg-gray-50 text-gray-700 border border-gray-200"} disabled:opacity-50`,children:"Clear"})]})]}),!s&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-slate-500":"text-gray-600"}`,children:"Open Settings from an active group to view group-scoped debug info."}),c&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-rose-300":"text-rose-600"}`,children:c}),e.jsx("pre",{className:et(t),children:e.jsx("code",{children:x||"â€”"})})]}),e.jsxs("div",{className:Me(t),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Log tail"}),e.jsx("div",{className:`text-xs mt-0.5 ${t?"text-slate-500":"text-gray-600"}`,children:'Tails local log files (developer mode only). Component "im" is group-scoped.'})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:T,disabled:!n||f,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-800 hover:bg-slate-700 text-slate-200":"bg-white hover:bg-gray-50 text-gray-800 border border-gray-200"} disabled:opacity-50`,children:f?"Loading...":"Refresh"}),e.jsx("button",{onClick:k,disabled:!n||f,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-900 hover:bg-slate-800 text-slate-300 border border-slate-800":"bg-white hover:bg-gray-50 text-gray-700 border border-gray-200"} disabled:opacity-50`,children:"Clear (truncate)"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:de(t),children:"Component"}),e.jsxs("select",{value:j,onChange:O=>N(O.target.value==="im"?"im":O.target.value==="web"?"web":"daemon"),className:te(t),children:[e.jsx("option",{value:"daemon",children:"daemon"}),e.jsx("option",{value:"web",children:"web"}),e.jsx("option",{value:"im",children:"im"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:de(t),children:"Lines"}),e.jsx("input",{type:"number",value:y,min:50,max:2e3,onChange:O=>b(Number(O.target.value||200)),className:te(t)})]})]}),j==="im"&&!s&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-slate-500":"text-gray-600"}`,children:"IM logs require a group_id; open Settings from a group."}),v&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-rose-300":"text-rose-600"}`,children:v}),e.jsx("pre",{className:`${et(t)} max-h-[260px] overflow-y-auto`,children:e.jsx("code",{children:M||"â€”"})})]})]})}function Nr({isOpen:t,onClose:s,settings:n,onUpdateSettings:r,busy:a,isDark:o,groupId:i}){const[l,x]=u.useState(i?"group":"global"),[c,d]=u.useState("timing"),[h,g]=u.useState("remote"),[j,N]=u.useState(300),[y,b]=u.useState(600),[M,v]=u.useState(120),[f,T]=u.useState(600),[k,O]=u.useState(0),[U,p]=u.useState(900),[w,E]=u.useState("foreman"),[S,z]=u.useState(!1),[J,A]=u.useState(20),[R,B]=u.useState(""),[q,V]=u.useState(8e3),[Y,X]=u.useState(!0),[Q,oe]=u.useState(!0),[ne,ie]=u.useState(""),[we,xe]=u.useState(""),[Ce,C]=u.useState(""),[D,ce]=u.useState(!1),[We,re]=u.useState(""),[me,Je]=u.useState(null),[he,ve]=u.useState("telegram"),[qe,Se]=u.useState(""),[$e,Te]=u.useState(""),[Oe,ae]=u.useState(!1),[Ee,Ie]=u.useState(!1),[Ae,Ve]=u.useState("INFO"),[rt,He]=u.useState(!1),[nt,Ke]=u.useState([]),[at,_e]=u.useState(""),[lt,Re]=u.useState(""),[ot,Pe]=u.useState(!1),[ge,Ye]=u.useState("daemon"),[ke,it]=u.useState(200),[Qe,Le]=u.useState(""),[ct,ue]=u.useState(""),[Be,be]=u.useState(!1);u.useEffect(()=>{t&&n&&(N(n.nudge_after_seconds),b(n.actor_idle_timeout_seconds),v(n.keepalive_delay_seconds),T(n.silence_timeout_seconds),O(n.min_interval_seconds),p(n.standup_interval_seconds??900),E(n.terminal_transcript_visibility||"foreman"),z(!!n.terminal_transcript_notify_tail),A(Number(n.terminal_transcript_notify_lines||20)))},[t,n]),u.useEffect(()=>{t&&x(i?"group":"global")},[t,i]),u.useEffect(()=>{t&&i&&pe()},[t,i]),u.useEffect(()=>{t&&Fe()},[t]),u.useEffect(()=>{t&&i&&Ue()},[t,i]);const pe=async()=>{if(i)try{const _=await rr(i);_.ok&&(Je(_.result),_.result.platform&&ve(_.result.platform));const L=await nr(i);if(L.ok&&L.result.im){const K=L.result.im;K.platform&&ve(K.platform),Se(K.bot_token_env||K.token_env||K.token||""),Te(K.app_token_env||"")}}catch(_){console.error("Failed to load IM status:",_)}},Fe=async()=>{var _;try{const L=await cr();if(L.ok&&((_=L.result)!=null&&_.observability)){const K=L.result.observability;Ie(!!K.developer_mode);const le=String(K.log_level||"INFO").toUpperCase();Ve(le==="DEBUG"?"DEBUG":"INFO")}}catch{}},Ue=async()=>{var _;if(i)try{const L=await _t(i);if(L.ok&&((_=L.result)!=null&&_.actors)){const K=Array.isArray(L.result.actors)?L.result.actors:[];Ke(K),!R&&K.length>0&&B(K[0].id)}}catch{}},dt=async()=>{await r({nudge_after_seconds:j,actor_idle_timeout_seconds:y,keepalive_delay_seconds:M,silence_timeout_seconds:f,min_interval_seconds:k,standup_interval_seconds:U})},Z=async()=>{await r({terminal_transcript_visibility:w,terminal_transcript_notify_tail:S,terminal_transcript_notify_lines:J})},I=async _=>{const L=Math.max(1,Math.min(200,Number(_||0)||50)),K=String(ne||"");if(!K.trim())return;const le=K.split(`
`),xt=le.slice(Math.max(0,le.length-L)).join(`
`).trimEnd();if(!xt)return;const se=fe=>{re(fe),window.setTimeout(()=>re(""),1200)};try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(xt),se(`Copied last ${L} lines`);return}}catch{}try{const fe=document.createElement("textarea");fe.value=xt,fe.style.position="fixed",fe.style.left="-9999px",fe.style.top="0",document.body.appendChild(fe),fe.focus(),fe.select();const Cs=document.execCommand("copy");document.body.removeChild(fe),se(Cs?`Copied last ${L} lines`:"Copy failed")}catch{se("Copy failed")}},F=async()=>{var _,L,K;if(!(!i||!R)){ce(!0),C("");try{const le=await ur(i,R,q||8e3,Y,Q);le.ok?(ie(String(((_=le.result)==null?void 0:_.text)||"")),xe(String(((L=le.result)==null?void 0:L.hint)||""))):(ie(""),xe(""),C(((K=le.error)==null?void 0:K.message)||"Failed to load terminal transcript"))}catch{ie(""),xe(""),C("Failed to load terminal transcript")}finally{ce(!1)}}},W=async()=>{var _;if(!(!i||!R)){ce(!0),C("");try{const L=await mr(i,R);if(!L.ok){C(((_=L.error)==null?void 0:_.message)||"Failed to clear terminal transcript");return}ie(""),xe("")}catch{C("Failed to clear terminal transcript")}finally{ce(!1)}}},ee=async()=>{if(i){ae(!0);try{(await ar(i,he,qe,$e)).ok&&await pe()}catch(_){console.error("Failed to save IM config:",_)}finally{ae(!1)}}},ze=async()=>{if(i){ae(!0);try{(await lr(i)).ok&&(Se(""),Te(""),await pe())}catch(_){console.error("Failed to remove IM config:",_)}finally{ae(!1)}}},Xe=async()=>{if(i){ae(!0);try{await or(i),await pe()}catch(_){console.error("Failed to start bridge:",_)}finally{ae(!1)}}},je=async()=>{if(i){ae(!0);try{await ir(i),await pe()}catch(_){console.error("Failed to stop bridge:",_)}finally{ae(!1)}}},jt=async()=>{He(!0);try{(await dr(Ee,Ae)).ok&&await Fe()}catch{}finally{He(!1)}},Nt=async()=>{var _;if(i){Pe(!0),Re("");try{const L=await xr(i);L.ok?_e(JSON.stringify(L.result??{},null,2)):(_e(""),Re(((_=L.error)==null?void 0:_.message)||"Failed to load debug snapshot"))}catch{_e(""),Re("Failed to load debug snapshot")}finally{Pe(!1)}}},ht=async()=>{var _,L;be(!0),ue("");try{const K=await hr(ge,i||"",ke||200);if(K.ok){const le=Array.isArray((_=K.result)==null?void 0:_.lines)?K.result.lines:[];Le(le.join(`
`))}else Le(""),ue(((L=K.error)==null?void 0:L.message)||"Failed to tail logs")}catch{Le(""),ue("Failed to tail logs")}finally{be(!1)}},gt=async()=>{var _;if(Ee){if(ge==="im"&&!i){ue("IM logs require a group_id; open Settings from a group.");return}be(!0),ue("");try{const L=await gr(ge,i||"");if(!L.ok){ue(((_=L.error)==null?void 0:_.message)||"Failed to clear logs");return}Le("")}catch{ue("Failed to clear logs")}finally{be(!1)}}};if(!t)return null;const $=l==="group"?[{id:"timing",label:"Timing"},{id:"im",label:"IM Bridge"},{id:"transcript",label:"Transcript"}]:[{id:"remote",label:"Remote Access"},{id:"developer",label:"Developer"}],G=l==="group"?c:h,H=_=>{l==="group"?d(_):g(_)};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-fade-in",children:[e.jsx("div",{className:o?"absolute inset-0 bg-black/60":"absolute inset-0 bg-black/40",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:`relative rounded-xl border shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col animate-scale-in ${o?"bg-slate-900 border-slate-700":"bg-white border-gray-200"}`,role:"dialog","aria-modal":"true","aria-labelledby":"settings-modal-title",children:[e.jsxs("div",{className:`flex items-center justify-between px-5 py-4 border-b ${o?"border-slate-800":"border-gray-200"}`,children:[e.jsx("h2",{id:"settings-modal-title",className:`text-lg font-semibold ${o?"text-slate-100":"text-gray-900"}`,children:"âš™ï¸ Settings"}),e.jsx("button",{onClick:s,className:`text-xl leading-none min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg transition-colors ${o?"text-slate-400 hover:text-slate-200 hover:bg-slate-800":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,"aria-label":"Close settings",children:"Ã—"})]}),e.jsxs("div",{className:`px-5 py-3 border-b ${o?"border-slate-800":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>x("group"),disabled:!i,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${l==="group"?o?"bg-emerald-500/15 text-emerald-300 border border-emerald-500/30":"bg-emerald-50 text-emerald-700 border border-emerald-200":o?"bg-slate-900 text-slate-300 border border-slate-800 hover:bg-slate-800":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"} disabled:opacity-40`,children:"This group"}),e.jsx("button",{type:"button",onClick:()=>x("global"),className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${l==="global"?o?"bg-emerald-500/15 text-emerald-300 border border-emerald-500/30":"bg-emerald-50 text-emerald-700 border border-emerald-200":o?"bg-slate-900 text-slate-300 border border-slate-800 hover:bg-slate-800":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:"Global"})]}),l==="group"&&i&&e.jsxs("div",{className:`mt-2 text-[11px] ${o?"text-slate-500":"text-gray-500"}`,children:["Applies to ",e.jsx("span",{className:"font-mono",children:i})," only."]}),l==="global"&&e.jsx("div",{className:`mt-2 text-[11px] ${o?"text-slate-500":"text-gray-500"}`,children:"Applies to your whole CCCC instance (daemon + Web)."})]}),e.jsx("div",{className:`flex border-b ${o?"border-slate-800":"border-gray-200"}`,children:$.map(_=>e.jsx("button",{onClick:()=>H(_.id),className:`px-4 py-2.5 text-sm font-medium transition-colors ${G===_.id?o?"text-emerald-400 border-b-2 border-emerald-400":"text-emerald-600 border-b-2 border-emerald-600":o?"text-slate-400 hover:text-slate-200":"text-gray-500 hover:text-gray-700"}`,children:_.label},_.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-6",children:[G==="timing"&&e.jsx(pr,{isDark:o,busy:a,nudgeSeconds:j,setNudgeSeconds:N,idleSeconds:y,setIdleSeconds:b,keepaliveSeconds:M,setKeepaliveSeconds:v,silenceSeconds:f,setSilenceSeconds:T,deliveryInterval:k,setDeliveryInterval:O,standupInterval:U,setStandupInterval:p,onSave:dt}),G==="im"&&e.jsx(fr,{isDark:o,groupId:i,imStatus:me,imPlatform:he,setImPlatform:ve,imBotTokenEnv:qe,setImBotTokenEnv:Se,imAppTokenEnv:$e,setImAppTokenEnv:Te,imBusy:Oe,onSaveConfig:ee,onRemoveConfig:ze,onStartBridge:Xe,onStopBridge:je}),G==="transcript"&&e.jsx(yr,{isDark:o,busy:a,groupId:i,devActors:nt,terminalVisibility:w,setTerminalVisibility:E,terminalNotifyTail:S,setTerminalNotifyTail:z,terminalNotifyLines:J,setTerminalNotifyLines:A,onSaveTranscriptSettings:Z,tailActorId:R,setTailActorId:B,tailMaxChars:q,setTailMaxChars:V,tailStripAnsi:Y,setTailStripAnsi:X,tailCompact:Q,setTailCompact:oe,tailText:ne,tailHint:we,tailErr:Ce,tailBusy:D,tailCopyInfo:We,onLoadTail:F,onCopyTail:I,onClearTail:W}),G==="remote"&&e.jsx(vr,{isDark:o}),G==="developer"&&e.jsx(jr,{isDark:o,groupId:i,developerMode:Ee,setDeveloperMode:Ie,logLevel:Ae,setLogLevel:Ve,obsBusy:rt,onSaveObservability:jt,debugSnapshot:at,debugSnapshotErr:lt,debugSnapshotBusy:ot,onLoadDebugSnapshot:Nt,onClearDebugSnapshot:()=>{_e(""),Re("")},logComponent:ge,setLogComponent:Ye,logLines:ke,setLogLines:it,logText:Qe,logErr:ct,logBusy:Be,onLoadLogTail:ht,onClearLogs:gt})]})]})]})}function pt(t){if(!t)return"â€”";try{const s=new Date(t);if(isNaN(s.getTime()))return t;const n=new Date,r=n.getTime()-s.getTime(),a=Math.floor(r/1e3),o=Math.floor(a/60),i=Math.floor(o/60),l=Math.floor(i/24);if(a<60)return"just now";if(o<60)return`${o}m ago`;if(i<24)return`${i}h ago`;if(l<7)return`${l}d ago`;const x=s.toLocaleString("en",{month:"short"}),c=s.getDate(),d=s.getFullYear(),h=n.getFullYear();return d===h?`${x} ${c}`:`${x} ${c}, ${d}`}catch{return t}}function ns(t){if(!t)return"";try{const s=new Date(t);return isNaN(s.getTime())?t:s.toLocaleString()}catch{return t}}function wr(t){if(t.kind==="chat.message"&&t.data&&typeof t.data=="object")return String(t.data.text||"");if(t.kind==="system.notify"&&t.data&&typeof t.data=="object"){const s=String(t.data.kind||"info"),n=String(t.data.title||""),r=String(t.data.message||""),a=t.data.target_actor_id?` â†’ ${t.data.target_actor_id}`:"";return`[${s}]${a}: ${n}${r?` - ${r}`:""}`}return String(t.kind||"event")}function Cr(t,s,n){const r=(s||"").trim();if(!r)return t;const a=t.toLowerCase(),o=r.toLowerCase();if(!o)return t;const i=[];let l=0,x=0;for(;;){const c=a.indexOf(o,l);if(c===-1)break;c>l&&i.push(t.slice(l,c));const d=t.slice(c,c+r.length);if(i.push(e.jsx("mark",{className:m("px-0.5 rounded",n?"bg-amber-500/20 text-amber-200":"bg-amber-200 text-amber-900"),children:d},`m${x++}-${c}`)),l=c+r.length,l>=t.length)break}return l<t.length&&i.push(t.slice(l)),i}async function Sr(t){var s;try{if((s=navigator.clipboard)!=null&&s.writeText)return await navigator.clipboard.writeText(t),!0}catch{}try{return window.prompt("Copy to clipboard:",t),!0}catch{return!1}}function $r({isOpen:t,onClose:s,groupId:n,actors:r,isDark:a,onReply:o}){const i=u.useRef(null),[l,x]=u.useState(""),[c,d]=u.useState("all"),[h,g]=u.useState(""),[j,N]=u.useState(!1),[y,b]=u.useState(""),[M,v]=u.useState([]),[f,T]=u.useState(!1),k=u.useMemo(()=>{const p=r.map(w=>String(w.id||"")).filter(Boolean);return p.sort(),p},[r]);u.useEffect(()=>{t&&(b(""),window.setTimeout(()=>{var p;return(p=i.current)==null?void 0:p.focus()},0))},[t]),u.useEffect(()=>{t&&(v([]),T(!1),b(""))},[n,t]);const O=async p=>{var w;if(t&&n){N(!0),b("");try{const E=new URLSearchParams;E.set("q",l),E.set("kind",c),h&&E.set("by",h),E.set("limit","50"),p!=null&&p.before&&E.set("before",p.before);const S=await P(`/api/v1/groups/${encodeURIComponent(n)}/ledger/search?${E.toString()}`);if(!S.ok){b(((w=S.error)==null?void 0:w.message)||"Search failed");return}const z=S.result.events||[];T(!!S.result.has_more),v(J=>(p==null?void 0:p.mode)==="prepend"?z.concat(J):z)}finally{N(!1)}}},U=async()=>{var w;const p=(w=M[0])!=null&&w.id?String(M[0].id):"";p&&await O({before:p,mode:"prepend"})};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-stretch sm:items-center justify-center p-0 sm:p-4 animate-fade-in",children:[e.jsx("div",{className:a?"absolute inset-0 bg-black/60":"absolute inset-0 bg-black/40",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:m("relative w-full h-full sm:h-auto sm:max-h-[80vh] sm:max-w-3xl flex flex-col border shadow-2xl animate-scale-in","rounded-none sm:rounded-xl",a?"bg-slate-900 border-slate-700":"bg-white border-gray-200"),role:"dialog","aria-modal":"true","aria-labelledby":"search-modal-title",children:[e.jsxs("div",{className:m("flex items-center justify-between px-4 pt-4 pb-3 border-b safe-area-inset-top",a?"border-slate-800":"border-gray-200"),children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{id:"search-modal-title",className:m("text-lg font-semibold truncate",a?"text-slate-100":"text-gray-900"),children:"ðŸ” Search Messages"}),e.jsx("div",{className:m("text-xs mt-0.5 truncate",a?"text-slate-400":"text-gray-500"),children:n})]}),e.jsx("button",{onClick:s,className:m("text-xl leading-none min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg transition-colors",a?"text-slate-400 hover:text-slate-200 hover:bg-slate-800":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"),"aria-label":"Close search modal",children:"Ã—"})]}),e.jsxs("div",{className:"px-4 py-3 border-b space-y-3 sm:space-y-0 sm:flex sm:items-end sm:gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{className:m("block text-xs font-medium mb-1",a?"text-slate-300":"text-gray-700"),children:"Query"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:i,value:l,onChange:p=>x(p.target.value),onKeyDown:p=>{p.key==="Enter"&&O({mode:"replace"})},className:m("flex-1 px-3 py-2 border rounded-lg text-sm min-h-[44px]",a?"bg-slate-800 border-slate-700 text-slate-100":"bg-white border-gray-300 text-gray-900"),placeholder:"Search text (case-insensitive)â€¦"}),e.jsx("button",{onClick:()=>void O({mode:"replace"}),disabled:j,className:m("px-4 py-2 rounded-lg text-sm font-medium min-h-[44px] disabled:opacity-50","bg-emerald-600 hover:bg-emerald-500 text-white"),children:j?"â€¦":"Search"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:m("block text-xs font-medium mb-1",a?"text-slate-300":"text-gray-700"),children:"Kind"}),e.jsx("div",{className:m("flex items-center gap-1 p-1 rounded-lg",a?"bg-slate-800/60":"bg-gray-100"),children:[["all","All"],["chat","Chat"],["notify","Notify"]].map(([p,w])=>e.jsx("button",{onClick:()=>d(p),className:m("px-2.5 py-1.5 rounded-md text-xs font-medium min-h-[36px] transition-colors",c===p?a?"bg-slate-700 text-white":"bg-white text-gray-900 shadow-sm":a?"text-slate-300 hover:text-white":"text-gray-600 hover:text-gray-900"),"aria-pressed":c===p,children:w},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:m("block text-xs font-medium mb-1",a?"text-slate-300":"text-gray-700"),children:"By"}),e.jsxs("select",{value:h,onChange:p=>g(p.target.value),className:m("px-3 py-2 border rounded-lg text-sm min-h-[44px] min-w-[140px]",a?"bg-slate-800 border-slate-700 text-slate-100":"bg-white border-gray-300 text-gray-900"),children:[e.jsx("option",{value:"",children:"Any"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"system",children:"system"}),k.map(p=>e.jsx("option",{value:p,children:p},p))]})]})]})]}),y&&e.jsx("div",{className:m("px-4 py-2 text-sm border-b",a?"border-rose-500/30 bg-rose-500/10 text-rose-300":"border-rose-300 bg-rose-50 text-rose-700"),role:"alert",children:y}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[f&&M.length>0&&e.jsx("button",{className:m("w-full px-4 py-2 rounded-lg text-sm font-medium min-h-[44px] transition-colors",a?"bg-slate-800 hover:bg-slate-700 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"),onClick:()=>void U(),disabled:j,children:"Load older results"}),M.map((p,w)=>{const E=wr(p),S=p.id?String(p.id):"",z=p.kind==="chat.message";return e.jsx("div",{className:m("rounded-lg border px-4 py-3",a?"border-slate-700/50 bg-slate-800/40":"border-gray-200 bg-gray-50"),children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:m("text-xs",a?"text-slate-400":"text-gray-500"),title:ns(p.ts),children:pt(p.ts)}),e.jsx("span",{className:m("text-xs font-medium",a?"text-slate-200":"text-gray-800"),children:p.by||"â€”"}),e.jsx("span",{className:m("text-[10px] px-2 py-0.5 rounded-full font-medium",p.kind==="system.notify"?a?"bg-blue-500/20 text-blue-300":"bg-blue-100 text-blue-700":a?"bg-slate-700/60 text-slate-300":"bg-white text-gray-600 border border-gray-200"),children:p.kind||"event"}),S&&e.jsx("span",{className:m("text-[10px] truncate",a?"text-slate-500":"text-gray-400"),title:S,children:S})]}),e.jsx("div",{className:m("mt-2 text-sm whitespace-pre-wrap break-words",a?"text-slate-100":"text-gray-800"),children:Cr(E,l,a)})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end sm:flex-col sm:items-end",children:[z&&e.jsx("button",{className:m("text-[10px] px-2 py-1 rounded border min-h-[36px] transition-colors",a?"bg-slate-900 border-slate-800 hover:bg-slate-800/60 text-slate-300 hover:text-slate-100":"bg-white border-gray-200 hover:bg-gray-100 text-gray-600 hover:text-gray-900"),onClick:()=>o(p),"aria-label":`Reply to ${String(p.by||"message")}`,title:"Reply",children:"â†© Reply"}),S&&e.jsx("button",{className:m("text-[10px] px-2 py-1 rounded border min-h-[36px] transition-colors",a?"bg-slate-900 border-slate-800 hover:bg-slate-800/60 text-slate-300 hover:text-slate-100":"bg-white border-gray-200 hover:bg-gray-100 text-gray-600 hover:text-gray-900"),onClick:()=>void Sr(S),"aria-label":"Copy event id",title:"Copy event id",children:"â§‰ Copy ID"})]})]})},S||`r${w}`)}),!j&&M.length===0&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”Ž"}),e.jsx("div",{className:m("text-sm",a?"text-slate-300":"text-gray-700"),children:"No results"}),e.jsx("div",{className:m("text-xs mt-1",a?"text-slate-500":"text-gray-500"),children:"Try a different query, sender, or kind filter."})]})]})]})]}):null}function ft(t,s){if(!t)return{label:"â—‹ STOP",colorClass:"bg-slate-700/50 text-slate-500"};switch(s){case"paused":return{label:"â¸ PAUSED",colorClass:"bg-amber-500/20 text-amber-500"};case"idle":return{label:"âœ“ IDLE",colorClass:"bg-blue-500/20 text-blue-400"};default:return{label:"â— RUN",colorClass:"bg-emerald-500/20 text-emerald-500"}}}function yt(t,s){if(!t)return{label:"â—‹ STOP",colorClass:"bg-gray-200 text-gray-500"};switch(s){case"paused":return{label:"â¸ PAUSED",colorClass:"bg-amber-100 text-amber-600"};case"idle":return{label:"âœ“ IDLE",colorClass:"bg-blue-100 text-blue-600"};default:return{label:"â— RUN",colorClass:"bg-emerald-100 text-emerald-600"}}}function as({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),e.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"})]})}function Tr({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"}),e.jsx("path",{d:"M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"}),e.jsx("path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"}),e.jsx("path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"})]})}function Rt({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polygon",{points:"6 3 20 12 6 21 6 3",fill:"currentColor",opacity:"0.15"}),e.jsx("polygon",{points:"6 3 20 12 6 21 6 3"})]})}function ls({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",fill:"currentColor",opacity:"0.15"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",fill:"currentColor",opacity:"0.15"}),e.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]})}function os({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",fill:"currentColor",opacity:"0.15"}),e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"})]})}function is({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}function cs({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}function Er({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"19",r:"1.5",fill:"currentColor"})]})}function Ar({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),e.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),e.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}function ds({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function _r({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}function Rr({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z",fill:"currentColor",opacity:"0.1"}),e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})]})}function xs({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}function us({className:t,size:s=18}){return e.jsx("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})}function Lr({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polyline",{points:"4 17 10 11 4 5"}),e.jsx("line",{x1:"12",y1:"19",x2:"20",y2:"19"})]})}function Mn({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12"}),e.jsx("path",{d:"M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"})]})}function On({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}function In({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})}function Mr({isOpen:t,isDark:s,selectedGroupId:n,groupDoc:r,selectedGroupRunning:a,actors:o,busy:i,onClose:l,onToggleTheme:x,onOpenSearch:c,onOpenContext:d,onOpenSettings:h,onOpenGroupEdit:g,onStartGroup:j,onStopGroup:N,onSetGroupState:y}){return t?e.jsxs("div",{className:"fixed inset-0 z-50 sm:hidden animate-fade-in",children:[e.jsx("div",{className:"absolute inset-0 glass-overlay",onClick:l,"aria-hidden":"true"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 rounded-t-3xl glass-modal animate-slide-up transform transition-transform",role:"dialog","aria-modal":"true","aria-label":"Menu",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-1",onClick:l,children:e.jsx("div",{className:`w-12 h-1.5 rounded-full ${s?"bg-white/20":"bg-black/15"}`})}),e.jsxs("div",{className:"px-6 pb-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:m("text-lg font-bold truncate",s?"text-slate-100":"text-gray-900"),children:(r==null?void 0:r.title)||n||"Menu"}),n&&r&&e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("span",{className:m("text-xs px-2 py-0.5 rounded-full font-medium",s?ft(a,r.state).colorClass:yt(a,r.state).colorClass),children:(s?ft(a,r.state):yt(a,r.state)).label})})]}),e.jsx("button",{onClick:l,className:m("p-2 rounded-full transition-colors glass-btn",s?"text-slate-400 hover:text-slate-200":"text-gray-400 hover:text-gray-600"),"aria-label":"Close menu",children:e.jsx(ds,{size:20})})]}),e.jsxs("div",{className:"p-4 space-y-2 safe-area-inset-bottom",children:[!n&&e.jsx("div",{className:m("text-sm px-1 pb-2",s?"text-slate-400":"text-gray-500"),children:"Select a group to enable actions."}),e.jsxs("button",{className:m("w-full flex items-center justify-center gap-3 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-200":"text-gray-800"),onClick:()=>{l(),c()},disabled:!n,children:[e.jsx(_r,{size:18}),e.jsx("span",{children:"Search Messages"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{className:m("w-full flex items-center justify-center gap-2 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-200":"text-gray-800"),onClick:()=>{l(),d()},disabled:!n,children:[e.jsx(as,{size:18}),e.jsx("span",{children:"Context"})]}),e.jsxs("button",{className:m("w-full flex items-center justify-center gap-2 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-200":"text-gray-800"),onClick:()=>{l(),h()},disabled:!n,children:[e.jsx(is,{size:18}),e.jsx("span",{children:"Settings"})]})]}),e.jsxs("button",{className:m("w-full flex items-center justify-center gap-3 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-200":"text-gray-800"),onClick:x,children:[s?e.jsx(xs,{size:18}):e.jsx(us,{size:18}),e.jsx("span",{children:s?"Light Mode":"Dark Mode"})]}),e.jsxs("button",{className:m("w-full flex items-center justify-center gap-3 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-200":"text-gray-800"),onClick:()=>{l(),g()},disabled:!n,children:[e.jsx(cs,{size:18}),e.jsx("span",{children:"Edit Group Details"})]}),e.jsx("div",{className:m("h-px my-3 mx-2",s?"bg-white/10":"bg-black/10")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{className:m("w-full flex flex-col items-center justify-center gap-2 px-2 py-3 rounded-2xl text-sm font-medium transition-all min-h-[64px] disabled:opacity-50",s?"glass-btn-accent text-emerald-300":"glass-btn-accent text-emerald-700"),style:{"--glass-accent-bg":s?"rgba(16, 185, 129, 0.15)":"rgba(16, 185, 129, 0.1)","--glass-accent-border":s?"rgba(16, 185, 129, 0.25)":"rgba(16, 185, 129, 0.2)","--glass-accent-glow":s?"0 0 20px rgba(16, 185, 129, 0.15)":"0 0 16px rgba(16, 185, 129, 0.1)"},onClick:()=>{l(),j()},disabled:!n||i==="group-start"||o.length===0,children:[e.jsx(Rt,{size:20}),e.jsx("span",{children:"Launch All"})]}),e.jsxs("button",{className:m("w-full flex flex-col items-center justify-center gap-2 px-2 py-3 rounded-2xl text-sm font-medium transition-all min-h-[64px] disabled:opacity-50 glass-btn",s?"text-slate-300":"text-gray-600"),onClick:()=>{l(),N()},disabled:!n||i==="group-stop",children:[e.jsx(os,{size:20}),e.jsx("span",{children:"Quit All"})]})]}),(r==null?void 0:r.state)==="paused"?e.jsxs("button",{className:m("w-full flex items-center justify-center gap-2 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50",s?"glass-btn-accent text-amber-300":"glass-btn-accent text-amber-700"),style:{"--glass-accent-bg":s?"rgba(245, 158, 11, 0.15)":"rgba(245, 158, 11, 0.1)","--glass-accent-border":s?"rgba(245, 158, 11, 0.25)":"rgba(245, 158, 11, 0.2)","--glass-accent-glow":s?"0 0 20px rgba(245, 158, 11, 0.15)":"0 0 16px rgba(245, 158, 11, 0.1)"},onClick:()=>{l(),y("active")},disabled:!n||i==="group-state",children:[e.jsx(Rt,{size:18}),e.jsx("span",{children:"Resume Message Delivery"})]}):e.jsxs("button",{className:m("w-full flex items-center justify-center gap-2 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-300":"text-gray-600"),onClick:()=>{l(),y("paused")},disabled:!n||i==="group-state",children:[e.jsx(ls,{size:18}),e.jsx("span",{children:"Pause Message Delivery"})]})]})]})]}):null}const ms=["claude","codex","droid","amp","auggie","neovate","gemini","cursor","kilocode","opencode","copilot","custom"],mt={amp:{label:"Amp",desc:""},auggie:{label:"Auggie (Augment)",desc:""},claude:{label:"Claude Code",desc:""},codex:{label:"Codex CLI",desc:""},cursor:{label:"Cursor CLI",desc:"Manual MCP installation needed"},droid:{label:"Droid",desc:""},gemini:{label:"Gemini CLI",desc:""},kilocode:{label:"Kilo Code",desc:"Manual MCP installation needed"},neovate:{label:"Neovate Code",desc:""},opencode:{label:"OpenCode",desc:"Manual MCP installation needed"},copilot:{label:"GitHub Copilot",desc:"Manual MCP installation needed"},custom:{label:"Custom",desc:"Manual MCP installation needed"}},Bt={amp:{bg:"bg-rose-900/30",text:"text-rose-300",border:"border-rose-600/50",dot:"bg-rose-400",bgLight:"bg-rose-50",textLight:"text-rose-700",borderLight:"border-rose-300",dotLight:"bg-rose-500"},auggie:{bg:"bg-teal-900/30",text:"text-teal-300",border:"border-teal-600/50",dot:"bg-teal-400",bgLight:"bg-teal-50",textLight:"text-teal-700",borderLight:"border-teal-300",dotLight:"bg-teal-500"},claude:{bg:"bg-orange-900/30",text:"text-orange-300",border:"border-orange-600/50",dot:"bg-orange-400",bgLight:"bg-orange-50",textLight:"text-orange-700",borderLight:"border-orange-300",dotLight:"bg-orange-500"},codex:{bg:"bg-emerald-900/30",text:"text-emerald-300",border:"border-emerald-600/50",dot:"bg-emerald-400",bgLight:"bg-emerald-50",textLight:"text-emerald-700",borderLight:"border-emerald-300",dotLight:"bg-emerald-500"},cursor:{bg:"bg-indigo-900/30",text:"text-indigo-300",border:"border-indigo-600/50",dot:"bg-indigo-400",bgLight:"bg-indigo-50",textLight:"text-indigo-700",borderLight:"border-indigo-300",dotLight:"bg-indigo-500"},droid:{bg:"bg-violet-900/30",text:"text-violet-300",border:"border-violet-600/50",dot:"bg-violet-400",bgLight:"bg-violet-50",textLight:"text-violet-700",borderLight:"border-violet-300",dotLight:"bg-violet-500"},gemini:{bg:"bg-yellow-900/30",text:"text-yellow-300",border:"border-yellow-600/50",dot:"bg-yellow-400",bgLight:"bg-yellow-50",textLight:"text-yellow-700",borderLight:"border-yellow-300",dotLight:"bg-yellow-500"},kilocode:{bg:"bg-pink-900/30",text:"text-pink-300",border:"border-pink-600/50",dot:"bg-pink-400",bgLight:"bg-pink-50",textLight:"text-pink-700",borderLight:"border-pink-300",dotLight:"bg-pink-500"},neovate:{bg:"bg-fuchsia-900/30",text:"text-fuchsia-300",border:"border-fuchsia-600/50",dot:"bg-fuchsia-400",bgLight:"bg-fuchsia-50",textLight:"text-fuchsia-700",borderLight:"border-fuchsia-300",dotLight:"bg-fuchsia-500"},opencode:{bg:"bg-cyan-900/30",text:"text-cyan-300",border:"border-cyan-600/50",dot:"bg-cyan-400",bgLight:"bg-cyan-50",textLight:"text-cyan-700",borderLight:"border-cyan-300",dotLight:"bg-cyan-500"},copilot:{bg:"bg-slate-800/50",text:"text-slate-300",border:"border-slate-500/50",dot:"bg-slate-400",bgLight:"bg-gray-100",textLight:"text-gray-700",borderLight:"border-gray-300",dotLight:"bg-gray-500"},custom:{bg:"bg-zinc-800/50",text:"text-zinc-300",border:"border-zinc-500/50",dot:"bg-zinc-400",bgLight:"bg-zinc-100",textLight:"text-zinc-700",borderLight:"border-zinc-300",dotLight:"bg-zinc-500"},user:{bg:"bg-sky-900/30",text:"text-sky-300",border:"border-sky-600/50",dot:"bg-sky-400",bgLight:"bg-sky-50",textLight:"text-sky-700",borderLight:"border-sky-300",dotLight:"bg-sky-500"}};function Pn(t,s=!0){const n=Bt[t||"codex"]||Bt.codex;return s?{bg:n.bg,text:n.text,border:n.border,dot:n.dot}:{bg:n.bgLight,text:n.textLight,border:n.borderLight,dot:n.dotLight}}const St=[{ring:"ring-sky-400/35",text:"text-sky-300",ringLight:"ring-sky-300",textLight:"text-sky-700"},{ring:"ring-indigo-400/35",text:"text-indigo-300",ringLight:"ring-indigo-300",textLight:"text-indigo-700"},{ring:"ring-violet-400/35",text:"text-violet-300",ringLight:"ring-violet-300",textLight:"text-violet-700"},{ring:"ring-fuchsia-400/35",text:"text-fuchsia-300",ringLight:"ring-fuchsia-300",textLight:"text-fuchsia-700"},{ring:"ring-cyan-400/35",text:"text-cyan-300",ringLight:"ring-cyan-300",textLight:"text-cyan-700"},{ring:"ring-teal-400/35",text:"text-teal-300",ringLight:"ring-teal-300",textLight:"text-teal-700"},{ring:"ring-emerald-400/35",text:"text-emerald-300",ringLight:"ring-emerald-300",textLight:"text-emerald-700"},{ring:"ring-amber-400/35",text:"text-amber-300",ringLight:"ring-amber-300",textLight:"text-amber-700"}];function Or(t){let s=2166136261;for(let n=0;n<t.length;n++)s^=t.charCodeAt(n),s=Math.imul(s,16777619);return s>>>0}function Ir(t,s=!0){const n=String(t||"").trim(),r=n?Or(n)%St.length:0,a=St[r]||St[0];return s?{ring:a.ring,text:a.text}:{ring:a.ringLight,text:a.textLight}}const hs=JSON.stringify({mcpServers:{cccc:{command:"cccc",args:["mcp"]}}},null,2),gs=JSON.stringify({mcpServers:{cccc:{command:"cccc",args:["mcp"],tools:["*"]}}},null,2),bs=JSON.stringify({mcp:{cccc:{type:"local",command:["cccc","mcp"]}}},null,2);function Pr({isOpen:t,isDark:s,busy:n,hasForeman:r,runtimes:a,suggestedActorId:o,newActorId:i,setNewActorId:l,newActorRole:x,setNewActorRole:c,newActorRuntime:d,setNewActorRuntime:h,newActorCommand:g,setNewActorCommand:j,showAdvancedActor:N,setShowAdvancedActor:y,addActorError:b,setAddActorError:M,canAddActor:v,addActorDisabledReason:f,onAddActor:T,onClose:k,onCancelAndReset:O}){var p,w;if(!t)return null;const U=((p=a.find(E=>E.name===d))==null?void 0:p.recommended_command)||"";return e.jsx("div",{className:`fixed inset-0 backdrop-blur-sm flex items-start justify-center p-4 sm:p-6 z-50 animate-fade-in ${s?"bg-black/50":"bg-black/30"}`,onMouseDown:E=>{E.target===E.currentTarget&&k()},role:"dialog","aria-modal":"true","aria-labelledby":"add-actor-title",children:e.jsxs("div",{className:`w-full max-w-lg mt-8 sm:mt-16 rounded-2xl border shadow-2xl max-h-[80vh] overflow-y-auto animate-scale-in ${s?"border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:`px-6 py-4 border-b sticky top-0 ${s?"border-slate-700/50 bg-slate-800":"border-gray-200 bg-white"}`,children:[e.jsx("div",{id:"add-actor-title",className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:"Add AI Agent"}),e.jsx("div",{className:`text-sm mt-1 ${s?"text-slate-400":"text-gray-500"}`,children:"Choose an AI runtime to add to your team"})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[b&&e.jsxs("div",{className:`rounded-xl border px-4 py-2.5 text-sm flex items-center justify-between gap-3 ${s?"border-rose-500/30 bg-rose-500/10 text-rose-300":"border-rose-300 bg-rose-50 text-rose-700"}`,role:"alert",children:[e.jsx("span",{children:b}),e.jsx("button",{className:s?"text-rose-300 hover:text-rose-100":"text-rose-500 hover:text-rose-700",onClick:()=>M(""),children:"Ã—"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:["Agent Name ",e.jsx("span",{className:s?"text-slate-500":"text-gray-400",children:"(supports Unicode, incl. CJK)"})]}),e.jsx("input",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white placeholder-slate-500 focus:border-blue-500":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-blue-500"}`,value:i,onChange:E=>l(E.target.value),placeholder:o}),e.jsxs("div",{className:`text-[10px] mt-1 ${s?"text-slate-500":"text-gray-500"}`,children:["Leave empty to use:"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-slate-800":"bg-gray-100"}`,children:o})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"AI Runtime"}),e.jsx("select",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,value:d,onChange:E=>{const S=E.target.value;h(S),j("")},children:ms.map(E=>{const S=mt[E],z=a.find(R=>R.name===E),J=(z==null?void 0:z.available)??!1,A=J||E==="custom";return e.jsxs("option",{value:E,disabled:!A,children:[(S==null?void 0:S.label)||E,!J&&E!=="custom"?" (not installed)":""]},E)})}),(w=mt[d])!=null&&w.desc?e.jsx("div",{className:`text-[10px] mt-1 ${s?"text-slate-500":"text-gray-500"}`,children:mt[d].desc}):null,(d==="cursor"||d==="kilocode"||d==="opencode"||d==="copilot"||d==="custom")&&e.jsxs("div",{className:`mt-2 rounded-xl border px-3 py-2 text-[11px] ${s?"border-amber-500/30 bg-amber-500/10 text-amber-200":"border-amber-200 bg-amber-50 text-amber-800"}`,children:[e.jsx("div",{className:"font-medium",children:"Manual MCP install required"}),d==="custom"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["Provide a command for your runtime in ",e.jsx("span",{className:"font-medium",children:"Advanced options â†’ Command Override"}),"."]}),e.jsxs("div",{className:"mt-1",children:["Configure your runtime to add an MCP stdio server named"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"cccc"})," that runs"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"cccc mcp"}),"."]})]}):d==="cursor"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.cursor/mcp.json"})," (or"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:".cursor/mcp.json"})," in this project)"]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):d==="kilocode"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:".kilocode/mcp.json"})," in this project root"]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):d==="opencode"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.config/opencode/opencode.json"})]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.copilot/mcp-config.json"})]}),e.jsxs("div",{className:"mt-1",children:["2) Add this MCP server config (or pass it via"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"--additional-mcp-config"}),"):"]})]}),d!=="custom"?e.jsx("pre",{className:`mt-1.5 p-2 rounded overflow-x-auto whitespace-pre ${s?"bg-amber-900/20 text-amber-100":"bg-amber-50 text-amber-900"}`,children:e.jsx("code",{children:d==="opencode"?bs:d==="copilot"?gs:hs})}):null,e.jsx("div",{className:`mt-1 text-[10px] ${s?"text-amber-200/80":"text-amber-800/80"}`,children:"Restart the runtime after updating this config."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Role"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:m("flex-1 px-4 py-2.5 rounded-xl border text-sm font-medium transition-all min-h-[44px]",x==="foreman"?"bg-amber-500/20 border-amber-500 text-amber-600":r?s?"bg-slate-900/30 border-slate-700/30 text-slate-500 cursor-not-allowed":"bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed":s?"bg-slate-800/50 border-slate-600/50 text-slate-300 hover:border-slate-500":"bg-gray-50 border-gray-200 text-gray-600 hover:border-gray-300"),onClick:()=>{r||c("foreman")},disabled:r,children:["â˜… Foreman ",r&&"(exists)"]}),e.jsxs("button",{className:m("flex-1 px-4 py-2.5 rounded-xl border text-sm font-medium transition-all min-h-[44px]",x==="peer"?"bg-blue-500/20 border-blue-500 text-blue-600":r?s?"bg-slate-800/50 border-slate-600/50 text-slate-300 hover:border-slate-500":"bg-gray-50 border-gray-200 text-gray-600 hover:border-gray-300":s?"bg-slate-900/30 border-slate-700/30 text-slate-500 cursor-not-allowed":"bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed"),onClick:()=>{r&&c("peer")},disabled:!r,children:["Peer ",!r&&"(need foreman first)"]})]}),e.jsx("div",{className:`text-[10px] mt-1.5 ${s?"text-slate-500":"text-gray-500"}`,children:r?"Foreman leads the team. Peers are worker agents.":"First agent must be the foreman (team leader)."})]}),e.jsxs("button",{className:`flex items-center gap-2 text-xs min-h-[36px] ${s?"text-slate-400 hover:text-slate-300":"text-gray-500 hover:text-gray-700"}`,onClick:()=>y(!N),children:[e.jsx("span",{className:m("transition-transform",N&&"rotate-90"),children:"â–¶"}),"Advanced options"]}),N&&e.jsx("div",{className:`space-y-4 pl-4 border-l-2 ${s?"border-slate-700/50":"border-gray-200"}`,children:e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Command Override"}),e.jsx("input",{className:`w-full rounded-xl border px-3 py-2 text-sm font-mono min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white placeholder-slate-500 focus:border-blue-500":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-blue-500"}`,value:g,onChange:E=>j(E.target.value),placeholder:U||"Enter command..."}),U.trim()?e.jsxs("div",{className:`text-[10px] mt-1 ${s?"text-slate-500":"text-gray-500"}`,children:["Default:"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-slate-800":"bg-gray-100"}`,children:U})]}):null]})}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("button",{className:"w-full rounded-xl bg-blue-600 hover:bg-blue-500 text-white px-4 py-2.5 text-sm font-semibold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all min-h-[44px]",onClick:T,disabled:!v,children:n==="actor-add"?"Adding...":"Add Agent"}),f&&e.jsx("div",{className:"text-[10px] text-amber-500 mt-1.5",children:f})]}),e.jsx("button",{className:`px-4 py-2.5 rounded-xl text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:O,children:"Cancel"})]})]})]})})}function kr({isOpen:t,isDark:s,busy:n,dirSuggestions:r,dirItems:a,currentDir:o,parentDir:i,showDirBrowser:l,createGroupPath:x,setCreateGroupPath:c,createGroupName:d,setCreateGroupName:h,onFetchDirContents:g,onCreateGroup:j,onClose:N,onCancelAndReset:y}){return t?e.jsx("div",{className:`fixed inset-0 backdrop-blur-sm flex items-start justify-center p-4 sm:p-6 z-50 animate-fade-in ${s?"bg-black/50":"bg-black/30"}`,onMouseDown:b=>{b.target===b.currentTarget&&N()},role:"dialog","aria-modal":"true","aria-labelledby":"create-group-title",children:e.jsxs("div",{className:`w-full max-w-lg mt-8 sm:mt-16 rounded-2xl border shadow-2xl animate-scale-in ${s?"border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${s?"border-slate-700/50":"border-gray-200"}`,children:[e.jsx("div",{id:"create-group-title",className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:"Create Working Group"}),e.jsx("div",{className:`text-sm mt-1 ${s?"text-slate-400":"text-gray-500"}`,children:"Select a project directory to start collaborating"})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[r.length>0&&!x&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Quick Select"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.slice(0,6).map(b=>e.jsxs("button",{className:`flex items-center gap-2 px-3 py-2 rounded-xl border transition-colors text-left min-h-[56px] ${s?"border-slate-600/50 bg-slate-800/50 hover:bg-slate-700/50 hover:border-slate-500":"border-gray-200 bg-gray-50 hover:bg-gray-100 hover:border-gray-300"}`,onClick:()=>{c(b.path),h(b.path.split("/").filter(Boolean).pop()||""),g(b.path)},children:[e.jsx("span",{className:"text-lg",children:b.icon}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:`text-sm font-medium truncate ${s?"text-slate-200":"text-gray-700"}`,children:b.name}),e.jsx("div",{className:`text-[10px] truncate ${s?"text-slate-500":"text-gray-500"}`,children:b.path})]})]},b.path))})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Project Directory"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:`flex-1 rounded-xl border px-4 py-2.5 text-sm font-mono min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white placeholder-slate-500 focus:border-blue-500":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-blue-500"}`,value:x,onChange:b=>{c(b.target.value);const M=b.target.value.split("/").filter(Boolean).pop()||"";(!d||d===o.split("/").filter(Boolean).pop())&&h(M)},placeholder:"/path/to/your/project",autoFocus:!0}),e.jsx("button",{className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:()=>g(x||"~"),children:"Browse"})]})]}),l&&e.jsxs("div",{className:`border rounded-xl max-h-48 overflow-auto ${s?"border-slate-600/50 bg-slate-900/50":"border-gray-200 bg-gray-50"}`,children:[o&&e.jsx("div",{className:`px-3 py-1.5 border-b text-xs font-mono truncate ${s?"border-slate-700/30 bg-slate-800/30 text-slate-400":"border-gray-200 bg-gray-100 text-gray-500"}`,children:o}),i&&e.jsxs("button",{className:`w-full flex items-center gap-2 px-3 py-2 text-left border-b min-h-[44px] ${s?"hover:bg-slate-800/50 border-slate-700/30":"hover:bg-gray-100 border-gray-200"}`,onClick:()=>{g(i),c(i),h(i.split("/").filter(Boolean).pop()||"")},children:[e.jsx("span",{className:s?"text-slate-400":"text-gray-400",children:"ðŸ“"}),e.jsx("span",{className:`text-sm ${s?"text-slate-400":"text-gray-500"}`,children:".."})]}),a.filter(b=>b.is_dir).length===0&&e.jsx("div",{className:`px-3 py-4 text-center text-sm ${s?"text-slate-500":"text-gray-500"}`,children:"No subdirectories"}),a.filter(b=>b.is_dir).map(b=>e.jsxs("button",{className:`w-full flex items-center gap-2 px-3 py-2 text-left min-h-[44px] ${s?"hover:bg-slate-800/50":"hover:bg-gray-100"}`,onClick:()=>{c(b.path),h(b.name),g(b.path)},children:[e.jsx("span",{className:"text-blue-500",children:"ðŸ“"}),e.jsx("span",{className:`text-sm ${s?"text-slate-200":"text-gray-700"}`,children:b.name})]},b.path))]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Group Name"}),e.jsx("input",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white placeholder-slate-500 focus:border-blue-500":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-blue-500"}`,value:d,onChange:b=>h(b.target.value),placeholder:"Auto-filled from directory name"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{className:"flex-1 rounded-xl bg-blue-600 hover:bg-blue-500 text-white px-4 py-2.5 text-sm font-semibold shadow-lg disabled:opacity-50 transition-all min-h-[44px]",onClick:j,disabled:!x.trim()||n==="create",children:n==="create"?"Creating...":"Create Group"}),e.jsx("button",{className:`px-4 py-2.5 rounded-xl text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:y,children:"Cancel"})]})]})]})}):null}function Br({isOpen:t,isDark:s,busy:n,actorId:r,runtimes:a,runtime:o,onChangeRuntime:i,command:l,onChangeCommand:x,onSave:c,onCancel:d}){if(!t)return null;const h=a.find(y=>y.name===o),g=(h==null?void 0:h.available)??!1,j=(h==null?void 0:h.recommended_command)||"",N=o==="custom"||!g;return e.jsx("div",{className:`fixed inset-0 flex items-start justify-center p-4 sm:p-6 z-50 animate-fade-in ${s?"bg-black/60":"bg-black/40"}`,onMouseDown:y=>{y.target===y.currentTarget&&d()},role:"dialog","aria-modal":"true","aria-labelledby":"edit-actor-title",children:e.jsxs("div",{className:`w-full max-w-md mt-8 sm:mt-16 rounded-2xl border shadow-2xl animate-scale-in ${s?"border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${s?"border-slate-700/50":"border-gray-200"}`,children:[e.jsxs("div",{id:"edit-actor-title",className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:["Edit Agent: ",r]}),e.jsx("div",{className:`text-sm mt-1 ${s?"text-slate-400":"text-gray-500"}`,children:"Change the AI runtime for this agent"})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Runtime"}),e.jsx("select",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,value:o,onChange:y=>{const b=y.target.value;i(b),x("")},children:ms.map(y=>{const b=mt[y],M=a.find(T=>T.name===y),v=(M==null?void 0:M.available)??!1,f=v||y==="custom";return e.jsxs("option",{value:y,disabled:!f,children:[(b==null?void 0:b.label)||y,!v&&y!=="custom"?" (not installed)":""]},y)})}),(o==="cursor"||o==="kilocode"||o==="opencode"||o==="copilot"||o==="custom")&&e.jsxs("div",{className:`mt-2 rounded-xl border px-3 py-2 text-[11px] ${s?"border-amber-500/30 bg-amber-500/10 text-amber-200":"border-amber-200 bg-amber-50 text-amber-800"}`,children:[e.jsx("div",{className:"font-medium",children:"Manual MCP install required"}),o==="custom"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-1",children:["Configure your runtime to add an MCP stdio server named"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"cccc"})," ","that runs ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"cccc mcp"}),"."]})}):o==="cursor"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.cursor/mcp.json"})," (or"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:".cursor/mcp.json"})," in this project)"]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):o==="kilocode"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:".kilocode/mcp.json"})," in this project root"]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):o==="opencode"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.config/opencode/opencode.json"})]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.copilot/mcp-config.json"})]}),e.jsxs("div",{className:"mt-1",children:["2) Add this MCP server config (or pass it via"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"--additional-mcp-config"}),"):"]})]}),o!=="custom"?e.jsx("pre",{className:`mt-1.5 p-2 rounded overflow-x-auto whitespace-pre ${s?"bg-amber-900/20 text-amber-100":"bg-amber-50 text-amber-900"}`,children:e.jsx("code",{children:o==="opencode"?bs:o==="copilot"?gs:hs})}):null,e.jsx("div",{className:`mt-1 text-[10px] ${s?"text-amber-200/80":"text-amber-800/80"}`,children:"Restart the runtime after updating this config."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Command"}),e.jsx("input",{className:`w-full rounded-xl border px-4 py-2.5 text-sm font-mono min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,value:l,onChange:y=>x(y.target.value),placeholder:j||"Enter command..."}),j.trim()?e.jsxs("div",{className:`text-[10px] mt-1.5 ${s?"text-slate-500":"text-gray-500"}`,children:["Default:"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-slate-800":"bg-gray-100"}`,children:j})]}):null]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{className:"flex-1 rounded-xl bg-blue-600 hover:bg-blue-500 text-white px-4 py-2.5 text-sm font-semibold shadow-lg disabled:opacity-50 transition-all min-h-[44px]",onClick:c,disabled:n==="actor-update"||N&&!l.trim(),children:"Save"}),e.jsx("button",{className:`px-4 py-2.5 rounded-xl text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:d,children:"Cancel"})]})]})]})})}function Fr({isOpen:t,isDark:s,busy:n,title:r,topic:a,onChangeTitle:o,onChangeTopic:i,onSave:l,onCancel:x,onDelete:c}){return t?e.jsx("div",{className:`fixed inset-0 backdrop-blur-sm flex items-start justify-center p-4 sm:p-6 z-50 animate-fade-in ${s?"bg-black/50":"bg-black/30"}`,onMouseDown:d=>{d.target===d.currentTarget&&x()},role:"dialog","aria-modal":"true","aria-labelledby":"group-edit-title",children:e.jsxs("div",{className:`w-full max-w-md mt-8 sm:mt-16 rounded-2xl border shadow-2xl animate-scale-in ${s?"border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900":"border-gray-200 bg-white"}`,children:[e.jsx("div",{className:`px-6 py-4 border-b ${s?"border-slate-700/50":"border-gray-200"}`,children:e.jsx("div",{id:"group-edit-title",className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:"Edit Group"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Name"}),e.jsx("input",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,value:r,onChange:d=>o(d.target.value),placeholder:"Group name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Description (optional)"}),e.jsx("input",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,value:a,onChange:d=>i(d.target.value),placeholder:"What is this group working on?"})]}),e.jsxs("div",{className:"flex gap-3 pt-3 flex-wrap",children:[e.jsx("button",{className:"flex-1 rounded-xl bg-blue-600 hover:bg-blue-500 text-white px-4 py-2.5 text-sm font-semibold shadow-lg disabled:opacity-50 transition-all min-h-[44px]",onClick:l,disabled:!r.trim()||n==="group-update",children:"Save"}),e.jsx("button",{className:`px-4 py-2.5 rounded-xl text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:x,children:"Cancel"}),e.jsx("button",{className:`px-4 py-2.5 rounded-xl border text-sm font-medium disabled:opacity-50 transition-colors min-h-[44px] ${s?"bg-rose-500/20 border-rose-500/30 text-rose-400 hover:bg-rose-500/30":"bg-rose-50 border-rose-200 text-rose-600 hover:bg-rose-100"}`,onClick:()=>{x(),c()},disabled:n==="group-delete",title:"Delete this group permanently",children:"Delete"})]})]})]})}):null}function Ur(t){if(t.kind==="chat.message"&&t.data&&typeof t.data=="object")return String(t.data.text||"");if(t.kind==="system.notify"&&t.data&&typeof t.data=="object"){const r=String(t.data.kind||"info"),a=String(t.data.title||""),o=String(t.data.message||""),i=t.data.target_actor_id?` â†’ ${t.data.target_actor_id}`:"";return`[${r}]${i}: ${a}${o?` - ${o}`:""}`}const s=String(t.kind||"event"),n=t.by?` by ${t.by}`:"";return`${s}${n}`}function zr({isOpen:t,isDark:s,actorId:n,messages:r,busy:a,onClose:o,onMarkAllRead:i}){return t?e.jsx("div",{className:`fixed inset-0 backdrop-blur-sm flex items-start justify-center p-4 sm:p-6 z-50 animate-fade-in ${s?"bg-black/50":"bg-black/30"}`,onMouseDown:l=>{l.target===l.currentTarget&&o()},role:"dialog","aria-modal":"true","aria-labelledby":"inbox-title",children:e.jsxs("div",{className:`w-full max-w-2xl mt-8 sm:mt-16 rounded-2xl border shadow-2xl animate-scale-in ${s?"border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:`px-4 sm:px-6 py-4 border-b flex items-center justify-between gap-3 ${s?"border-slate-700/50":"border-gray-200"}`,children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{id:"inbox-title",className:`text-lg font-semibold truncate ${s?"text-white":"text-gray-900"}`,children:["Inbox Â· ",n]}),e.jsxs("div",{className:`text-sm ${s?"text-slate-400":"text-gray-500"}`,children:[r.length," unread messages"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:`rounded-xl px-4 py-2 text-sm font-medium disabled:opacity-50 transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:i,disabled:!r.length||a.startsWith("inbox"),children:"Mark all read"}),e.jsx("button",{className:`rounded-xl px-4 py-2 text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-600 hover:bg-slate-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,onClick:o,children:"Close"})]})]}),e.jsxs("div",{className:"max-h-[60vh] overflow-auto p-4 space-y-2",children:[r.map((l,x)=>e.jsxs("div",{className:`rounded-xl border px-4 py-3 ${s?"border-slate-700/50 bg-slate-800/50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:`text-xs truncate ${s?"text-slate-400":"text-gray-500"}`,title:ns(l.ts),children:pt(l.ts)}),e.jsx("div",{className:`text-xs font-medium truncate ${s?"text-slate-300":"text-gray-700"}`,children:l.by||"â€”"})]}),e.jsx("div",{className:`mt-2 text-sm whitespace-pre-wrap break-words ${s?"text-slate-200":"text-gray-800"}`,children:Ur(l)})]},String(l.id||x))),!r.length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“­"}),e.jsx("div",{className:`text-sm ${s?"text-slate-400":"text-gray-500"}`,children:"No unread messages"})]})]})]})}):null}function Gr({isOpen:t,isDark:s,isSmallScreen:n,toLabel:r,entries:a,onClose:o}){return t?e.jsxs("div",{className:m("fixed inset-0 z-50 flex animate-fade-in",n?"items-end justify-center":"items-center justify-center p-4"),role:"dialog","aria-modal":"true","aria-label":"Recipient status",children:[e.jsx("div",{className:m("absolute inset-0",s?"bg-black/60":"bg-black/40"),onClick:o,"aria-hidden":"true"}),e.jsxs("div",{className:m("relative w-full border shadow-2xl",n?"rounded-t-2xl max-h-[80vh] animate-slide-up safe-area-inset-bottom":"max-w-md rounded-2xl animate-scale-in",s?"bg-slate-900 border-slate-700 text-slate-100":"bg-white border-gray-200 text-gray-900"),children:[e.jsxs("div",{className:m("px-5 py-4 border-b flex items-center justify-between gap-3",s?"border-slate-800":"border-gray-200"),children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:m("text-sm font-semibold truncate",s?"text-slate-100":"text-gray-900"),children:"Recipients"}),e.jsxs("div",{className:m("text-[11px] truncate",s?"text-slate-500":"text-gray-500"),title:`to ${r}`,children:["to ",r]})]}),e.jsx("button",{type:"button",className:m("touch-target-sm min-w-[36px] min-h-[36px] flex items-center justify-center rounded-lg",s?"text-slate-400 hover:text-slate-200 hover:bg-slate-800":"text-gray-400 hover:text-gray-700 hover:bg-gray-100"),onClick:o,"aria-label":"Close",children:"Ã—"})]}),e.jsxs("div",{className:"p-4 sm:p-5 overflow-auto max-h-[70vh]",children:[a.length>0?e.jsx("div",{className:m("rounded-xl border divide-y",s?"border-slate-800 divide-slate-800 bg-slate-950/40":"border-gray-200 divide-gray-200 bg-gray-50"),children:a.map(([i,l])=>e.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[e.jsx("div",{className:m("text-sm font-medium truncate",s?"text-slate-200":"text-gray-800"),children:i}),e.jsx("div",{className:m("text-sm font-semibold tracking-tight",l?s?"text-emerald-400":"text-emerald-600":s?"text-slate-500":"text-gray-500"),"aria-label":l?"read":"pending",children:l?"âœ“âœ“":"âœ“"})]},i))}):e.jsx("div",{className:m("text-sm py-6 text-center",s?"text-slate-400":"text-gray-500"),children:"No recipient tracking for this message."}),e.jsx("div",{className:m("text-[11px] mt-3",s?"text-slate-500":"text-gray-500"),children:"Legend: âœ“ pending Â· âœ“âœ“ read"})]})]})]}):null}const Ft=t=>{let s;const n=new Set,r=(c,d)=>{const h=typeof c=="function"?c(s):c;if(!Object.is(h,s)){const g=s;s=d??(typeof h!="object"||h===null)?h:Object.assign({},s,h),n.forEach(j=>j(s,g))}},a=()=>s,l={setState:r,getState:a,getInitialState:()=>x,subscribe:c=>(n.add(c),()=>n.delete(c))},x=s=t(r,a,l);return l},Wr=(t=>t?Ft(t):Ft),Jr=t=>t;function qr(t,s=Jr){const n=ye.useSyncExternalStore(t.subscribe,ye.useCallback(()=>s(t.getState()),[t,s]),ye.useCallback(()=>s(t.getInitialState()),[t,s]));return ye.useDebugValue(n),n}const Ut=t=>{const s=Wr(t),n=r=>qr(s,r);return Object.assign(n,s),n},tt=(t=>t?Ut(t):Ut),zt=800;let $t=!1,Tt=!1;const Et=new Set,At=new Set,Ne=tt((t,s)=>({groups:[],selectedGroupId:"",groupDoc:null,events:[],actors:[],groupContext:null,groupSettings:null,runtimes:[],setGroups:n=>t({groups:n}),setSelectedGroupId:n=>t({selectedGroupId:n}),setGroupDoc:n=>t({groupDoc:n}),setEvents:n=>t({events:n}),appendEvent:n=>t(r=>{const a=r.events.concat([n]);return{events:a.length>zt?a.slice(a.length-zt):a}}),setActors:n=>t({actors:n}),setGroupContext:n=>t({groupContext:n}),setGroupSettings:n=>t({groupSettings:n}),setRuntimes:n=>t({runtimes:n}),updateReadStatus:(n,r)=>t(a=>{const o=a.events.findIndex(l=>l.kind==="chat.message"&&String(l.id||"")===n);if(o<0)return a;const i=a.events.slice();for(let l=0;l<=o;l++){const x=i[l];if(!x||x.kind!=="chat.message")continue;const c=x._read_status&&typeof x._read_status=="object"?{...x._read_status}:{};c[r]!==!0&&(c[r]=!0,i[l]={...x,_read_status:c})}return{events:i}}),refreshGroups:async()=>{if($t){Tt=!0;return}$t=!0;try{const n=await Ls();if(n.ok){const r=n.result.groups||[];t({groups:r});const a=s().selectedGroupId;!(!!a&&r.some(i=>String(i.group_id||"")===a))&&r.length>0&&t({selectedGroupId:String(r[0].group_id||"")})}}catch{}finally{$t=!1,Tt&&(Tt=!1,s().refreshGroups())}},refreshActors:async n=>{const r=String(n||s().selectedGroupId||"").trim();if(r){if(Et.has(r)){At.add(r);return}Et.add(r);try{const a=await _t(r);a.ok&&s().selectedGroupId===r&&t({actors:a.result.actors||[]})}catch{}finally{Et.delete(r),At.has(r)&&(At.delete(r),s().refreshActors(r))}}},loadGroup:async n=>{const[r,a,o,i,l]=await Promise.all([Ms(n),zs(n),_t(n),ts(n),ss(n)]);t({groupDoc:r.ok?r.result.group:null,events:a.ok?(a.result.events||[]).filter(x=>x&&x.kind!=="context.sync"):[],actors:o.ok?o.result.actors||[]:[],groupContext:i.ok?i.result:null,groupSettings:l.ok&&l.result.settings?l.result.settings:null})}}));let Ge=null;const st=tt(t=>({activeTab:"chat",busy:"",errorMsg:"",isTransitioning:!1,sidebarOpen:!0,showScrollButton:!1,chatUnreadCount:0,isSmallScreen:!1,setActiveTab:s=>t({activeTab:s}),setBusy:s=>t({busy:s}),setError:s=>t({errorMsg:s}),showError:s=>{Ge&&window.clearTimeout(Ge),t({errorMsg:s}),Ge=window.setTimeout(()=>{t({errorMsg:""}),Ge=null},8e3)},dismissError:()=>{Ge&&(window.clearTimeout(Ge),Ge=null),t({errorMsg:""})},setTransitioning:s=>t({isTransitioning:s}),setSidebarOpen:s=>t({sidebarOpen:s}),setShowScrollButton:s=>t({showScrollButton:s}),setChatUnreadCount:s=>t({chatUnreadCount:s}),incrementChatUnread:()=>t(s=>({chatUnreadCount:s.chatUnreadCount+1})),setSmallScreen:s=>t({isSmallScreen:s})})),Mt=tt(t=>({modals:{context:!1,settings:!1,search:!1,addActor:!1,createGroup:!1,groupEdit:!1,inbox:!1,mobileMenu:!1},recipientsEventId:null,editingActor:null,openModal:s=>t(n=>({modals:{...n.modals,[s]:!0}})),closeModal:s=>t(n=>({modals:{...n.modals,[s]:!1}})),setRecipientsModal:s=>t({recipientsEventId:s}),setEditingActor:s=>t({editingActor:s})})),ps=tt(t=>({composerText:"",composerFiles:[],toText:"",replyTarget:null,setComposerText:s=>t(n=>({composerText:typeof s=="function"?s(n.composerText):s})),setComposerFiles:s=>t({composerFiles:s}),appendComposerFiles:s=>t(n=>{const r=i=>`${i.name}:${i.size}:${i.lastModified}`,a=new Set(n.composerFiles.map(r)),o=n.composerFiles.slice();for(const i of s){const l=r(i);a.has(l)||(a.add(l),o.push(i))}return{composerFiles:o}}),setToText:s=>t({toText:s}),setReplyTarget:s=>t({replyTarget:s}),clearComposer:()=>t({composerText:"",composerFiles:[],toText:"",replyTarget:null})})),fs=tt(t=>({inboxActorId:"",inboxMessages:[],setInboxActorId:s=>t({inboxActorId:s}),setInboxMessages:s=>t({inboxMessages:s}),clearInbox:()=>t({inboxActorId:"",inboxMessages:[]})})),ys=tt(t=>({editGroupTitle:"",editGroupTopic:"",editActorRuntime:"codex",editActorCommand:"",editActorTitle:"",newActorId:"",newActorRole:"peer",newActorRuntime:"codex",newActorCommand:"",showAdvancedActor:!1,addActorError:"",createGroupPath:"",createGroupName:"",dirItems:[],dirSuggestions:[],currentDir:"",parentDir:null,showDirBrowser:!1,setEditGroupTitle:s=>t({editGroupTitle:s}),setEditGroupTopic:s=>t({editGroupTopic:s}),setEditActorRuntime:s=>t({editActorRuntime:s}),setEditActorCommand:s=>t({editActorCommand:s}),setEditActorTitle:s=>t({editActorTitle:s}),setNewActorId:s=>t({newActorId:s}),setNewActorRole:s=>t({newActorRole:s}),setNewActorRuntime:s=>t({newActorRuntime:s}),setNewActorCommand:s=>t({newActorCommand:s}),setShowAdvancedActor:s=>t({showAdvancedActor:s}),setAddActorError:s=>t({addActorError:s}),resetAddActorForm:()=>t({newActorId:"",newActorCommand:"",newActorRole:"peer",showAdvancedActor:!1,addActorError:""}),setCreateGroupPath:s=>t({createGroupPath:s}),setCreateGroupName:s=>t({createGroupName:s}),setDirItems:s=>t({dirItems:s}),setDirSuggestions:s=>t({dirSuggestions:s}),setCurrentDir:s=>t({currentDir:s}),setParentDir:s=>t({parentDir:s}),setShowDirBrowser:s=>t({showDirBrowser:s}),resetCreateGroupForm:()=>t({createGroupPath:"",createGroupName:"",dirItems:[],showDirBrowser:!1})}));function Vr({isDark:t,composerRef:s,messageMeta:n,onStartReply:r,onThemeToggle:a,onStartGroup:o,onStopGroup:i,onSetGroupState:l,fetchContext:x}){const{selectedGroupId:c,groupDoc:d,actors:h,groupContext:g,groupSettings:j,runtimes:N,setSelectedGroupId:y,setGroupDoc:b,setGroupContext:M,setGroupSettings:v,refreshGroups:f,refreshActors:T,loadGroup:k}=Ne(),{busy:O,isSmallScreen:U,setBusy:p,showError:w,setActiveTab:E}=st(),{modals:S,recipientsEventId:z,editingActor:J,openModal:A,closeModal:R,setRecipientsModal:B,setEditingActor:q}=Mt(),{inboxActorId:V,inboxMessages:Y,setInboxMessages:X}=fs(),{editGroupTitle:Q,editGroupTopic:oe,setEditGroupTitle:ne,setEditGroupTopic:ie,editActorRuntime:we,editActorCommand:xe,editActorTitle:Ce,setEditActorRuntime:C,setEditActorCommand:D,newActorId:ce,newActorRole:We,newActorRuntime:re,newActorCommand:me,showAdvancedActor:Je,addActorError:he,setNewActorId:ve,setNewActorRole:qe,setNewActorRuntime:Se,setNewActorCommand:$e,setShowAdvancedActor:Te,setAddActorError:Oe,resetAddActorForm:ae,createGroupPath:Ee,createGroupName:Ie,dirItems:Ae,dirSuggestions:Ve,currentDir:rt,parentDir:He,showDirBrowser:nt,setCreateGroupPath:Ke,setCreateGroupName:at,setDirItems:_e,setCurrentDir:lt,setParentDir:Re,setShowDirBrowser:ot,resetCreateGroupForm:Pe}=ys(),ge=Ne(I=>{var F;return((F=I.groups.find(W=>String(W.group_id||"")===I.selectedGroupId))==null?void 0:F.running)??!1}),Ye=h.some(I=>I.role==="foreman"),ke=async I=>{if(c){p("context-update");try{const F=await Ks(c,I);F.ok||w(`${F.error.code}: ${F.error.message}`),x(c)}finally{p("")}}},it=async I=>{if(c){p("context-update");try{const F=await Ys(c,I);F.ok||w(`${F.error.code}: ${F.error.message}`),x(c)}finally{p("")}}},Qe=async I=>{if(c){p("settings-update");try{const F=await Qs(c,I);F.ok||w(`${F.error.code}: ${F.error.message}`);const W=await ss(c);W.ok&&W.result.settings&&v(W.result.settings)}finally{p("")}}},Le=async()=>{if(!c||!V)return;const I=Y.length?Y[Y.length-1]:null,F=I!=null&&I.id?String(I.id):"";if(F){p(`inbox-read:${V}`);try{const W=await Xs(c,V,F);if(!W.ok){w(`${W.error.code}: ${W.error.message}`);return}const ee=await rs(c,V);ee.ok&&X(ee.result.messages||[])}finally{p("")}}},ct=async()=>{if(c){p("group-update");try{const I=await Is(c,Q,oe);if(!I.ok){w(`${I.error.code}: ${I.error.message}`);return}R("groupEdit"),await f(),await k(c)}finally{p("")}}},ue=async()=>{if(c&&window.confirm(`Delete group "${(d==null?void 0:d.title)||c}"?`)){p("group-delete");try{const I=await Ps(c);if(!I.ok){w(`${I.error.code}: ${I.error.message}`);return}y(""),b(null),Ne.getState().setEvents([]),Ne.getState().setActors([]),M(null),v(null),await f()}finally{p("")}}},Be=async()=>{if(!(!c||!J)){p("actor-update");try{const I=await Ws(c,J.id,we,xe,Ce);if(!I.ok){w(`${I.error.code}: ${I.error.message}`);return}q(null),await T()}finally{p("")}}},be=async I=>{var W;ot(!0);const F=await sr(I);F.ok?(_e(F.result.items||[]),lt(F.result.path||I),Re(F.result.parent||null)):w(((W=F.error)==null?void 0:W.message)||"Failed to list directory")},pe=async()=>{const I=Ee.trim();if(!I)return;const F=I.split("/").filter(Boolean).pop()||"working-group",W=Ie.trim()||F;p("create");try{const ee=await Os(W);if(!ee.ok){w(`${ee.error.code}: ${ee.error.message}`);return}const ze=ee.result.group_id,Xe=await ks(ze,I);Xe.ok||w(`Created group but failed to attach: ${Xe.error.message}`),Pe(),R("createGroup"),await f(),y(ze)}finally{p("")}},Fe=async()=>{var F;if(!c)return;const I=ce.trim();p("actor-add"),Oe("");try{const W=await Gs(c,I,We,re,me);if(!W.ok){Oe(((F=W.error)==null?void 0:F.message)||"Failed to add agent");return}R("addActor"),ae(),await T()}finally{p("")}},Ue=(()=>{const I=re,F=new Set(h.map(W=>String(W.id||"")));for(let W=1;W<=999;W++){const ee=`${I}-${W}`;if(!F.has(ee))return ee}return`${I}-${Date.now()}`})(),dt=(()=>{if(O==="actor-add")return!1;const I=N.find(W=>W.name===re),F=(I==null?void 0:I.available)??!1;return!(re==="custom"&&!me.trim()||!F&&!me.trim())})(),Z=(()=>{var W;if(O==="actor-add")return"";const I=N.find(ee=>ee.name===re),F=(I==null?void 0:I.available)??!1;return re==="custom"&&!me.trim()?"Custom runtime requires a command.":!F&&!me.trim()?`${((W=mt[re])==null?void 0:W.label)||re} is not installed.`:""})();return e.jsxs(e.Fragment,{children:[e.jsx(Mr,{isOpen:S.mobileMenu,isDark:t,selectedGroupId:c,groupDoc:d,selectedGroupRunning:ge,actors:h,busy:O,onClose:()=>R("mobileMenu"),onToggleTheme:a,onOpenSearch:()=>A("search"),onOpenContext:()=>{c&&x(c),A("context")},onOpenSettings:()=>A("settings"),onOpenGroupEdit:()=>{d&&(ne(d.title||""),ie(d.topic||""),A("groupEdit"))},onStartGroup:o,onStopGroup:i,onSetGroupState:l}),e.jsx($r,{isOpen:S.search,onClose:()=>R("search"),groupId:c,actors:h,isDark:t,onReply:I=>{r(I),E("chat"),R("search"),window.setTimeout(()=>{var F;return(F=s.current)==null?void 0:F.focus()},0)}}),e.jsx(br,{isOpen:S.context,onClose:()=>R("context"),groupId:c,context:g,onUpdateVision:ke,onUpdateSketch:it,busy:O==="context-update",isDark:t}),e.jsx(Nr,{isOpen:S.settings,onClose:()=>R("settings"),settings:j,onUpdateSettings:Qe,busy:O.startsWith("settings"),isDark:t,groupId:c}),e.jsx(Gr,{isOpen:!!n,isDark:t,isSmallScreen:U,toLabel:(n==null?void 0:n.toLabel)||"",entries:(n==null?void 0:n.entries)||[],onClose:()=>B(null)}),e.jsx(zr,{isOpen:S.inbox,isDark:t,actorId:V,messages:Y,busy:O,onClose:()=>R("inbox"),onMarkAllRead:Le}),e.jsx(Fr,{isOpen:S.groupEdit,isDark:t,busy:O,title:Q,topic:oe,onChangeTitle:ne,onChangeTopic:ie,onSave:ct,onCancel:()=>R("groupEdit"),onDelete:ue}),e.jsx(Br,{isOpen:!!J,isDark:t,busy:O,actorId:(J==null?void 0:J.id)||"",runtimes:N,runtime:we,onChangeRuntime:C,command:xe,onChangeCommand:D,onSave:Be,onCancel:()=>q(null)}),e.jsx(kr,{isOpen:S.createGroup,isDark:t,busy:O,dirSuggestions:Ve,dirItems:Ae,currentDir:rt,parentDir:He,showDirBrowser:nt,createGroupPath:Ee,setCreateGroupPath:Ke,createGroupName:Ie,setCreateGroupName:at,onFetchDirContents:be,onCreateGroup:pe,onClose:()=>R("createGroup"),onCancelAndReset:()=>{R("createGroup"),Pe()}}),e.jsx(Pr,{isOpen:S.addActor,isDark:t,busy:O,hasForeman:Ye,runtimes:N,suggestedActorId:Ue,newActorId:ce,setNewActorId:ve,newActorRole:We,setNewActorRole:qe,newActorRuntime:re,setNewActorRuntime:Se,newActorCommand:me,setNewActorCommand:$e,showAdvancedActor:Je,setShowAdvancedActor:Te,addActorError:he,setAddActorError:Oe,canAddActor:dt,addActorDisabledReason:Z,onAddActor:Fe,onClose:()=>R("addActor"),onCancelAndReset:()=>{R("addActor"),ae()}})]})}function Hr({theme:t,onThemeChange:s,isDark:n}){const r=()=>t==="light"?"dark":t==="dark"?"system":"light",a=t==="light"?xs:t==="dark"?us:Lr,o=t==="light"?"Light":t==="dark"?"Dark":"System";return e.jsx("button",{onClick:()=>s(r()),className:m("flex items-center justify-center w-9 h-9 rounded-xl transition-all min-h-[44px] min-w-[44px] glass-btn",n?"text-slate-300":"text-gray-600"),title:`Theme: ${o}. Click to change.`,"aria-label":`Current theme: ${o}. Click to cycle through themes.`,children:e.jsx(a,{size:18})})}function Kr({isDark:t,theme:s,onThemeChange:n,selectedGroupId:r,groupDoc:a,selectedGroupRunning:o,actors:i,busy:l,errorMsg:x,onDismissError:c,onOpenSidebar:d,onOpenGroupEdit:h,onOpenContext:g,onStartGroup:j,onStopGroup:N,onSetGroupState:y,onOpenSettings:b,onOpenMobileMenu:M}){return e.jsxs("header",{className:"flex-shrink-0 z-20 px-4 h-14 flex items-center justify-between gap-3 glass-header",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{className:m("md:hidden p-2 -ml-2 rounded-xl transition-all glass-btn",t?"text-slate-400 hover:text-white":"text-gray-500 hover:text-gray-900"),onClick:d,"aria-label":"Open sidebar",children:e.jsx(Ar,{size:18})}),e.jsx("div",{className:"min-w-0 flex flex-col",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:`text-sm font-semibold truncate ${t?"text-slate-100":"text-gray-900"}`,children:(a==null?void 0:a.title)||r||"Select a group"}),r&&a&&(()=>{const v=t?ft(o,a.state):yt(o,a.state);return e.jsx("span",{className:`w-2 h-2 rounded-full ${v.colorClass.replace("text-","bg-").split(" ")[0]}`,title:v.label})})()]})}),r&&e.jsx("button",{className:m("hidden sm:inline-flex items-center justify-center gap-1 text-xs px-2.5 py-1.5 rounded-xl transition-all glass-btn",t?"text-slate-200":"text-gray-700"),onClick:h,title:"Edit group","aria-label":"Edit group",children:e.jsx(cs,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-1.5 mr-2",children:[e.jsxs("button",{onClick:g,disabled:!r,className:m("p-2 rounded-xl transition-all glass-btn",t?"text-slate-400 hover:text-white":"text-gray-400 hover:text-gray-900"),title:"Context (Clipboard)",children:[e.jsx("span",{className:"sr-only",children:"Context"}),e.jsx(as,{size:18})]}),e.jsx("div",{className:`w-px h-4 mx-1 ${t?"bg-white/10":"bg-black/10"}`}),e.jsxs("button",{onClick:j,disabled:!r||l==="group-start"||i.length===0,className:m("p-2 rounded-xl transition-all",t?"text-emerald-400 hover:bg-emerald-500/15 glass-btn":"text-emerald-600 hover:bg-emerald-50/80 glass-btn"),title:"Launch All Agents",children:[e.jsx("span",{className:"sr-only",children:"Launch"}),e.jsx(Tr,{size:18})]}),(a==null?void 0:a.state)==="paused"?e.jsxs("button",{onClick:()=>void y("active"),disabled:!r||l==="group-state",className:m("p-2 rounded-xl transition-all glass-btn",t?"text-amber-400":"text-amber-600"),title:"Resume Delivery",children:[e.jsx("span",{className:"sr-only",children:"Resume"}),e.jsx(Rt,{size:18})]}):e.jsxs("button",{onClick:()=>void y("paused"),disabled:!r||l==="group-state",className:m("p-2 rounded-xl transition-all glass-btn",t?"text-slate-400 hover:text-amber-300":"text-gray-400 hover:text-amber-600"),title:"Pause Delivery",children:[e.jsx("span",{className:"sr-only",children:"Pause"}),e.jsx(ls,{size:18})]}),e.jsxs("button",{onClick:N,disabled:!r||l==="group-stop",className:m("p-2 rounded-xl transition-all glass-btn",t?"text-slate-400 hover:text-rose-400":"text-gray-400 hover:text-rose-600"),title:"Stop All Agents",children:[e.jsx("span",{className:"sr-only",children:"Stop"}),e.jsx(os,{size:18})]}),e.jsx("div",{className:`w-px h-4 mx-1 ${t?"bg-white/10":"bg-black/10"}`})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(Hr,{theme:s,onThemeChange:n,isDark:t})}),e.jsx("button",{onClick:b,disabled:!r,className:m("hidden sm:flex p-2 rounded-xl transition-all glass-btn",t?"text-slate-400 hover:text-slate-200":"text-gray-400 hover:text-gray-600"),title:"Settings",children:e.jsx(is,{size:18})}),e.jsx("button",{className:m("sm:hidden flex items-center justify-center w-8 h-8 rounded-xl transition-all glass-btn",t?"text-slate-400":"text-gray-400"),onClick:M,title:"Menu",children:e.jsx(Er,{size:18})})]}),x&&e.jsx("div",{className:"absolute top-16 left-1/2 -translate-x-1/2 z-50 animate-slide-up",children:e.jsxs("div",{className:m("rounded-2xl px-4 py-2.5 text-sm flex items-center gap-3 glass-modal",t?"border-rose-500/20 text-rose-300":"border-rose-200/50 text-rose-700"),role:"alert",children:[e.jsx("span",{children:x}),e.jsx("button",{className:m("p-1 rounded-lg transition-all glass-btn",t?"text-rose-400":"text-rose-600"),onClick:c,children:"Ã—"})]})})]})}function Yr({groups:t,selectedGroupId:s,isOpen:n,isDark:r,onSelectGroup:a,onCreateGroup:o,onClose:i}){return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:m("h-full flex flex-col glass-sidebar","fixed md:relative z-40 w-[280px] transition-all duration-300 ease-out",n?"translate-x-0":"-translate-x-full","md:translate-x-0"),children:[e.jsx("div",{className:`p-4 border-b ${r?"border-white/5":"border-black/5"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:m("w-9 h-9 rounded-xl flex items-center justify-center glass-btn",r?"text-cyan-400":"text-cyan-600"),children:e.jsx("img",{src:"/ui/logo.svg",alt:"CCCC Logo",className:"w-6 h-6 object-contain"})}),e.jsx("span",{className:`text-lg font-bold tracking-tight ${r?"text-white":"text-gray-900"}`,children:"CCCC"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:m("text-xs px-4 py-2 rounded-xl font-medium transition-all min-h-[36px] glass-btn-accent",r?"text-cyan-300":"text-cyan-700"),onClick:o,title:"Create new working group","aria-label":"Create new working group",children:"+ New"}),e.jsx("button",{className:m("md:hidden p-2 min-w-[44px] min-h-[44px] flex items-center justify-center rounded-xl transition-all glass-btn",r?"text-slate-400 hover:text-white":"text-gray-500 hover:text-gray-900"),onClick:i,"aria-label":"Close sidebar",children:e.jsx(ds,{size:18})})]})]})}),e.jsxs("div",{className:"flex-1 overflow-auto p-3",children:[e.jsx("div",{className:`text-[10px] font-medium uppercase tracking-wider mb-3 px-2 ${r?"text-slate-500":"text-gray-500"}`,children:"Working Groups"}),e.jsx("div",{className:"space-y-1.5",children:t.map(l=>{const x=String(l.group_id||""),c=x===s;return e.jsx("button",{className:m("w-full text-left px-3 py-2.5 rounded-xl transition-all min-h-[44px] group",c?"glass-btn-accent glow-pulse":"glass-btn hover:translate-x-1"),onClick:()=>{a(x),window.matchMedia("(max-width: 767px)").matches&&i()},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:m("text-sm font-medium truncate",c?r?"text-cyan-300":"text-cyan-700":r?"text-slate-300 group-hover:text-white":"text-gray-700 group-hover:text-gray-900"),children:l.title||x}),(()=>{const d=r?ft(l.running??!1,l.state):yt(l.running??!1,l.state);return e.jsx("div",{className:m("text-[9px] px-2 py-0.5 rounded-full font-medium backdrop-blur-sm",d.colorClass),children:d.label})})()]})},x)})}),!t.length&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:m("w-16 h-16 mx-auto mb-4 rounded-2xl flex items-center justify-center glass-card",r?"text-slate-400":"text-gray-400"),children:e.jsx(Rr,{size:32})}),e.jsx("div",{className:`text-sm mb-2 font-medium ${r?"text-slate-300":"text-gray-700"}`,children:"No working groups yet"}),e.jsx("div",{className:`text-xs mb-5 max-w-[200px] mx-auto leading-relaxed ${r?"text-slate-500":"text-gray-500"}`,children:"A working group is a collaboration space where multiple AI agents work together on a project."}),e.jsx("button",{className:m("text-sm px-5 py-2.5 rounded-xl font-medium min-h-[44px] transition-all glass-btn-accent",r?"text-cyan-300":"text-cyan-700"),onClick:o,children:"Create Your First Group"})]})]})]}),n&&e.jsx("div",{className:"fixed inset-0 z-30 md:hidden glass-overlay animate-fade-in",onClick:i,"aria-hidden":"true"})]})}const vs="cccc-theme";function js(){return typeof window>"u"||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Qr(){if(typeof window>"u")return"system";const t=localStorage.getItem(vs);return t==="light"||t==="dark"||t==="system"?t:"system"}function Xr(t){const s=document.documentElement,n=t==="system"?js():t;s.classList.remove("light","dark"),s.classList.add(n);const r=document.querySelector('meta[name="theme-color"]');r&&r.setAttribute("content",n==="dark"?"#020617":"#f8fafc")}function Zr(t){const s=window.matchMedia("(prefers-color-scheme: dark)");return s.addEventListener("change",t),()=>s.removeEventListener("change",t)}function Dr(){const[t,s]=u.useState(Qr),n=u.useSyncExternalStore(Zr,js,()=>"dark"),r=u.useMemo(()=>t==="system"?n:t,[t,n]);u.useEffect(()=>{Xr(t),localStorage.setItem(vs,t)},[t,n]);const a=u.useCallback(i=>{s(i)},[]),o=u.useCallback(()=>{s(i=>i==="light"?"dark":i==="dark"?"system":"light")},[]);return{theme:t,resolvedTheme:r,setTheme:a,toggleTheme:o,isDark:r==="dark"}}function kn(t){return{background:t?"#0f172a":"#fafafa",foreground:t?"#e2e8f0":"#1e293b",cursor:t?"#e2e8f0":"#1e293b",cursorAccent:t?"#0f172a":"#fafafa",selectionBackground:t?"#334155":"#bfdbfe",black:t?"#1e293b":"#64748b",red:t?"#f87171":"#dc2626",green:t?"#4ade80":"#16a34a",yellow:t?"#facc15":"#ca8a04",blue:t?"#60a5fa":"#2563eb",magenta:t?"#c084fc":"#9333ea",cyan:t?"#22d3ee":"#0891b2",white:"#f1f5f9",brightBlack:t?"#475569":"#94a3b8",brightRed:t?"#fca5a5":"#ef4444",brightGreen:t?"#86efac":"#22c55e",brightYellow:t?"#fde047":"#eab308",brightBlue:t?"#93c5fd":"#3b82f6",brightMagenta:t?"#d8b4fe":"#a855f7",brightCyan:t?"#67e8f9":"#06b6d4",brightWhite:"#f8fafc"}}function en(t){const{refreshActors:s,loadGroup:n}=Ne(),{setBusy:r,setActiveTab:a,showError:o}=st(),{openModal:i,setEditingActor:l}=Mt(),{setInboxActorId:x,setInboxMessages:c}=fs(),[d,h]=u.useState({}),g=u.useCallback(async v=>{if(!v||!t)return;const f=v.running??v.enabled??!1;r(`actor-${f?"stop":"start"}:${v.id}`);try{const T=f?await Vs(t,v.id):await qs(t,v.id);if(!T.ok){o(`${T.error.code}: ${T.error.message}`);return}await s()}finally{r("")}},[t,r,o,s]),j=u.useCallback(async v=>{if(!(!t||!v)){r(`actor-relaunch:${v.id}`);try{const f=await Hs(t,v.id);f.ok||o(`${f.error.code}: ${f.error.message}`),await s(),h(T=>({...T,[v.id]:(T[v.id]||0)+1}))}finally{r("")}}},[t,r,o,s]),N=u.useCallback(v=>{if(!v)return;if(v.running??v.enabled??!1){o("Stop the actor before editing.");return}l(v)},[l,o]),y=u.useCallback(async(v,f)=>{if(!(!v||!t)&&window.confirm(`Remove actor ${v.id}?`)){r(`actor-remove:${v.id}`);try{const T=await Js(t,v.id);if(!T.ok){o(`${T.error.code}: ${T.error.message}`);return}f===v.id&&a("chat"),await s(),await n(t)}finally{r("")}}},[t,r,o,s,n,a]),b=u.useCallback(async v=>{if(!(!v||!t)){r(`inbox:${v.id}`);try{x(v.id),c([]),i("inbox");const f=await rs(t,v.id);if(!f.ok){o(`${f.error.code}: ${f.error.message}`);return}c(f.result.messages||[])}finally{r("")}}},[t,r,o,x,c,i]),M=u.useCallback(v=>d[v]||0,[d]);return{termEpochByActor:d,getTermEpoch:M,toggleActorEnabled:g,relaunchActor:j,editActor:N,removeActor:y,openActorInbox:b}}function Ns(t,s){if(!s.length)return[];const n=s.map(d=>String(d.id||"")).filter(d=>d),r=new Set(n),a=t.data,i=(a&&Array.isArray(a.to)?a.to:[]).map(d=>String(d||"").trim()).filter(d=>d.length>0),l=new Set(i),x=String(t.by||"").trim();if(l.size===0||l.has("@all"))return n.filter(d=>d!==x);const c=new Set;for(const d of l)if(!(d==="user"||d==="@user")){if(d==="@peers"){for(const h of s)h.role==="peer"&&c.add(String(h.id));continue}if(d==="@foreman"){for(const h of s)h.role==="foreman"&&c.add(String(h.id));continue}r.has(d)&&c.add(d)}return c.delete(x),Array.from(c)}function tn({activeTabRef:t,chatAtBottomRef:s,actorsRef:n}){const{selectedGroupId:r,appendEvent:a,updateReadStatus:o,setGroupContext:i,refreshActors:l}=Ne(),{incrementChatUnread:x}=st(),c=u.useRef(null),d=u.useRef(null),h=u.useRef([]),g=u.useRef("");u.useEffect(()=>{g.current=r},[r]);async function j(v){const f=await ts(v);f.ok&&f.result&&typeof f.result=="object"&&i(f.result)}function N(v){c.current&&(c.current.close(),c.current=null);const f=new EventSource(`/api/v1/groups/${encodeURIComponent(v)}/ledger/stream`);f.addEventListener("ledger",T=>{var O,U;const k=T;try{const p=JSON.parse(String(k.data||"{}"));if(p&&typeof p=="object"&&p.kind==="context.sync"){d.current&&window.clearTimeout(d.current),d.current=window.setTimeout(()=>{d.current=null,j(v)},150);return}if(p&&typeof p=="object"&&p.kind==="chat.read"){const E=String(((O=p.data)==null?void 0:O.actor_id)||""),S=String(((U=p.data)==null?void 0:U.event_id)||"");E&&S&&o(S,E),l(v);return}if(p&&typeof p=="object"&&p.kind==="chat.message"&&!p._read_status){const E=Ns(p,n.current);if(E.length>0){const S={};for(const z of E)S[z]=!1;p._read_status=S}}if(a(p),p&&typeof p=="object"&&p.kind==="chat.message"){const E=String(p.by||"");if(E&&E!=="user"){const S=t.current==="chat",z=s.current;(!S||!z)&&x()}}const w=String(p.kind||"");(w==="chat.message"||w==="chat.read"||w.startsWith("actor.")||w==="group.start"||w==="group.stop"||w==="group.set_state")&&l(v)}catch{}}),c.current=f}function y(){for(const v of h.current)window.clearTimeout(v);h.current=[]}function b(v){const f=String(v||"").trim();if(!f)return;y();const T=[1e3,2500,5e3,1e4,15e3];for(const k of T){const O=window.setTimeout(()=>{g.current===f&&l(f)},k);h.current.push(O)}}function M(){c.current&&(c.current.close(),c.current=null),d.current&&(window.clearTimeout(d.current),d.current=null),y()}return{connectStream:N,fetchContext:j,scheduleActorWarmupRefresh:b,clearActorWarmupTimers:y,cleanup:M,contextRefreshTimerRef:d}}const Lt=20,Gt=Lt*1024*1024;function sn({selectedGroupId:t}){const{showError:s}=st(),{appendComposerFiles:n}=ps(),[r,a]=u.useState(!1),o=u.useRef(0),i=u.useCallback(x=>{const c=Array.from(x||[]);if(c.length===0)return;const d=c.filter(g=>g.size>Gt),h=c.filter(g=>g.size<=Gt);if(d.length>0){const g=d.slice(0,3).map(N=>N.name||"file"),j=d.length>3?` (+${d.length-3} more)`:"";s(`File too large (> ${Lt}MB): ${g.join(", ")}${j}`)}h.length>0&&n(h)},[s,n]);u.useEffect(()=>{const x=j=>{const N=j.dataTransfer;if(!N)return!1;try{if(N.types&&Array.from(N.types).includes("Files")||N.items&&Array.from(N.items).some(y=>y.kind==="file"))return!0}catch{}return N.files&&N.files.length>0},c=j=>{x(j)&&(j.preventDefault(),o.current+=1,a(!0))},d=j=>{x(j)&&j.preventDefault()},h=j=>{x(j)&&(o.current=Math.max(0,o.current-1),o.current===0&&a(!1))},g=j=>{var y;if(!x(j))return;j.preventDefault(),o.current=0,a(!1);const N=Array.from(((y=j.dataTransfer)==null?void 0:y.files)||[]);if(N.length!==0){if(!t){s("Select a group to attach files.");return}i(N)}};return window.addEventListener("dragenter",c,!0),window.addEventListener("dragover",d,!0),window.addEventListener("dragleave",h,!0),window.addEventListener("drop",g,!0),()=>{window.removeEventListener("dragenter",c,!0),window.removeEventListener("dragover",d,!0),window.removeEventListener("dragleave",h,!0),window.removeEventListener("drop",g,!0)}},[i,t,s]);const l=u.useCallback(()=>{o.current=0,a(!1)},[]);return{dropOverlayOpen:r,handleAppendComposerFiles:i,resetDragDrop:l,WEB_MAX_FILE_MB:Lt}}function rn(){const{selectedGroupId:t,groupDoc:s,setGroupDoc:n,refreshGroups:r,refreshActors:a}=Ne(),{setBusy:o,showError:i}=st(),l=u.useCallback(async()=>{if(t){o("group-start");try{const d=await Bs(t);if(!d.ok){i(`${d.error.code}: ${d.error.message}`);return}await a(),await r()}finally{o("")}}},[t,o,i,a,r]),x=u.useCallback(async()=>{if(t){o("group-stop");try{const d=await Fs(t);if(!d.ok){i(`${d.error.code}: ${d.error.message}`);return}await a(),await r()}finally{o("")}}},[t,o,i,a,r]),c=u.useCallback(async d=>{if(t){o("group-state");try{const h=await Us(t,d);h.ok?(n(s?{...s,state:d}:null),await r()):i(`${h.error.code}: ${h.error.message}`)}finally{o("")}}},[t,s,o,i,n,r]);return{handleStartGroup:l,handleStopGroup:x,handleSetGroupState:c}}function nn({tabs:t,activeTab:s,onTabChange:n,minSwipeDistance:r=50,swipeRatio:a=1.5}){const o=u.useRef(0),i=u.useRef(0),l=u.useCallback(c=>{o.current=c.touches[0].clientX,i.current=c.touches[0].clientY},[]),x=u.useCallback(c=>{const d=c.changedTouches[0].clientX,h=c.changedTouches[0].clientY,g=d-o.current,j=h-i.current;if(Math.abs(g)>r&&Math.abs(g)>Math.abs(j)*a){const N=t.indexOf(s);g>0&&N>0?n(t[N-1]):g<0&&N<t.length-1&&n(t[N+1])}},[t,s,n,r,a]);return{handleTouchStart:l,handleTouchEnd:x}}const an="modulepreload",ln=function(t){return"/ui/"+t},Wt={},on=function(s,n,r){let a=Promise.resolve();if(n&&n.length>0){let i=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),x=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=i(n.map(c=>{if(c=ln(c),c in Wt)return;Wt[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":an,d||(g.as="script"),g.crossOrigin="",g.href=c,x&&g.setAttribute("nonce",x),document.head.appendChild(g),d)return new Promise((j,N)=>{g.addEventListener("load",j),g.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return a.then(i=>{for(const l of i||[])l.status==="rejected"&&o(l.reason);return s().catch(o)})},cn=u.lazy(()=>on(()=>import("./chunk-AgentTab.js"),__vite__mapDeps([0,1,2])).then(t=>({default:t.AgentTab})));function dn({actor:t,groupId:s,termEpoch:n,busy:r,isDark:a,onToggleEnabled:o,onRelaunch:i,onEdit:l,onRemove:x,onInbox:c,onStatusChange:d}){return t?e.jsx(u.Suspense,{fallback:e.jsx("div",{className:`flex-1 flex items-center justify-center ${a?"text-slate-400":"text-gray-500"}`,children:"Loading agentâ€¦"}),children:e.jsx(cn,{actor:t,groupId:s,isVisible:!0,onQuit:o,onLaunch:o,onRelaunch:i,onEdit:l,onRemove:x,onInbox:c,busy:r,isDark:a,onStatusChange:d},`${s}:${t.id}:${n}`)}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-slate-500",children:"Agent not found"})}var xn=Zt();function Ze(t,s,n){let r=n.initialDeps??[],a,o=!0;function i(){var l,x,c;let d;n.key&&((l=n.debug)!=null&&l.call(n))&&(d=Date.now());const h=t();if(!(h.length!==r.length||h.some((N,y)=>r[y]!==N)))return a;r=h;let j;if(n.key&&((x=n.debug)!=null&&x.call(n))&&(j=Date.now()),a=s(...h),n.key&&((c=n.debug)!=null&&c.call(n))){const N=Math.round((Date.now()-d)*100)/100,y=Math.round((Date.now()-j)*100)/100,b=y/16,M=(v,f)=>{for(v=String(v);v.length<f;)v=" "+v;return v};console.info(`%câ± ${M(y,5)} /${M(N,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*b,120))}deg 100% 31%);`,n==null?void 0:n.key)}return n!=null&&n.onChange&&!(o&&n.skipInitialOnChange)&&n.onChange(a),o=!1,a}return i.updateDeps=l=>{r=l},i}function Jt(t,s){if(t===void 0)throw new Error("Unexpected undefined");return t}const un=(t,s)=>Math.abs(t-s)<1.01,mn=(t,s,n)=>{let r;return function(...a){t.clearTimeout(r),r=t.setTimeout(()=>s.apply(this,a),n)}},qt=t=>{const{offsetWidth:s,offsetHeight:n}=t;return{width:s,height:n}},hn=t=>t,gn=t=>{const s=Math.max(t.startIndex-t.overscan,0),n=Math.min(t.endIndex+t.overscan,t.count-1),r=[];for(let a=s;a<=n;a++)r.push(a);return r},bn=(t,s)=>{const n=t.scrollElement;if(!n)return;const r=t.targetWindow;if(!r)return;const a=i=>{const{width:l,height:x}=i;s({width:Math.round(l),height:Math.round(x)})};if(a(qt(n)),!r.ResizeObserver)return()=>{};const o=new r.ResizeObserver(i=>{const l=()=>{const x=i[0];if(x!=null&&x.borderBoxSize){const c=x.borderBoxSize[0];if(c){a({width:c.inlineSize,height:c.blockSize});return}}a(qt(n))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()});return o.observe(n,{box:"border-box"}),()=>{o.unobserve(n)}},Vt={passive:!0},Ht=typeof window>"u"?!0:"onscrollend"in window,pn=(t,s)=>{const n=t.scrollElement;if(!n)return;const r=t.targetWindow;if(!r)return;let a=0;const o=t.options.useScrollendEvent&&Ht?()=>{}:mn(r,()=>{s(a,!1)},t.options.isScrollingResetDelay),i=d=>()=>{const{horizontal:h,isRtl:g}=t.options;a=h?n.scrollLeft*(g&&-1||1):n.scrollTop,o(),s(a,d)},l=i(!0),x=i(!1);x(),n.addEventListener("scroll",l,Vt);const c=t.options.useScrollendEvent&&Ht;return c&&n.addEventListener("scrollend",x,Vt),()=>{n.removeEventListener("scroll",l),c&&n.removeEventListener("scrollend",x)}},fn=(t,s,n)=>{if(s!=null&&s.borderBoxSize){const r=s.borderBoxSize[0];if(r)return Math.round(r[n.options.horizontal?"inlineSize":"blockSize"])}return t[n.options.horizontal?"offsetWidth":"offsetHeight"]},yn=(t,{adjustments:s=0,behavior:n},r)=>{var a,o;const i=t+s;(o=(a=r.scrollElement)==null?void 0:a.scrollTo)==null||o.call(a,{[r.options.horizontal?"left":"top"]:i,behavior:n})};class vn{constructor(s){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let n=null;const r=()=>n||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:n=new this.targetWindow.ResizeObserver(a=>{a.forEach(o=>{const i=()=>{this._measureElement(o.target,o)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()})}));return{disconnect:()=>{var a;(a=r())==null||a.disconnect(),n=null},observe:a=>{var o;return(o=r())==null?void 0:o.observe(a,{box:"border-box"})},unobserve:a=>{var o;return(o=r())==null?void 0:o.unobserve(a)}}})(),this.range=null,this.setOptions=n=>{Object.entries(n).forEach(([r,a])=>{typeof a>"u"&&delete n[r]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:hn,rangeExtractor:gn,onChange:()=>{},measureElement:fn,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...n}},this.notify=n=>{var r,a;(a=(r=this.options).onChange)==null||a.call(r,this,n)},this.maybeNotify=Ze(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),n=>{this.notify(n)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(n=>n()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var n;const r=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==r){if(this.cleanup(),!r){this.maybeNotify();return}this.scrollElement=r,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((n=this.scrollElement)==null?void 0:n.window)??null,this.elementsCache.forEach(a=>{this.observer.observe(a)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,a=>{this.scrollRect=a,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(a,o)=>{this.scrollAdjustments=0,this.scrollDirection=o?this.getScrollOffset()<a?"forward":"backward":null,this.scrollOffset=a,this.isScrolling=o,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(n,r)=>{const a=new Map,o=new Map;for(let i=r-1;i>=0;i--){const l=n[i];if(a.has(l.lane))continue;const x=o.get(l.lane);if(x==null||l.end>x.end?o.set(l.lane,l):l.end<x.end&&a.set(l.lane,!0),a.size===this.options.lanes)break}return o.size===this.options.lanes?Array.from(o.values()).sort((i,l)=>i.end===l.end?i.index-l.index:i.end-l.end)[0]:void 0},this.getMeasurementOptions=Ze(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(n,r,a,o,i,l)=>(this.prevLanes!==void 0&&this.prevLanes!==l&&(this.lanesChangedFlag=!0),this.prevLanes=l,this.pendingMeasuredCacheIndexes=[],{count:n,paddingStart:r,scrollMargin:a,getItemKey:o,enabled:i,lanes:l}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=Ze(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:n,paddingStart:r,scrollMargin:a,getItemKey:o,enabled:i,lanes:l},x)=>{if(!i)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>n)for(const g of this.laneAssignments.keys())g>=n&&this.laneAssignments.delete(g);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(g=>{this.itemSizeCache.set(g.key,g.size)}));const c=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===n&&(this.lanesSettling=!1);const d=this.measurementsCache.slice(0,c),h=new Array(l).fill(void 0);for(let g=0;g<c;g++){const j=d[g];j&&(h[j.lane]=g)}for(let g=c;g<n;g++){const j=o(g),N=this.laneAssignments.get(g);let y,b;if(N!==void 0&&this.options.lanes>1){y=N;const T=h[y],k=T!==void 0?d[T]:void 0;b=k?k.end+this.options.gap:r+a}else{const T=this.options.lanes===1?d[g-1]:this.getFurthestMeasurement(d,g);b=T?T.end+this.options.gap:r+a,y=T?T.lane:g%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(g,y)}const M=x.get(j),v=typeof M=="number"?M:this.options.estimateSize(g),f=b+v;d[g]={index:g,start:b,size:v,end:f,key:j,lane:y},h[y]=g}return this.measurementsCache=d,d},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Ze(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(n,r,a,o)=>this.range=n.length>0&&r>0?jn({measurements:n,outerSize:r,scrollOffset:a,lanes:o}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Ze(()=>{let n=null,r=null;const a=this.calculateRange();return a&&(n=a.startIndex,r=a.endIndex),this.maybeNotify.updateDeps([this.isScrolling,n,r]),[this.options.rangeExtractor,this.options.overscan,this.options.count,n,r]},(n,r,a,o,i)=>o===null||i===null?[]:n({startIndex:o,endIndex:i,overscan:r,count:a}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=n=>{const r=this.options.indexAttribute,a=n.getAttribute(r);return a?parseInt(a,10):(console.warn(`Missing attribute name '${r}={index}' on measured element.`),-1)},this._measureElement=(n,r)=>{const a=this.indexFromElement(n),o=this.measurementsCache[a];if(!o)return;const i=o.key,l=this.elementsCache.get(i);l!==n&&(l&&this.observer.unobserve(l),this.observer.observe(n),this.elementsCache.set(i,n)),n.isConnected&&this.resizeItem(a,this.options.measureElement(n,r,this))},this.resizeItem=(n,r)=>{const a=this.measurementsCache[n];if(!a)return;const o=this.itemSizeCache.get(a.key)??a.size,i=r-o;i!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(a,i,this):a.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=i,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(a.index),this.itemSizeCache=new Map(this.itemSizeCache.set(a.key,r)),this.notify(!1))},this.measureElement=n=>{if(!n){this.elementsCache.forEach((r,a)=>{r.isConnected||(this.observer.unobserve(r),this.elementsCache.delete(a))});return}this._measureElement(n,void 0)},this.getVirtualItems=Ze(()=>[this.getVirtualIndexes(),this.getMeasurements()],(n,r)=>{const a=[];for(let o=0,i=n.length;o<i;o++){const l=n[o],x=r[l];a.push(x)}return a},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=n=>{const r=this.getMeasurements();if(r.length!==0)return Jt(r[ws(0,r.length-1,a=>Jt(r[a]).start,n)])},this.getOffsetForAlignment=(n,r,a=0)=>{const o=this.getSize(),i=this.getScrollOffset();r==="auto"&&(r=n>=i+o?"end":"start"),r==="center"?n+=(a-o)/2:r==="end"&&(n-=o);const l=this.getTotalSize()+this.options.scrollMargin-o;return Math.max(Math.min(l,n),0)},this.getOffsetForIndex=(n,r="auto")=>{n=Math.max(0,Math.min(n,this.options.count-1));const a=this.measurementsCache[n];if(!a)return;const o=this.getSize(),i=this.getScrollOffset();if(r==="auto")if(a.end>=i+o-this.options.scrollPaddingEnd)r="end";else if(a.start<=i+this.options.scrollPaddingStart)r="start";else return[i,r];const l=r==="end"?a.end+this.options.scrollPaddingEnd:a.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(l,r,a.size),r]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(n,{align:r="start",behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(n,r),{adjustments:void 0,behavior:a})},this.scrollToIndex=(n,{align:r="auto",behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),n=Math.max(0,Math.min(n,this.options.count-1));let o=0;const i=10,l=c=>{if(!this.targetWindow)return;const d=this.getOffsetForIndex(n,c);if(!d){console.warn("Failed to get offset for index:",n);return}const[h,g]=d;this._scrollToOffset(h,{adjustments:void 0,behavior:a}),this.targetWindow.requestAnimationFrame(()=>{const j=this.getScrollOffset(),N=this.getOffsetForIndex(n,g);if(!N){console.warn("Failed to get offset for index:",n);return}un(N[0],j)||x(g)})},x=c=>{this.targetWindow&&(o++,o<i?this.targetWindow.requestAnimationFrame(()=>l(c)):console.warn(`Failed to scroll to index ${n} after ${i} attempts.`))};l(r)},this.scrollBy=(n,{behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+n,{adjustments:void 0,behavior:r})},this.getTotalSize=()=>{var n;const r=this.getMeasurements();let a;if(r.length===0)a=this.options.paddingStart;else if(this.options.lanes===1)a=((n=r[r.length-1])==null?void 0:n.end)??0;else{const o=Array(this.options.lanes).fill(null);let i=r.length-1;for(;i>=0&&o.some(l=>l===null);){const l=r[i];o[l.lane]===null&&(o[l.lane]=l.end),i--}a=Math.max(...o.filter(l=>l!==null))}return Math.max(a-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(n,{adjustments:r,behavior:a})=>{this.options.scrollToFn(n,{behavior:a,adjustments:r},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(s)}}const ws=(t,s,n,r)=>{for(;t<=s;){const a=(t+s)/2|0,o=n(a);if(o<r)t=a+1;else if(o>r)s=a-1;else return a}return t>0?t-1:0};function jn({measurements:t,outerSize:s,scrollOffset:n,lanes:r}){const a=t.length-1,o=x=>t[x].start;if(t.length<=r)return{startIndex:0,endIndex:a};let i=ws(0,a,o,n),l=i;if(r===1)for(;l<a&&t[l].end<n+s;)l++;else if(r>1){const x=Array(r).fill(0);for(;l<a&&x.some(d=>d<n+s);){const d=t[l];x[d.lane]=d.end,l++}const c=Array(r).fill(n+s);for(;i>=0&&c.some(d=>d>=n);){const d=t[i];c[d.lane]=d.start,i--}i=Math.max(0,i-i%r),l=Math.min(a,l+(r-1-l%r))}return{startIndex:i,endIndex:l}}const Kt=typeof document<"u"?u.useLayoutEffect:u.useEffect;function Nn(t){const s=u.useReducer(()=>({}),{})[1],n={...t,onChange:(a,o)=>{var i;o?xn.flushSync(s):s(),(i=t.onChange)==null||i.call(t,a,o)}},[r]=u.useState(()=>new vn(n));return r.setOptions(n),Kt(()=>r._didMount(),[]),Kt(()=>r._willUpdate()),r}function wn(t){return Nn({observeElementRect:bn,observeElementOffset:pn,scrollToFn:yn,...t})}function Cn(t){return t.kind==="chat.message"&&t.data&&typeof t.data=="object"?String(t.data.text||""):""}const Sn=u.memo(function({event:s,actors:n,isDark:r,groupId:a,onReply:o,onShowRecipients:i}){const l=s.by==="user",x=l?null:Ir(String(s.by||""),r),c=s.data,d=c==null?void 0:c.quote_text,g=(Array.isArray(c==null?void 0:c.attachments)?c.attachments:[]).filter(f=>f!=null&&typeof f=="object").map(f=>({kind:String(f.kind||"file"),path:String(f.path||""),title:String(f.title||""),bytes:Number(f.bytes||0),mime_type:String(f.mime_type||"")})).filter(f=>f.path.startsWith("state/blobs/")),j=s._read_status,N=c==null?void 0:c.to,y=j?n.map(f=>String(f.id||"")).filter(f=>f&&Object.prototype.hasOwnProperty.call(j,f)).map(f=>[f,!!j[f]]):[],b=N&&N.length>0?N.join(", "):"@all",M=y.slice(0,3),v=Math.max(0,y.length-M.length);return e.jsxs("div",{className:m("flex gap-2 sm:gap-3 group",l?"flex-col items-end sm:items-start sm:flex-row-reverse":"flex-col items-start sm:flex-row"),children:[e.jsx("div",{className:m("hidden sm:flex flex-shrink-0 w-8 h-8 rounded-full items-center justify-center text-xs font-bold shadow-sm mt-1",l?"bg-gradient-to-br from-blue-500 to-blue-600 text-white":r?"bg-slate-700 text-slate-200":"bg-white border border-gray-200 text-gray-700",!l&&x?`ring-1 ring-inset ${x.ring}`:""),children:l?"U":(s.by||"?")[0].toUpperCase()}),e.jsxs("div",{className:m("flex flex-col w-full sm:w-auto sm:max-w-[75%]",l?"items-end":"items-start"),children:[e.jsxs("div",{className:m("flex items-center gap-2 mb-1 sm:hidden",l?"flex-row-reverse":"flex-row"),children:[e.jsx("div",{className:m("flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold shadow-sm",l?"bg-gradient-to-br from-blue-500 to-blue-600 text-white":r?"bg-slate-700 text-slate-200":"bg-white border border-gray-200 text-gray-700",!l&&x?`ring-1 ring-inset ${x.ring}`:""),children:l?"U":(s.by||"?")[0].toUpperCase()}),e.jsx("span",{className:m("text-xs font-medium",l?r?"text-slate-300":"text-gray-700":x?x.text:r?"text-slate-300":"text-gray-700"),children:s.by}),e.jsx("span",{className:`text-[10px] ${r?"text-slate-500":"text-gray-400"}`,children:pt(s.ts)})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 mb-1 px-1",children:[e.jsx("span",{className:m("text-[11px] font-medium",l?r?"text-slate-400":"text-gray-500":x?x.text:r?"text-slate-400":"text-gray-500"),children:s.by}),e.jsx("span",{className:`text-[10px] ${r?"text-slate-600":"text-gray-400"}`,children:pt(s.ts)})]}),e.jsxs("div",{className:m("relative px-4 py-2.5 shadow-sm text-sm leading-relaxed",l?"bg-blue-600 text-white rounded-2xl rounded-tr-none":r?"bg-slate-800 text-slate-200 border border-slate-700 rounded-2xl rounded-tl-none":"bg-white text-gray-800 border border-gray-200 rounded-2xl rounded-tl-none"),children:[d&&e.jsxs("div",{className:`mb-2 text-xs border-l-2 pl-2 italic truncate opacity-80 ${l?"border-blue-400":r?"border-slate-600":"border-gray-300"}`,children:['"',d,'"']}),e.jsx("div",{className:"whitespace-pre-wrap break-words",children:Cn(s)}),g.length>0&&a&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:g.map((f,T)=>{const k=f.path.split("/"),O=k[k.length-1]||"",U=`/api/v1/groups/${encodeURIComponent(a)}/blobs/${encodeURIComponent(O)}`,p=f.title||O||"file";return e.jsxs("a",{href:U,className:m("inline-flex items-center gap-2 rounded px-2 py-1.5 text-xs transition-colors max-w-full",l?"bg-blue-700/50 hover:bg-blue-700 text-white border border-blue-500":r?"bg-slate-900/50 hover:bg-slate-900 text-slate-300 border border-slate-700":"bg-gray-50 hover:bg-gray-100 text-gray-700 border border-gray-200"),title:`Download ${p}`,download:!0,children:[e.jsx("span",{className:"opacity-70",children:"ðŸ“Ž"}),e.jsx("span",{className:"truncate",children:p})]},`${O}:${T}`)})})]}),e.jsxs("div",{className:m("flex items-center justify-between gap-3 mt-1 px-1 text-[10px] transition-opacity","opacity-70 group-hover:opacity-100",r?"text-slate-500":"text-gray-500"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("button",{type:"button",className:m("touch-target-sm px-1 rounded hover:underline transition-colors",r?"text-slate-400 hover:text-slate-200":"text-gray-500 hover:text-gray-700"),onClick:o,children:"Reply"}),e.jsxs("span",{className:"min-w-0 truncate",title:`to ${b}`,children:["to ",b]})]}),y.length>0&&e.jsx("button",{type:"button",className:m("touch-target-sm flex items-center gap-2 min-w-0 rounded-lg px-2 py-1",r?"hover:bg-slate-800/60":"hover:bg-gray-100"),onClick:i,"aria-label":"Show recipient status",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[M.map(([f,T])=>e.jsxs("span",{className:"inline-flex items-center gap-1 min-w-0",children:[e.jsx("span",{className:"truncate max-w-[10ch]",children:f}),e.jsx("span",{className:m("text-[10px] font-semibold tracking-tight",T?r?"text-emerald-400":"text-emerald-600":r?"text-slate-500":"text-gray-500"),"aria-label":T?"read":"pending",children:T?"âœ“âœ“":"âœ“"})]},f)),v>0&&e.jsxs("span",{className:m("text-[10px]",r?"text-slate-500":"text-gray-500"),children:["+",v]})]})})]})]})]})},(t,s)=>t.event===s.event&&t.actors===s.actors&&t.isDark===s.isDark&&t.groupId===s.groupId),$n=u.memo(function({messages:s,actors:n,isDark:r,groupId:a,scrollRef:o,onReply:i,onShowRecipients:l,showScrollButton:x,onScrollButtonClick:c,chatUnreadCount:d,onScrollChange:h,initialScrollTop:g}){const j=u.useRef(null),N=u.useRef(0),y=u.useRef(!0),b=u.useRef(!1),M=u.useRef(null),v=wn({count:s.length,getScrollElement:()=>j.current,estimateSize:()=>120,overscan:5,...g&&g>0?{initialOffset:g}:{}}),f=u.useCallback(()=>{const w=j.current;return w?w.scrollHeight-w.scrollTop-w.clientHeight<100:!0},[]),T=u.useCallback((w=2)=>{s.length>0&&(v.scrollToIndex(s.length-1,{align:"end"}),w>0&&requestAnimationFrame(()=>{T(w-1)}))},[s.length,v]),k=u.useCallback(()=>{const w=M.current;w!=null&&(M.current=null,window.clearTimeout(w))},[]),O=u.useCallback(w=>{k(),M.current=window.setTimeout(()=>{M.current=null,w()},0)},[k]),U=u.useCallback(()=>{O(()=>T())},[O,T]),p=u.useCallback(()=>{const w=f();y.current=w,h==null||h(w)},[f,h]);return u.useEffect(()=>{const w=N.current,E=s.length;N.current=E,E>w&&y.current&&U()},[s.length,U]),u.useEffect(()=>{b.current||s.length<=0||(b.current=!0,!g||g<=0?U():y.current=f())},[s.length,U,g,f]),u.useEffect(()=>{N.current=0,y.current=!0,b.current=!1,k()},[a,k]),u.useEffect(()=>k,[k]),e.jsx("div",{ref:w=>{j.current=w,o&&(o.current=w)},className:"flex-1 min-h-0 overflow-auto px-4 py-4 relative",onScroll:s.length>0?p:void 0,role:"log","aria-label":"Chat messages",children:s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center pb-20 opacity-50",children:[e.jsx("div",{className:"text-4xl mb-4 grayscale",children:"ðŸ’¬"}),e.jsx("p",{className:`text-sm font-medium ${r?"text-slate-400":"text-gray-500"}`,children:"No messages yet"}),e.jsx("p",{className:`text-xs mt-1 ${r?"text-slate-600":"text-gray-400"}`,children:"Start the conversation with your AI team."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:`${v.getTotalSize()}px`,width:"100%",position:"relative"},children:v.getVirtualItems().map(w=>{const E=s[w.index];return e.jsx("div",{"data-index":w.index,ref:v.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${w.start}px)`},className:"pb-6",children:e.jsx(Sn,{event:E,actors:n,isDark:r,groupId:a,onReply:()=>i(E),onShowRecipients:()=>{E.id&&l(String(E.id))}})},E.id||w.index)})}),x&&e.jsxs("button",{className:`fixed bottom-24 right-6 p-3 rounded-full shadow-xl transition-all z-10 ${r?"bg-slate-800 text-white hover:bg-slate-700 border border-slate-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-100"}`,onClick:()=>{T(3),c()},"aria-label":"Scroll to bottom",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})}),d>0&&e.jsxs("span",{className:"absolute -top-1 -right-1 flex h-4 w-4",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-60"}),e.jsx("span",{className:"relative inline-flex rounded-full h-4 w-4 bg-indigo-500 text-[9px] text-white items-center justify-center font-bold",children:d>9?"!":d})]})]})]})})});async function Tn(t){try{await navigator.clipboard.writeText(t)}catch{window.prompt("Copy command:",t)}}function Yt({isDark:t,selectedGroupId:s,busy:n,needsScope:r,needsActors:a,needsStart:o,onAddAgent:i,onStartGroup:l,variant:x="compact"}){const c=x==="compact",d=`cccc attach . --group ${s}`;return!r&&!a&&!o?c?null:e.jsx("div",{className:m("text-xs mt-4",t?"text-slate-400":"text-gray-500"),children:"Team is ready. Say hi to your agents."}):e.jsxs("div",{className:m("space-y-2",c?"mt-3":"mt-4"),children:[r&&e.jsxs("div",{className:m("rounded-xl border px-3 py-2",c?t?"border-slate-700 bg-slate-900/60":"border-gray-200 bg-white":t?"rounded-2xl border-slate-700/50 bg-slate-900/40 p-4 text-left":"rounded-2xl border-gray-200 bg-white/70 p-4 text-left"),children:[e.jsx("div",{className:m("text-xs font-medium",t?"text-slate-200":"text-gray-800"),children:c?"Attach a project folder":""}),!c&&e.jsx("div",{className:"text-xs font-semibold",children:"Attach a project folder"}),e.jsxs("div",{className:m("flex items-center justify-between gap-2 text-[11px]",c?"mt-1":"mt-2",t?"text-slate-500":"text-gray-500"),children:[e.jsx("code",{className:m("truncate",t?"text-slate-300":"text-gray-700"),children:d}),e.jsx("button",{type:"button",className:m("flex-shrink-0 rounded-lg px-2 py-1 text-[11px] font-medium border",t?"border-slate-700 text-slate-300 hover:bg-slate-800":"border-gray-200 text-gray-700 hover:bg-gray-50"),onClick:()=>Tn(d),children:"Copy"})]})]}),a&&e.jsxs("div",{className:m(c?"flex items-center justify-between gap-3 rounded-xl border px-3 py-2":"rounded-2xl border p-4 text-left",t?c?"border-slate-700 bg-slate-900/60":"border-slate-700/50 bg-slate-900/40":c?"border-gray-200 bg-white":"border-gray-200 bg-white/70"),children:[e.jsxs("div",{className:c?"min-w-0":"",children:[e.jsx("div",{className:m("text-xs font-medium",t?"text-slate-200":"text-gray-800"),children:c?"Add an agent":""}),!c&&e.jsx("div",{className:"text-xs font-semibold",children:"Add an agent"}),e.jsx("div",{className:m(c?"text-[11px] truncate":"mt-1 text-[11px]",t?"text-slate-500":"text-gray-500"),children:"Add a foreman first, then peers."})]}),e.jsx("button",{type:"button",className:m("flex-shrink-0 font-semibold bg-blue-600 hover:bg-blue-500 text-white",c?"rounded-xl px-3 py-1.5 text-[11px]":"mt-3 w-full rounded-xl px-4 py-2 text-sm"),onClick:i,children:"Add Agent"})]}),o&&e.jsxs("div",{className:m(c?"flex items-center justify-between gap-3 rounded-xl border px-3 py-2":"rounded-2xl border p-4 text-left",t?c?"border-slate-700 bg-slate-900/60":"border-slate-700/50 bg-slate-900/40":c?"border-gray-200 bg-white":"border-gray-200 bg-white/70"),children:[e.jsxs("div",{className:c?"min-w-0":"",children:[e.jsx("div",{className:m("text-xs font-medium",t?"text-slate-200":"text-gray-800"),children:c?"Start the group":""}),!c&&e.jsx("div",{className:"text-xs font-semibold",children:"Start the group"}),e.jsx("div",{className:m(c?"text-[11px] truncate":"mt-1 text-[11px]",t?"text-slate-500":"text-gray-500"),children:"Launch your agents and begin chatting."})]}),e.jsx("button",{type:"button",className:m("flex-shrink-0 font-semibold bg-emerald-600 hover:bg-emerald-500 text-white",c?"rounded-xl px-3 py-1.5 text-[11px]":"mt-3 w-full rounded-xl px-4 py-2 text-sm",n==="group-start"?"opacity-60":""),onClick:l,disabled:n==="group-start",children:n==="group-start"?"Startingâ€¦":c?"Start":"Start Group"})]})]})}function Qt({isDark:t,isSmallScreen:s,selectedGroupId:n,actors:r,busy:a,replyTarget:o,onCancelReply:i,toTokens:l,onToggleRecipient:x,onClearRecipients:c,composerFiles:d,onRemoveComposerFile:h,appendComposerFiles:g,fileInputRef:j,composerRef:N,composerText:y,setComposerText:b,onSendMessage:M,showMentionMenu:v,setShowMentionMenu:f,mentionSuggestions:T,mentionSelectedIndex:k,setMentionSelectedIndex:O,setMentionFilter:U,onAppendRecipientToken:p}){const w=A=>{const R=A.clipboardData;if(!R)return;const B=[];try{const Y=Array.from(R.items||[]);for(const X of Y){if(!X||X.kind!=="file")continue;const Q=X.getAsFile();Q&&B.push(Q)}}catch{}if(B.length===0)try{B.push(...Array.from(R.files||[]))}catch{}if(B.length===0||!n)return;const q=new Set,V=[];for(const Y of B){const X=`${Y.name}:${Y.size}:${Y.type}`;q.has(X)||(q.add(X),V.push(Y))}V.length!==0&&(A.preventDefault(),g(V))},E=A=>{const R=A.target.value;b(R);const B=A.target;B.style.height="auto",B.style.height=Math.min(B.scrollHeight,140)+"px";const q=R.lastIndexOf("@");if(q>=0){const V=R.slice(q+1);(q===0||R[q-1]===" "||R[q-1]===`
`)&&!V.includes(" ")&&!V.includes(`
`)?(U(V),f(!0),O(0)):f(!1)}else f(!1)},S=A=>{if(v&&T.length>0){const R=Math.min(T.length,8)-1;if(A.key==="ArrowDown"){A.preventDefault(),O(B=>B>=R?0:B+1);return}if(A.key==="ArrowUp"){A.preventDefault(),O(B=>B<=0?R:B-1);return}if(A.key==="Enter"||A.key==="Tab"){A.preventDefault(),z(T[k]);return}if(A.key==="Escape"){A.preventDefault(),f(!1),O(0);return}}A.key==="Enter"&&!v?(A.ctrlKey||A.metaKey)&&(A.preventDefault(),M()):A.key==="Escape"&&(f(!1),i())},z=A=>{if(!A)return;const R=y.lastIndexOf("@");if(R>=0){const B=y.slice(0,R);b(B+A+" ")}l.includes(A)||p(A),f(!1),O(0)},J=y.trim()||d.length>0;return e.jsxs("footer",{className:m("flex-shrink-0 border-t px-4 py-3 safe-area-inset-bottom",t?"border-slate-800 bg-slate-950/80 backdrop-blur":"border-gray-200 bg-white/80 backdrop-blur"),children:[o&&e.jsxs("div",{className:m("mb-2 flex items-center gap-2 text-xs rounded-xl px-3 py-2",t?"text-slate-400 bg-slate-900/50":"text-gray-500 bg-gray-100"),children:[e.jsx("span",{className:t?"text-slate-500":"text-gray-400",children:"Replying to"}),e.jsx("span",{className:m("font-medium",t?"text-slate-300":"text-gray-700"),children:o.by}),e.jsxs("span",{className:m("truncate flex-1",t?"text-slate-500":"text-gray-400"),children:['"',o.text,'"']}),e.jsx("button",{className:m("p-1 rounded-full",t?"hover:bg-slate-800 text-slate-400 hover:text-slate-200":"hover:bg-gray-200 text-gray-400 hover:text-gray-600"),onClick:i,title:"Cancel reply","aria-label":"Cancel reply",children:"Ã—"})]}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("div",{className:m("text-xs font-medium flex-shrink-0",t?"text-slate-500":"text-gray-400"),children:"To"}),e.jsx("div",{className:"flex-1 min-w-0 overflow-x-auto scrollbar-hide sm:overflow-visible",children:e.jsx("div",{className:"flex items-center gap-1.5 flex-nowrap sm:flex-wrap",children:["@all","@foreman","@peers",...r.map(A=>String(A.id||""))].map(A=>{const R=A.trim();if(!R)return null;const B=l.includes(R);return e.jsx("button",{className:m("flex-shrink-0 whitespace-nowrap text-[11px] px-2.5 py-1 rounded-full border transition-all",B?"bg-emerald-600 text-white border-emerald-500 shadow-sm":t?"bg-slate-900 text-slate-400 border-slate-800 hover:border-slate-600 hover:text-slate-200":"bg-white text-gray-600 border-gray-200 hover:border-gray-300 hover:text-gray-800"),onClick:()=>x(R),disabled:!n||a==="send",title:B?"Remove recipient":"Add recipient","aria-pressed":B,children:R},R)})})}),l.length>0&&e.jsx("button",{className:m("flex-shrink-0 text-[10px] px-2 py-1 rounded-full transition-colors",t?"text-slate-500 hover:text-slate-300 hover:bg-slate-800":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"),onClick:c,disabled:a==="send",title:"Clear recipients",children:"clear"})]}),d.length>0&&e.jsx("div",{className:m("mb-3 flex flex-wrap gap-2",t?"text-slate-300":"text-gray-700"),children:d.map((A,R)=>e.jsxs("span",{className:m("inline-flex items-center gap-2 rounded-lg border px-2.5 py-1.5 text-xs max-w-full shadow-sm",t?"border-slate-700 bg-slate-900":"border-gray-200 bg-white"),title:A.name,children:[e.jsx("span",{className:"truncate",children:A.name}),e.jsx("button",{className:m("flex-shrink-0 p-0.5 rounded-full",t?"text-slate-400 hover:text-white hover:bg-slate-700":"text-slate-400 hover:text-gray-700 hover:bg-gray-100"),onClick:()=>h(R),title:"Remove file",children:"Ã—"})]},`${A.name}:${R}`))}),e.jsxs("div",{className:"flex gap-2 relative items-end",children:[e.jsx("input",{ref:j,type:"file",multiple:!0,className:"hidden",onChange:A=>{const R=Array.from(A.target.files||[]);R.length>0&&g(R),A.target.value=""}}),e.jsx("button",{className:m("rounded-full p-2.5 text-lg transition-colors flex-shrink-0 shadow-sm border",t?"bg-slate-800 border-slate-700 text-slate-400 hover:text-slate-200 hover:bg-slate-700 hover:border-slate-600":"bg-white border-gray-200 text-gray-400 hover:text-gray-600 hover:bg-gray-50 hover:border-gray-300"),onClick:()=>{var A;return(A=j.current)==null?void 0:A.click()},disabled:!n||a==="send",title:"Attach file",children:"ðŸ“Ž"}),e.jsx("textarea",{ref:N,className:m("w-full rounded-3xl border px-4 py-3 text-sm resize-none min-h-[48px] max-h-[140px] transition-all focus:ring-2 focus:ring-offset-1",t?"bg-slate-900 border-slate-700 text-slate-200 placeholder-slate-500 focus:border-blue-500/50 focus:ring-blue-500/20 focus:ring-offset-slate-900":"bg-white border-gray-200 text-gray-900 placeholder-gray-400 focus:border-blue-400 focus:ring-blue-100 focus:ring-offset-white"),placeholder:s?"Messageâ€¦":"Messageâ€¦ (@ to mention, Ctrl+Enter to send)",rows:1,value:y,onPaste:w,onChange:E,onKeyDown:S,onBlur:()=>setTimeout(()=>f(!1),150),"aria-label":"Message input"}),v&&T.length>0&&e.jsx("div",{className:m("absolute bottom-full left-0 mb-2 w-56 max-h-48 overflow-auto rounded-xl border shadow-xl z-20",t?"border-slate-700 bg-slate-900":"border-gray-200 bg-white"),role:"listbox","aria-label":"Mention suggestions",children:T.slice(0,8).map((A,R)=>e.jsx("button",{className:m("w-full text-left px-4 py-2.5 text-sm transition-colors",t?"text-slate-200":"text-gray-700",R===k?t?"bg-slate-800":"bg-blue-50 text-blue-700":t?"hover:bg-slate-800":"hover:bg-gray-50"),onMouseDown:B=>{var q;B.preventDefault(),z(A),(q=N.current)==null||q.focus()},onMouseEnter:()=>O(R),children:A},A))}),e.jsx("button",{className:m("rounded-full px-5 py-2.5 text-sm font-semibold disabled:opacity-50 min-h-[48px] shadow-sm transition-all flex items-center justify-center",a==="send"||!J?t?"bg-slate-800 text-slate-500":"bg-gray-100 text-gray-400":"bg-blue-600 hover:bg-blue-500 text-white shadow-blue-500/20"),onClick:M,disabled:a==="send"||!J,"aria-label":"Send message",children:a==="send"?e.jsx("span",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):"Send"})]})]})}function En({isDark:t,isSmallScreen:s,selectedGroupId:n,actors:r,busy:a,showSetupCard:o,needsScope:i,needsActors:l,needsStart:x,onAddAgent:c,onStartGroup:d,chatMessages:h,scrollRef:g,showScrollButton:j,chatUnreadCount:N,onScrollButtonClick:y,onScrollChange:b,onReply:M,onShowRecipients:v,initialScrollTop:f,replyTarget:T,onCancelReply:k,toTokens:O,onToggleRecipient:U,onClearRecipients:p,composerFiles:w,onRemoveComposerFile:E,appendComposerFiles:S,fileInputRef:z,composerRef:J,composerText:A,setComposerText:R,onSendMessage:B,showMentionMenu:q,setShowMentionMenu:V,mentionSuggestions:Y,mentionSelectedIndex:X,setMentionSelectedIndex:Q,setMentionFilter:oe,onAppendRecipientToken:ne}){return h.length===0&&o?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:g,className:"flex-1 min-h-0 overflow-auto px-4 py-4 relative",role:"log","aria-label":"Chat messages",children:e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center pb-20",children:e.jsxs("div",{className:m("w-full max-w-md",t?"text-slate-200":"text-gray-800"),children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ§­"}),e.jsx("div",{className:m("text-sm font-semibold",t?"text-slate-200":"text-gray-800"),children:"Next steps"}),e.jsx(Yt,{isDark:t,selectedGroupId:n,busy:a,needsScope:i,needsActors:l,needsStart:x,onAddAgent:c,onStartGroup:d,variant:"full"})]})})}),e.jsx(Qt,{isDark:t,isSmallScreen:s,selectedGroupId:n,actors:r,busy:a,replyTarget:T,onCancelReply:k,toTokens:O,onToggleRecipient:U,onClearRecipients:p,composerFiles:w,onRemoveComposerFile:E,appendComposerFiles:S,fileInputRef:z,composerRef:J,composerText:A,setComposerText:R,onSendMessage:B,showMentionMenu:q,setShowMentionMenu:V,mentionSuggestions:Y,mentionSelectedIndex:X,setMentionSelectedIndex:Q,setMentionFilter:oe,onAppendRecipientToken:ne})]}):e.jsxs(e.Fragment,{children:[o&&h.length>0&&e.jsx("div",{className:"flex-shrink-0 px-4 pt-4",children:e.jsxs("div",{className:m("rounded-2xl border p-4 sm:p-5",t?"border-slate-700/50 bg-slate-900/40":"border-gray-200 bg-white/70"),role:"region","aria-label":"Setup checklist",children:[e.jsx("div",{className:m("text-sm font-semibold",t?"text-slate-200":"text-gray-800"),children:"Next steps"}),e.jsx(Yt,{isDark:t,selectedGroupId:n,busy:a,needsScope:i,needsActors:l,needsStart:x,onAddAgent:c,onStartGroup:d,variant:"compact"})]})}),e.jsx($n,{messages:h,actors:r,isDark:t,groupId:n||"",scrollRef:g,onReply:M,onShowRecipients:v,showScrollButton:j,onScrollButtonClick:y,chatUnreadCount:N,onScrollChange:b,initialScrollTop:f}),e.jsx(Qt,{isDark:t,isSmallScreen:s,selectedGroupId:n,actors:r,busy:a,replyTarget:T,onCancelReply:k,toTokens:O,onToggleRecipient:U,onClearRecipients:p,composerFiles:w,onRemoveComposerFile:E,appendComposerFiles:S,fileInputRef:z,composerRef:J,composerText:A,setComposerText:R,onSendMessage:B,showMentionMenu:q,setShowMentionMenu:V,mentionSuggestions:Y,mentionSelectedIndex:X,setMentionSelectedIndex:Q,setMentionFilter:oe,onAppendRecipientToken:ne})]})}function An(t){if(!t)return"";const s=String(t.active_scope_key||"");if(!s)return"";const r=(Array.isArray(t.scopes)?t.scopes:[]).find(a=>String(a.scope_key||"")===s);return String((r==null?void 0:r.url)||"")}function _n(){const{theme:t,setTheme:s,isDark:n}=Dr(),{groups:r,selectedGroupId:a,groupDoc:o,events:i,actors:l,setSelectedGroupId:x,refreshGroups:c,refreshActors:d,loadGroup:h}=Ne(),{busy:g,errorMsg:j,isTransitioning:N,sidebarOpen:y,activeTab:b,showScrollButton:M,chatUnreadCount:v,isSmallScreen:f,setBusy:T,showError:k,dismissError:O,setSidebarOpen:U,setActiveTab:p,setShowScrollButton:w,setChatUnreadCount:E,setSmallScreen:S}=st(),{recipientsEventId:z,openModal:J,setRecipientsModal:A}=Mt(),{composerText:R,composerFiles:B,toText:q,replyTarget:V,setComposerText:Y,setComposerFiles:X,setToText:Q,setReplyTarget:oe,clearComposer:ne}=ps(),{setNewActorRole:ie,setEditGroupTitle:we,setEditGroupTopic:xe,setDirSuggestions:Ce}=ys(),{getTermEpoch:C,toggleActorEnabled:D,relaunchActor:ce,editActor:We,removeActor:re,openActorInbox:me}=en(a),Je=u.useRef(null),he=u.useRef(null),ve=u.useRef(null),qe=u.useRef(null),Se=u.useRef("chat"),$e=u.useRef(!0),Te=u.useRef([]),[Oe,ae]=ye.useState(0),[Ee,Ie]=ye.useState(!1),[Ae,Ve]=ye.useState(""),[rt,He]=ye.useState(0),{connectStream:nt,fetchContext:Ke,scheduleActorWarmupRefresh:at,cleanup:_e}=tn({activeTabRef:Se,chatAtBottomRef:$e,actorsRef:Te}),{dropOverlayOpen:lt,handleAppendComposerFiles:Re,resetDragDrop:ot,WEB_MAX_FILE_MB:Pe}=sn({selectedGroupId:a}),{handleStartGroup:ge,handleStopGroup:Ye,handleSetGroupState:ke}=rn(),it=u.useMemo(()=>["chat",...l.map($=>$.id)],[l]),Qe=ye.useCallback($=>{if(b==="chat"&&$!=="chat"){const G=ve.current;G&&ae(G.scrollTop)}p($)},[b,p]),{handleTouchStart:Le,handleTouchEnd:ct}=nn({tabs:it,activeTab:b,onTabChange:Qe});u.useEffect(()=>{Se.current=b,b==="chat"&&(E(0),w(!1))},[b,E,w]),u.useEffect(()=>{Te.current=l},[l]),u.useEffect(()=>{const $=window.matchMedia("(max-width: 639px)"),G=()=>S($.matches);return G(),$.addEventListener("change",G),()=>$.removeEventListener("change",G)},[S]);const ue=u.useMemo(()=>An(o),[o]),Be=u.useMemo(()=>l.some($=>$.role==="foreman"),[l]),be=u.useMemo(()=>r.find($=>String($.group_id||"")===a)||null,[r,a]),pe=(be==null?void 0:be.running)??!1,Fe=u.useMemo(()=>{const $=new Set(["@all","@foreman","@peers"]);for(const G of l){const H=String(G.id||"").trim();H&&$.add(H)}return $},[l]),Ue=u.useMemo(()=>{const G=q.split(",").map(L=>L.trim()).filter(L=>L.length>0).filter(L=>L!=="user"&&L!=="@user"&&L!=="@"),H=[],_=new Set;for(const L of G)Fe.has(L)&&(_.has(L)||(_.add(L),H.push(L)));return H},[q,Fe]),dt=u.useMemo(()=>{const $=["@all","@foreman","@peers"],G=l.map(L=>String(L.id||"")).filter(L=>L),H=[...$,...G];if(!Ae)return H;const _=Ae.toLowerCase();return H.filter(L=>L.toLowerCase().includes(_))},[l,Ae]),Z=u.useMemo(()=>b==="chat"?null:l.find($=>$.id===b)||null,[b,l]);u.useEffect(()=>{if(ne(),he.current&&(he.current.value=""),ot(),!!a)return h(a),nt(a),at(a),()=>{_e()}},[a]),u.useEffect(()=>{c(),I(),F();const $=window.setInterval(c,5e3);return()=>window.clearInterval($)},[]);async function I(){const $=await er();$.ok&&Ne.getState().setRuntimes($.result.runtimes||[])}async function F(){const $=await tr();$.ok&&Ce($.result.suggestions||[])}function W($){const G=$.trim();if(!G)return;const H=Ue,_=H.findIndex(L=>L===G);if(_>=0){const L=H.slice(0,_).concat(H.slice(_+1));Q(L.join(", "))}else Q(H.concat([G]).join(", "))}async function ee(){const $=R.trim();if(a&&!(!$&&B.length===0)){T("send");try{const G=Ue;let H;if(V){const _=String(V.by||"").trim(),L=_&&_!=="user"&&_!=="unknown"?[_]:["@all"],K=G.length?G:L;H=await Ds(a,$,K,V.eventId,B.length>0?B:void 0)}else H=await Zs(a,$,G,B.length>0?B:void 0);if(!H.ok){k(`${H.error.code}: ${H.error.message}`);return}ne(),he.current&&(he.current.value="")}finally{T("")}}}function ze($){if(!$.id||$.kind!=="chat.message")return;const G=$.data,H=G!=null&&G.text?String(G.text):"";oe({eventId:String($.id),by:String($.by||"unknown"),text:H.slice(0,100)+(H.length>100?"...":"")})}const Xe=()=>{const $=ve.current;$&&$.scrollTo({top:$.scrollHeight,behavior:"smooth"}),$e.current=!0,w(!1),E(0)},je=u.useMemo(()=>z&&i.find($=>$.kind==="chat.message"&&String($.id||"")===z)||null,[i,z]),jt=u.useMemo(()=>{if(!je)return null;const $=je.data,H=($&&Array.isArray($.to)?$.to:[]).map(se=>String(se||"").trim()).filter(se=>se.length>0),_=H.length>0?H.join(", "):"@all",L=je._read_status&&typeof je._read_status=="object"?je._read_status:null,K=L?Object.keys(L):Ns(je,l),le=new Set(K),xt=l.map(se=>String(se.id||"")).filter(se=>se&&le.has(se)).map(se=>[se,!!(L&&L[se])]);return{toLabel:_,entries:xt}},[l,je]),Nt=i.filter($=>$.kind==="chat.message"),ht=!!a&&!ue,gt=!!a&&l.length===0,wt=!!a&&l.length>0&&!pe,Ot=ht||gt||wt;return e.jsxs("div",{className:`h-full w-full relative overflow-hidden ${n?"bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950":"bg-gradient-to-br from-slate-50 via-white to-slate-100"}`,children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:`absolute -top-32 -left-32 w-96 h-96 rounded-full liquid-blob ${n?"bg-gradient-to-br from-cyan-500/20 via-cyan-600/10 to-transparent":"bg-gradient-to-br from-cyan-400/25 via-cyan-500/15 to-transparent"}`,style:{filter:"blur(60px)"}}),e.jsx("div",{className:`absolute top-1/4 -right-24 w-80 h-80 rounded-full liquid-blob ${n?"bg-gradient-to-bl from-purple-500/15 via-indigo-600/10 to-transparent":"bg-gradient-to-bl from-purple-400/20 via-indigo-500/10 to-transparent"}`,style:{filter:"blur(50px)",animationDelay:"-3s"}}),e.jsx("div",{className:`absolute -bottom-20 left-1/3 w-72 h-72 rounded-full liquid-blob ${n?"bg-gradient-to-tr from-blue-500/12 via-sky-600/8 to-transparent":"bg-gradient-to-tr from-blue-400/15 via-sky-500/10 to-transparent"}`,style:{filter:"blur(45px)",animationDelay:"-5s"}})]}),e.jsx("div",{className:"pointer-events-none absolute inset-0 opacity-[0.015]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E")`}}),e.jsxs("div",{className:"relative h-full grid grid-cols-1 md:grid-cols-[280px_1fr] transition-all duration-300",children:[e.jsx(Yr,{groups:r,selectedGroupId:a,isOpen:y,isDark:n,onSelectGroup:$=>x($),onCreateGroup:()=>{J("createGroup"),F()},onClose:()=>U(!1)}),e.jsxs("main",{className:`h-full flex flex-col overflow-hidden backdrop-blur-sm ${n?"bg-slate-950/40":"bg-white/60"}`,children:[e.jsx(Kr,{isDark:n,theme:t,onThemeChange:s,selectedGroupId:a,groupDoc:o,selectedGroupRunning:pe,actors:l,busy:g,errorMsg:j,onDismissError:O,onOpenSidebar:()=>U(!0),onOpenGroupEdit:()=>{o&&(we(o.title||""),xe(o.topic||""),J("groupEdit"))},onOpenContext:()=>{a&&Ke(a),J("context")},onStartGroup:ge,onStopGroup:Ye,onSetGroupState:ke,onOpenSettings:()=>J("settings"),onOpenMobileMenu:()=>J("mobileMenu")}),a&&e.jsx(_s,{actors:l,activeTab:b,onTabChange:Qe,unreadChatCount:v,isDark:n,onAddAgent:()=>{ie(Be?"peer":"foreman"),J("addActor")},canAddAgent:!!a}),e.jsx("div",{ref:qe,className:`flex-1 min-h-0 flex flex-col overflow-hidden transition-opacity duration-150 ${N?"opacity-0":"opacity-100"}`,onTouchStart:Le,onTouchEnd:ct,children:b==="chat"?e.jsx(En,{isDark:n,isSmallScreen:f,selectedGroupId:a,actors:l,busy:g,showSetupCard:Ot,needsScope:ht,needsActors:gt,needsStart:wt,hasForeman:Be,onAddAgent:()=>{ie(Be?"peer":"foreman"),J("addActor")},onStartGroup:ge,chatMessages:Nt,scrollRef:ve,showScrollButton:M,chatUnreadCount:v,onScrollButtonClick:Xe,onScrollChange:$=>{$e.current=$,w(!$),$&&E(0)},onReply:ze,onShowRecipients:$=>A($),initialScrollTop:Oe,replyTarget:V,onCancelReply:()=>oe(null),toTokens:Ue,onToggleRecipient:W,onClearRecipients:()=>Q(""),composerFiles:B,onRemoveComposerFile:$=>X(B.filter((G,H)=>H!==$)),appendComposerFiles:Re,fileInputRef:he,composerRef:Je,composerText:R,setComposerText:Y,onSendMessage:ee,showMentionMenu:Ee,setShowMentionMenu:Ie,mentionSuggestions:dt,mentionSelectedIndex:rt,setMentionSelectedIndex:He,setMentionFilter:Ve,onAppendRecipientToken:$=>Q(q?q+", "+$:$)}):e.jsx(dn,{actor:Z,groupId:a,termEpoch:Z?C(Z.id):0,busy:g,isDark:n,onToggleEnabled:()=>Z&&D(Z),onRelaunch:()=>Z&&ce(Z),onEdit:()=>Z&&We(Z),onRemove:()=>Z&&re(Z,b),onInbox:()=>Z&&me(Z),onStatusChange:()=>void d()})})]})]}),e.jsx(Vr,{isDark:n,composerRef:Je,messageMeta:jt,onStartReply:ze,onThemeToggle:()=>s(n?"light":"dark"),onStartGroup:ge,onStopGroup:Ye,onSetGroupState:ke,fetchContext:Ke}),e.jsx(Rs,{isOpen:lt,isDark:n,maxFileMb:Pe})]})}As.createRoot(document.getElementById("root")).render(e.jsx(ye.StrictMode,{children:e.jsx(_n,{})}));export{cs as E,Mn as I,Rt as P,mt as R,os as S,Lr as T,kn as a,Tr as b,m as c,On as d,In as e,Pn as g,e as j,u as r};
