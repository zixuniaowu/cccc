const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-AgentTab.js","assets/chunk-xterm.js","assets/chunk-react-vendor.js"])))=>i.map(i=>d[i]);
import{r as Xt,a as Zt}from"./chunk-react-vendor.js";import{g as Dt}from"./chunk-xterm.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();var St={exports:{}},xt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var It;function Ss(){if(It)return xt;It=1;var t=Xt(),s=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(l,x,c){var d,g={},b=null,j=null;c!==void 0&&(b=""+c),x.key!==void 0&&(b=""+x.key),x.ref!==void 0&&(j=x.ref);for(d in x)r.call(x,d)&&!o.hasOwnProperty(d)&&(g[d]=x[d]);if(l&&l.defaultProps)for(d in x=l.defaultProps,x)g[d]===void 0&&(g[d]=x[d]);return{$$typeof:s,type:l,key:b,ref:j,props:g,_owner:a.current}}return xt.Fragment=n,xt.jsx=i,xt.jsxs=i,xt}var Pt;function $s(){return Pt||(Pt=1,St.exports=Ss()),St.exports}var e=$s(),u=Xt();const we=Dt(u);var bt={},Bt;function Ts(){if(Bt)return bt;Bt=1;var t=Zt();return bt.createRoot=t.createRoot,bt.hydrateRoot=t.hydrateRoot,bt}var Es=Ts();const As=Dt(Es);function m(...t){return t.filter(Boolean).join(" ")}function _s({actors:t,activeTab:s,onTabChange:n,unreadChatCount:r,isDark:a,onAddAgent:o,canAddAgent:i=!0}){const l=u.useRef(null),x=u.useRef(null);return u.useEffect(()=>{if(!x.current||!l.current)return;const c=l.current,d=x.current;requestAnimationFrame(()=>{const g=c.getBoundingClientRect(),b=d.getBoundingClientRect();b.left<g.left?c.scrollLeft-=g.left-b.left+16:b.right>g.right&&(c.scrollLeft+=b.right-g.right+16)})},[s]),e.jsxs("div",{ref:l,className:m("flex items-center gap-1.5 px-3 py-1.5 overflow-x-auto border-b sticky top-0 z-10 backdrop-blur-md",a?"border-white/5 bg-slate-900/70":"border-black/5 bg-white/70"),style:{scrollbarWidth:"none",msOverflowStyle:"none"},role:"tablist","aria-label":"Navigation tabs",children:[e.jsxs("button",{ref:s==="chat"?x:null,onClick:()=>n("chat"),className:m("relative flex items-center gap-2 px-3 py-2 text-sm font-medium whitespace-nowrap transition-all rounded-lg",s==="chat"?a?"bg-white/10 text-white":"bg-black/5 text-gray-900":a?"text-slate-400 hover:text-slate-200 hover:bg-white/5":"text-gray-500 hover:text-gray-700 hover:bg-black/5"),role:"tab","aria-selected":s==="chat",children:[e.jsx("span",{children:"Chat"}),r>0&&e.jsx("span",{className:m("text-[10px] px-1.5 py-0.5 rounded-full font-bold",a?"bg-cyan-500/20 text-cyan-300":"bg-cyan-100 text-cyan-700"),children:r})]}),e.jsx("div",{className:`w-px h-4 flex-shrink-0 ${a?"bg-white/10":"bg-black/8"}`}),t.map(c=>{const d=s===c.id,g=c.running??c.enabled??!1;return e.jsxs("button",{ref:d?x:null,onClick:()=>n(c.id),className:m("relative flex items-center gap-2 px-3 py-2 text-sm font-medium whitespace-nowrap transition-all rounded-lg",d?a?"bg-white/10 text-white":"bg-black/5 text-gray-900":a?"text-slate-400 hover:text-slate-200 hover:bg-white/5":"text-gray-500 hover:text-gray-700 hover:bg-black/5"),role:"tab","aria-selected":d,children:[e.jsx("span",{className:m("w-2 h-2 rounded-full transition-all",g?"bg-emerald-500":a?"bg-slate-600":"bg-gray-300")}),e.jsx("span",{children:c.id}),c.role==="foreman"&&e.jsx("span",{className:m("text-[9px] px-1.5 py-0.5 rounded",a?"bg-amber-500/20 text-amber-400":"bg-amber-100 text-amber-600"),children:"F"}),(c.unread_count??0)>0&&e.jsx("span",{className:m("text-[10px] px-1.5 py-0.5 rounded-full font-bold",a?"bg-indigo-500/20 text-indigo-300":"bg-indigo-100 text-indigo-700"),children:c.unread_count})]},c.id)}),o&&e.jsxs("button",{onClick:o,disabled:!i,className:m("ml-1 flex items-center gap-1 rounded-lg px-2.5 py-1.5 text-xs font-medium transition-all disabled:opacity-30 whitespace-nowrap border",a?"border-white/10 text-slate-300 hover:bg-white/5":"border-black/10 text-gray-600 hover:bg-black/5"),title:t.length===0?"Add your first agent (foreman)":"Add agent","aria-label":"Add agent",children:[e.jsx("span",{className:"text-sm leading-none",children:"+"}),e.jsx("span",{className:"hidden sm:inline",children:"Add"})]})]})}function Rs({isOpen:t,isDark:s,maxFileMb:n}){return t?e.jsxs("div",{className:"fixed inset-0 z-[60]",children:[e.jsx("div",{className:m("absolute inset-0 backdrop-blur-sm",s?"bg-black/60":"bg-black/40"),"aria-hidden":"true"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-6",children:e.jsxs("div",{className:m("w-full max-w-sm rounded-2xl border px-6 py-5 text-center shadow-2xl",s?"bg-slate-900/90 border-slate-700 text-slate-100":"bg-white/90 border-gray-200 text-gray-900"),role:"dialog","aria-label":"Drop files to attach",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“Ž"}),e.jsx("div",{className:"text-sm font-semibold",children:"Drop files to attach"}),e.jsx("div",{className:m("text-xs mt-1",s?"text-slate-400":"text-gray-500"),children:"Added to the composer. Click Send when ready."}),e.jsxs("div",{className:m("text-[11px] mt-3",s?"text-slate-500":"text-gray-500"),children:["Max ",n,"MB per file."]})]})})]}):null}function Ze(t,s){return{ok:!1,error:{code:t,message:s}}}async function I(t,s){let n;try{n=await fetch(t,{...s,headers:{"content-type":"application/json",...(s==null?void 0:s.headers)||{}}})}catch(a){return Ze("NETWORK_ERROR",a instanceof Error?a.message:"Network request failed")}const r=await n.text();if(!r)return n.ok?{ok:!0,result:{}}:Ze("EMPTY_RESPONSE",`Server returned ${n.status} with empty body`);try{return JSON.parse(r)}catch{return Ze("PARSE_ERROR",`Invalid JSON response: ${r.slice(0,100)}`)}}async function es(t,s,n){let r;try{r=await fetch(t,{...n||{},method:(n==null?void 0:n.method)||"POST",body:s,headers:{...(n==null?void 0:n.headers)||{}}})}catch(o){return Ze("NETWORK_ERROR",o instanceof Error?o.message:"Network request failed")}const a=await r.text();if(!a)return r.ok?{ok:!0,result:{}}:Ze("EMPTY_RESPONSE",`Server returned ${r.status} with empty body`);try{return JSON.parse(a)}catch{return Ze("PARSE_ERROR",`Invalid JSON response: ${a.slice(0,100)}`)}}async function Ls(){return I("/api/v1/groups")}async function Ms(t){return I(`/api/v1/groups/${encodeURIComponent(t)}`)}async function Os(t,s=""){return I("/api/v1/groups",{method:"POST",body:JSON.stringify({title:t,topic:s,by:"user"})})}async function Is(t,s,n){return I(`/api/v1/groups/${encodeURIComponent(t)}`,{method:"PUT",body:JSON.stringify({title:s.trim(),topic:n.trim(),by:"user"})})}async function Ps(t){return I(`/api/v1/groups/${encodeURIComponent(t)}?confirm=${encodeURIComponent(t)}&by=user`,{method:"DELETE"})}async function Bs(t,s){return I(`/api/v1/groups/${encodeURIComponent(t)}/attach`,{method:"POST",body:JSON.stringify({path:s,by:"user"})})}async function ks(t){return I(`/api/v1/groups/${encodeURIComponent(t)}/start?by=user`,{method:"POST"})}async function Fs(t){return I(`/api/v1/groups/${encodeURIComponent(t)}/stop?by=user`,{method:"POST"})}async function Us(t,s){return I(`/api/v1/groups/${encodeURIComponent(t)}/state?state=${encodeURIComponent(s)}&by=user`,{method:"POST"})}async function zs(t,s=120){return I(`/api/v1/groups/${encodeURIComponent(t)}/ledger/tail?lines=${s}&with_read_status=true`)}async function Rt(t){return I(`/api/v1/groups/${encodeURIComponent(t)}/actors?include_unread=true`)}async function Gs(t,s,n,r,a){return I(`/api/v1/groups/${encodeURIComponent(t)}/actors`,{method:"POST",body:JSON.stringify({actor_id:s,role:n,runner:"pty",runtime:r,command:a,env:{},default_scope_key:"",by:"user"})})}async function Ws(t,s,n,r,a){return I(`/api/v1/groups/${encodeURIComponent(t)}/actors/${encodeURIComponent(s)}`,{method:"POST",body:JSON.stringify({runtime:n,command:r.trim(),title:a.trim(),by:"user"})})}async function qs(t,s){return I(`/api/v1/groups/${encodeURIComponent(t)}/actors/${encodeURIComponent(s)}?by=user`,{method:"DELETE"})}async function Js(t,s){return I(`/api/v1/groups/${encodeURIComponent(t)}/actors/${encodeURIComponent(s)}/start`,{method:"POST"})}async function Vs(t,s){return I(`/api/v1/groups/${encodeURIComponent(t)}/actors/${encodeURIComponent(s)}/stop`,{method:"POST"})}async function Hs(t,s){return I(`/api/v1/groups/${encodeURIComponent(t)}/actors/${encodeURIComponent(s)}/restart?by=user`,{method:"POST"})}async function ts(t){return I(`/api/v1/groups/${encodeURIComponent(t)}/context`)}async function Ks(t,s){return I(`/api/v1/groups/${encodeURIComponent(t)}/context`,{method:"POST",body:JSON.stringify({ops:[{op:"vision.update",vision:s}],by:"user"})})}async function Ys(t,s){return I(`/api/v1/groups/${encodeURIComponent(t)}/context`,{method:"POST",body:JSON.stringify({ops:[{op:"sketch.update",sketch:s}],by:"user"})})}async function ss(t){return I(`/api/v1/groups/${encodeURIComponent(t)}/settings`)}async function Qs(t,s){return I(`/api/v1/groups/${encodeURIComponent(t)}/settings`,{method:"PUT",body:JSON.stringify({...s,by:"user"})})}async function rs(t,s,n=200){return I(`/api/v1/groups/${encodeURIComponent(t)}/inbox/${encodeURIComponent(s)}?by=user&limit=${n}`)}async function Xs(t,s,n){return I(`/api/v1/groups/${encodeURIComponent(t)}/inbox/${encodeURIComponent(s)}/read`,{method:"POST",body:JSON.stringify({event_id:n,by:"user"})})}async function Zs(t,s,n,r){if(r&&r.length>0){const a=new FormData;a.append("by","user"),a.append("text",s),a.append("to_json",JSON.stringify(n)),a.append("path","");for(const o of r)a.append("files",o);return es(`/api/v1/groups/${encodeURIComponent(t)}/send_upload`,a)}return I(`/api/v1/groups/${encodeURIComponent(t)}/send`,{method:"POST",body:JSON.stringify({text:s,by:"user",to:n,path:""})})}async function Ds(t,s,n,r,a){if(a&&a.length>0){const o=new FormData;o.append("by","user"),o.append("text",s),o.append("to_json",JSON.stringify(n)),o.append("reply_to",r);for(const i of a)o.append("files",i);return es(`/api/v1/groups/${encodeURIComponent(t)}/reply_upload`,o)}return I(`/api/v1/groups/${encodeURIComponent(t)}/reply`,{method:"POST",body:JSON.stringify({text:s,by:"user",to:n,reply_to:r})})}async function er(){return I("/api/v1/runtimes")}async function tr(){return I("/api/v1/fs/recent")}async function sr(t){return I(`/api/v1/fs/list?path=${encodeURIComponent(t)}`)}async function rr(t){return I(`/api/im/status?group_id=${encodeURIComponent(t)}`)}async function nr(t){return I(`/api/im/config?group_id=${encodeURIComponent(t)}`)}async function ar(t,s,n,r){return I("/api/im/set",{method:"POST",body:JSON.stringify({group_id:t,platform:s,bot_token_env:n,app_token_env:s==="slack"?r:void 0})})}async function lr(t){return I("/api/im/unset",{method:"POST",body:JSON.stringify({group_id:t})})}async function or(t){return I("/api/im/start",{method:"POST",body:JSON.stringify({group_id:t})})}async function ir(t){return I("/api/im/stop",{method:"POST",body:JSON.stringify({group_id:t})})}async function cr(){return I("/api/v1/observability")}async function dr(t,s){return I("/api/v1/observability",{method:"PUT",body:JSON.stringify({by:"user",developer_mode:t,log_level:s})})}async function xr(t){return I(`/api/v1/debug/snapshot?group_id=${encodeURIComponent(t)}`)}async function ur(t,s,n=8e3,r=!0,a=!0){const o=new URLSearchParams({actor_id:s,max_chars:String(n),strip_ansi:String(r),compact:String(a)});return I(`/api/v1/groups/${encodeURIComponent(t)}/terminal/tail?${o.toString()}`)}async function mr(t,s){return I(`/api/v1/groups/${encodeURIComponent(t)}/terminal/clear?actor_id=${encodeURIComponent(s)}`,{method:"POST"})}async function hr(t,s,n=200){const r=new URLSearchParams({component:t,group_id:s,lines:String(n)});return I(`/api/v1/debug/tail_logs?${r.toString()}`)}async function gr(t,s){return I("/api/v1/debug/clear_logs",{method:"POST",body:JSON.stringify({component:t,group_id:s,by:"user"})})}function br({isOpen:t,onClose:s,groupId:n,context:r,onUpdateVision:a,onUpdateSketch:o,busy:i,isDark:l}){var $e;const[x,c]=u.useState(!1),[d,g]=u.useState(!1),[b,j]=u.useState(""),[N,y]=u.useState(""),[p,R]=u.useState(null),[v,f]=u.useState(!1),[S,B]=u.useState(""),[A,z]=u.useState(!1),[h,_]=u.useState(""),[L,C]=u.useState(!1),[F,q]=u.useState(!1),[T,E]=u.useState(!1),[P,V]=u.useState(""),H=u.useMemo(()=>{const w=p!=null&&p.path?String(p.path):"";return w||"PROJECT.md"},[p==null?void 0:p.path]),X=u.useMemo(()=>`PROJECT.md updated. Please re-read and align. (${H})`,[H]);u.useEffect(()=>{if(!t||!n)return;let w=!1;return f(!0),B(""),z(!1),V(""),C(!1),(async()=>{var de;const se=await I(`/api/v1/groups/${encodeURIComponent(n)}/project_md`);if(!w){if(!se.ok){R(null),B(((de=se.error)==null?void 0:de.message)||"Failed to load PROJECT.md"),f(!1);return}R(se.result),f(!1)}})(),()=>{w=!0}},[n,t]);const ee=()=>{j((r==null?void 0:r.vision)||""),c(!0)},D=async()=>{await a(b),c(!1)},ie=()=>{y((r==null?void 0:r.sketch)||""),g(!0)},ge=async()=>{await o(N),g(!1)},ce=()=>{_(p!=null&&p.content?String(p.content):""),B(""),z(!0)},Se=async()=>{var w;if(n){f(!0),B(""),V("");try{const se=await I(`/api/v1/groups/${encodeURIComponent(n)}/project_md`,{method:"PUT",body:JSON.stringify({content:h,by:"user"})});if(!se.ok){B(((w=se.error)==null?void 0:w.message)||"Failed to save PROJECT.md");return}R(se.result),z(!1),q(!1),C(!0)}finally{f(!1)}}},me=async()=>{var w;if(!n){C(!1);return}E(!0),V("");try{if(F){const se=await I(`/api/v1/groups/${encodeURIComponent(n)}/send`,{method:"POST",body:JSON.stringify({text:X,by:"user",to:["@all"],path:""})});if(!se.ok){V(((w=se.error)==null?void 0:w.message)||"Failed to notify agents");return}}C(!1)}finally{E(!1)}};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-fade-in",children:[e.jsx("div",{className:l?"absolute inset-0 bg-black/60":"absolute inset-0 bg-black/40",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:`relative rounded-xl border shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col animate-scale-in ${l?"bg-slate-900 border-slate-700":"bg-white border-gray-200"}`,role:"dialog","aria-modal":"true","aria-labelledby":"context-modal-title",children:[e.jsxs("div",{className:`flex items-center justify-between px-5 py-4 border-b ${l?"border-slate-800":"border-gray-200"}`,children:[e.jsx("h2",{id:"context-modal-title",className:`text-lg font-semibold ${l?"text-slate-100":"text-gray-900"}`,children:"ðŸ“‹ Project Context"}),e.jsx("button",{onClick:s,className:`text-xl leading-none min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg transition-colors ${l?"text-slate-400 hover:text-slate-200 hover:bg-slate-800":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,"aria-label":"Close context modal",children:"Ã—"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:`text-sm font-medium ${l?"text-slate-300":"text-gray-700"}`,children:"PROJECT.md"}),e.jsx("div",{className:`text-[11px] truncate ${l?"text-slate-500":"text-gray-500"}`,title:H,children:v?"Loadingâ€¦":p!=null&&p.found?H:p!=null&&p.path?`Missing: ${p.path}`:"Missing"})]}),!A&&e.jsx("button",{onClick:ce,disabled:v||!n,className:`text-xs min-h-[36px] px-2 rounded transition-colors disabled:opacity-50 ${l?"text-slate-400 hover:text-slate-200":"text-gray-500 hover:text-gray-700"}`,children:p!=null&&p.found?"âœï¸ Edit":"ï¼‹ Create"})]}),S&&e.jsx("div",{className:`mb-2 text-xs rounded-lg border px-3 py-2 ${l?"border-rose-500/30 bg-rose-500/10 text-rose-300":"border-rose-300 bg-rose-50 text-rose-700"}`,children:S}),A?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:h,onChange:w=>_(w.target.value),className:`w-full h-64 px-3 py-2 border rounded-lg text-sm resize-none font-mono transition-colors ${l?"bg-slate-800 border-slate-700 text-slate-200 focus:border-slate-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,placeholder:"Write your project constitution hereâ€¦"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Se,disabled:v||!n,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white text-sm rounded-lg disabled:opacity-50 min-h-[44px] transition-colors",children:v?"Saving...":"Save"}),e.jsx("button",{onClick:()=>z(!1),disabled:v,className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors disabled:opacity-50 ${l?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Cancel"})]})]}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm whitespace-pre-wrap min-h-[60px] max-h-[220px] overflow-auto ${l?"bg-slate-800/50 text-slate-300":"bg-gray-50 text-gray-700"}`,children:p!=null&&p.found&&p.content?String(p.content):e.jsx("span",{className:l?"text-slate-500 italic":"text-gray-400 italic",children:"No PROJECT.md found"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:`text-sm font-medium ${l?"text-slate-300":"text-gray-700"}`,children:"Vision"}),!x&&e.jsx("button",{onClick:ee,className:`text-xs min-h-[36px] px-2 rounded transition-colors ${l?"text-slate-400 hover:text-slate-200":"text-gray-500 hover:text-gray-700"}`,children:"âœï¸ Edit"})]}),x?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:b,onChange:w=>j(w.target.value),className:`w-full h-32 px-3 py-2 border rounded-lg text-sm resize-none transition-colors ${l?"bg-slate-800 border-slate-700 text-slate-200 focus:border-slate-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,placeholder:"Describe the project vision..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:D,disabled:i,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white text-sm rounded-lg disabled:opacity-50 min-h-[44px] transition-colors",children:i?"Saving...":"Save"}),e.jsx("button",{onClick:()=>c(!1),className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors ${l?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Cancel"})]})]}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm whitespace-pre-wrap min-h-[60px] ${l?"bg-slate-800/50 text-slate-300":"bg-gray-50 text-gray-700"}`,children:(r==null?void 0:r.vision)||e.jsx("span",{className:l?"text-slate-500 italic":"text-gray-400 italic",children:"No vision set"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:`text-sm font-medium ${l?"text-slate-300":"text-gray-700"}`,children:"Sketch"}),!d&&e.jsx("button",{onClick:ie,className:`text-xs min-h-[36px] px-2 rounded transition-colors ${l?"text-slate-400 hover:text-slate-200":"text-gray-500 hover:text-gray-700"}`,children:"âœï¸ Edit"})]}),d?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:N,onChange:w=>y(w.target.value),className:`w-full h-32 px-3 py-2 border rounded-lg text-sm resize-none transition-colors ${l?"bg-slate-800 border-slate-700 text-slate-200 focus:border-slate-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,placeholder:"Technical sketch or architecture notes..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ge,disabled:i,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white text-sm rounded-lg disabled:opacity-50 min-h-[44px] transition-colors",children:i?"Saving...":"Save"}),e.jsx("button",{onClick:()=>g(!1),className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors ${l?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Cancel"})]})]}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm whitespace-pre-wrap min-h-[60px] ${l?"bg-slate-800/50 text-slate-300":"bg-gray-50 text-gray-700"}`,children:(r==null?void 0:r.sketch)||e.jsx("span",{className:l?"text-slate-500 italic":"text-gray-400 italic",children:"No sketch set"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium mb-2 ${l?"text-slate-300":"text-gray-700"}`,children:"Milestones"}),r!=null&&r.milestones&&r.milestones.length>0?e.jsx("div",{className:"space-y-2",children:r.milestones.map(w=>e.jsxs("div",{className:`px-3 py-2 rounded-lg space-y-1 ${l?"bg-slate-800/50":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:m("text-[11px] px-1.5 py-0.5 rounded flex-shrink-0",l?"bg-slate-700 text-slate-300":"bg-gray-200 text-gray-700"),children:w.id}),e.jsx("span",{className:`text-sm font-medium min-w-0 truncate ${l?"text-slate-200":"text-gray-800"}`,children:w.name}),e.jsx("span",{className:m("text-[11px] px-2 py-0.5 rounded flex-shrink-0 ml-auto",w.status==="done"?l?"bg-emerald-900/50 text-emerald-300":"bg-emerald-100 text-emerald-700":w.status==="active"?l?"bg-blue-900/50 text-blue-300":"bg-blue-100 text-blue-700":l?"bg-slate-700 text-slate-400":"bg-gray-200 text-gray-600"),children:w.status||"pending"})]}),(w.started||w.completed)&&e.jsxs("div",{className:`text-[11px] ${l?"text-slate-500":"text-gray-500"}`,children:[w.started?`started ${w.started}`:"",w.started&&w.completed?" Â· ":"",w.completed?`completed ${w.completed}`:""]}),w.description&&e.jsx("div",{className:`text-xs whitespace-pre-wrap ${l?"text-slate-400":"text-gray-600"}`,children:w.description})]},w.id))}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No milestones"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium mb-2 ${l?"text-slate-300":"text-gray-700"}`,children:"Tasks"}),r!=null&&r.tasks_summary?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`px-3 py-2 rounded-lg text-xs ${l?"bg-slate-800/50 text-slate-300":"bg-gray-50 text-gray-700"}`,children:["total ",r.tasks_summary.total," Â· active ",r.tasks_summary.active," Â· planned ",r.tasks_summary.planned," Â· done ",r.tasks_summary.done]}),r.active_task?e.jsxs("div",{className:`px-3 py-2 rounded-lg ${l?"bg-slate-800/50":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:`text-[11px] px-1.5 py-0.5 rounded ${l?"bg-slate-700 text-slate-300":"bg-gray-200 text-gray-700"}`,children:r.active_task.id}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:`text-sm font-medium truncate ${l?"text-slate-200":"text-gray-800"}`,children:r.active_task.name}),r.active_task.goal&&e.jsx("div",{className:`text-xs mt-0.5 whitespace-pre-wrap ${l?"text-slate-400":"text-gray-600"}`,children:r.active_task.goal})]}),e.jsx("span",{className:m("text-[11px] px-2 py-0.5 rounded flex-shrink-0",r.active_task.status==="done"?l?"bg-emerald-900/50 text-emerald-300":"bg-emerald-100 text-emerald-700":r.active_task.status==="active"?l?"bg-blue-900/50 text-blue-300":"bg-blue-100 text-blue-700":l?"bg-slate-700 text-slate-400":"bg-gray-200 text-gray-600"),children:r.active_task.status||"planned"})]}),(r.active_task.assignee||r.active_task.milestone)&&e.jsxs("div",{className:`text-[11px] mt-1 ${l?"text-slate-500":"text-gray-500"}`,children:[r.active_task.milestone?`milestone ${r.active_task.milestone}`:"",r.active_task.milestone&&r.active_task.assignee?" Â· ":"",r.active_task.assignee?`assignee ${r.active_task.assignee}`:""]}),Array.isArray(r.active_task.steps)&&r.active_task.steps.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:r.active_task.steps.map(w=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:`text-[11px] px-1.5 py-0.5 rounded ${l?"bg-slate-700 text-slate-300":"bg-gray-200 text-gray-700"}`,children:w.id}),e.jsxs("div",{className:`text-xs flex-1 ${l?"text-slate-300":"text-gray-700"}`,children:[w.name,w.acceptance?e.jsx("div",{className:m("mt-0.5 whitespace-pre-wrap",l?"text-slate-500":"text-gray-500"),children:w.acceptance}):null]}),e.jsx("span",{className:`text-[11px] ${l?"text-slate-500":"text-gray-500"}`,children:w.status||""})]},w.id))})]}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No active task"})]}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No task summary"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium mb-2 ${l?"text-slate-300":"text-gray-700"}`,children:"Notes"}),r!=null&&r.notes&&r.notes.length>0?e.jsx("div",{className:"space-y-2",children:r.notes.map(w=>e.jsxs("div",{className:`px-3 py-2 rounded-lg ${l?"bg-slate-800/50":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${l?"bg-slate-700 text-slate-300":"bg-gray-200 text-gray-700"}`,children:w.id}),typeof w.ttl=="number"&&e.jsxs("span",{className:`text-[11px] ${l?"text-slate-500":"text-gray-500"}`,children:["ttl ",w.ttl]}),w.expiring?e.jsx("span",{className:`text-[11px] ${l?"text-amber-300":"text-amber-600"}`,children:"expiring"}):null]}),e.jsx("div",{className:`text-xs mt-1 whitespace-pre-wrap ${l?"text-slate-300":"text-gray-700"}`,children:w.content})]},w.id))}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No notes"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium mb-2 ${l?"text-slate-300":"text-gray-700"}`,children:"References"}),r!=null&&r.references&&r.references.length>0?e.jsx("div",{className:"space-y-2",children:r.references.map(w=>e.jsxs("div",{className:`px-3 py-2 rounded-lg ${l?"bg-slate-800/50":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${l?"bg-slate-700 text-slate-400":"bg-gray-200 text-gray-600"}`,children:w.id}),e.jsx("a",{href:w.url,target:"_blank",rel:"noopener noreferrer",className:`text-sm truncate hover:underline ${l?"text-blue-400":"text-blue-600"}`,title:w.url,children:w.url})]}),w.note?e.jsx("div",{className:`text-xs mt-1 whitespace-pre-wrap ${l?"text-slate-400":"text-gray-600"}`,children:w.note}):null]},w.id))}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No references"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium mb-2 ${l?"text-slate-300":"text-gray-700"}`,children:"Presence"}),($e=r==null?void 0:r.presence)!=null&&$e.agents&&r.presence.agents.length>0?e.jsx("div",{className:"space-y-2",children:r.presence.agents.map(w=>e.jsxs("div",{className:`px-3 py-2 rounded-lg ${l?"bg-slate-800/50":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium ${l?"text-slate-200":"text-gray-800"}`,children:w.id}),w.updated_at?e.jsx("span",{className:`text-[11px] ml-auto ${l?"text-slate-500":"text-gray-500"}`,children:w.updated_at}):null]}),w.status?e.jsx("div",{className:`text-xs mt-1 whitespace-pre-wrap ${l?"text-slate-300":"text-gray-700"}`,children:w.status}):e.jsx("div",{className:`text-xs mt-1 italic ${l?"text-slate-500":"text-gray-500"}`,children:"No status"})]},w.id))}):e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm italic ${l?"bg-slate-800/50 text-slate-500":"bg-gray-50 text-gray-400"}`,children:"No presence"})]})]})]}),L&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 animate-fade-in",children:[e.jsx("div",{className:l?"absolute inset-0 bg-black/70":"absolute inset-0 bg-black/50",onClick:()=>{T||C(!1)},"aria-hidden":"true"}),e.jsxs("div",{className:`relative w-full max-w-md rounded-xl border shadow-2xl p-4 ${l?"bg-slate-900 border-slate-700":"bg-white border-gray-200"}`,role:"dialog","aria-modal":"true","aria-label":"Project updated",children:[e.jsx("div",{className:`text-sm font-semibold ${l?"text-slate-100":"text-gray-900"}`,children:"PROJECT.md saved"}),e.jsx("div",{className:`text-xs mt-1 ${l?"text-slate-400":"text-gray-500"}`,children:H}),P&&e.jsx("div",{className:`mt-3 text-xs rounded-lg border px-3 py-2 ${l?"border-rose-500/30 bg-rose-500/10 text-rose-300":"border-rose-300 bg-rose-50 text-rose-700"}`,children:P}),e.jsxs("label",{className:`mt-3 flex items-center gap-2 text-sm ${l?"text-slate-200":"text-gray-800"}`,children:[e.jsx("input",{type:"checkbox",checked:F,onChange:w=>q(w.target.checked),disabled:T}),"Notify agents in chat (@all)"]}),e.jsx("div",{className:`mt-2 text-[11px] rounded-lg px-3 py-2 whitespace-pre-wrap ${l?"bg-slate-800/60 text-slate-300":"bg-gray-50 text-gray-700"}`,children:X}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:me,disabled:T,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded-lg disabled:opacity-50 min-h-[44px] transition-colors",children:T?"Working...":"Done"}),e.jsx("button",{onClick:()=>C(!1),disabled:T,className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors disabled:opacity-50 ${l?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Close"})]})]})]})]}):null}const ne=t=>`w-full px-3 py-2.5 rounded-lg border text-sm min-h-[44px] transition-colors ${t?"bg-slate-800 border-slate-700 text-slate-200 focus:border-slate-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,ue=t=>`block text-xs mb-1 ${t?"text-slate-400":"text-gray-500"}`,vt=t=>"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white text-sm rounded-lg disabled:opacity-50 min-h-[44px] transition-colors font-medium",Oe=t=>`rounded-lg border p-3 ${t?"border-slate-800 bg-slate-950/30":"border-gray-200 bg-gray-50"}`,De=t=>`mt-2 p-2 rounded overflow-x-auto whitespace-pre text-[11px] ${t?"bg-slate-900 text-slate-200":"bg-white text-gray-800 border border-gray-200"}`;function pr({isDark:t,busy:s,nudgeSeconds:n,setNudgeSeconds:r,idleSeconds:a,setIdleSeconds:o,keepaliveSeconds:i,setKeepaliveSeconds:l,silenceSeconds:x,setSilenceSeconds:c,deliveryInterval:d,setDeliveryInterval:g,standupInterval:b,setStandupInterval:j,onSave:N}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Group Timing"}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-500"}`,children:"These settings apply to the current working group."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:ue(t),children:"Nudge After (sec)"}),e.jsx("input",{type:"number",value:n,onChange:y=>r(Number(y.target.value)),className:ne(t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:ue(t),children:"Actor Idle (sec)"}),e.jsx("input",{type:"number",value:a,onChange:y=>o(Number(y.target.value)),className:ne(t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:ue(t),children:"Keepalive (sec)"}),e.jsx("input",{type:"number",value:i,onChange:y=>l(Number(y.target.value)),className:ne(t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:ue(t),children:"Silence (sec)"}),e.jsx("input",{type:"number",value:x,onChange:y=>c(Number(y.target.value)),className:ne(t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:ue(t),children:"Delivery Interval (sec)"}),e.jsx("input",{type:"number",value:d,onChange:y=>g(Number(y.target.value)),className:ne(t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:ue(t),children:"Standup Interval (sec)"}),e.jsx("input",{type:"number",value:b,onChange:y=>j(Number(y.target.value)),className:ne(t)}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-400"}`,children:"Periodic review reminder (default 900 = 15 min)"})]})]}),e.jsx("button",{onClick:N,disabled:s,className:vt(),children:s?"Saving...":"Save Timing Settings"})]})}function fr({isDark:t,groupId:s,imStatus:n,imPlatform:r,setImPlatform:a,imBotTokenEnv:o,setImBotTokenEnv:i,imAppTokenEnv:l,setImAppTokenEnv:x,imBusy:c,onSaveConfig:d,onRemoveConfig:g,onStartBridge:b,onStopBridge:j}){const N=()=>{switch(r){case"telegram":return"Bot Token (token or env var)";case"slack":return"Bot Token (xoxb- or env var)";case"discord":return"Bot Token (token or env var)"}},y=()=>{switch(r){case"telegram":return"TELEGRAM_BOT_TOKEN (or 123456:ABC...)";case"slack":return"SLACK_BOT_TOKEN (or xoxb-...)";case"discord":return"DISCORD_BOT_TOKEN (or <token>)"}},p=()=>!(!o||r==="slack"&&!l);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"IM Bridge"}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-500"}`,children:"Connect this group to Telegram, Slack, or Discord."})]}),n&&e.jsxs("div",{className:Oe(t),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${n.running?"bg-emerald-500":"bg-gray-400"}`}),e.jsx("span",{className:`text-sm ${t?"text-slate-300":"text-gray-700"}`,children:n.running?"Running":"Stopped"}),n.running&&n.pid&&e.jsxs("span",{className:`text-xs ${t?"text-slate-500":"text-gray-500"}`,children:["(PID: ",n.pid,")"]})]}),n.configured&&e.jsxs("div",{className:`text-xs mt-1 ${t?"text-slate-400":"text-gray-500"}`,children:["Platform: ",n.platform," â€¢ Subscribers: ",n.subscribers]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:ue(t),children:"Platform"}),e.jsxs("select",{value:r,onChange:R=>a(R.target.value),className:ne(t),children:[e.jsx("option",{value:"telegram",children:"Telegram"}),e.jsx("option",{value:"slack",children:"Slack"}),e.jsx("option",{value:"discord",children:"Discord"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:ue(t),children:N()}),e.jsx("input",{type:"text",value:o,onChange:R=>i(R.target.value),placeholder:y(),className:`${ne(t)} placeholder:${t?"text-slate-600":"text-gray-400"}`}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-400"}`,children:r==="slack"?"Paste xoxb-â€¦ token or an env var name; required for outbound messages.":"Paste the bot token or an env var name; required for bot authentication."})]}),r==="slack"&&e.jsxs("div",{children:[e.jsx("label",{className:ue(t),children:"App Token (xapp- or env var)"}),e.jsx("input",{type:"text",value:l,onChange:R=>x(R.target.value),placeholder:"SLACK_APP_TOKEN (or xapp-...)",className:`${ne(t)} placeholder:${t?"text-slate-600":"text-gray-400"}`}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-400"}`,children:"Optional; needed for inbound messages (Socket Mode)."})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:d,disabled:c||!p(),className:vt(),children:c?"Saving...":"Save Config"}),(n==null?void 0:n.configured)&&e.jsxs(e.Fragment,{children:[n.running?e.jsx("button",{onClick:j,disabled:c,className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors font-medium ${t?"bg-red-900/50 hover:bg-red-800/50 text-red-300":"bg-red-100 hover:bg-red-200 text-red-700"} disabled:opacity-50`,children:"Stop Bridge"}):e.jsx("button",{onClick:b,disabled:c,className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors font-medium ${t?"bg-blue-900/50 hover:bg-blue-800/50 text-blue-300":"bg-blue-100 hover:bg-blue-200 text-blue-700"} disabled:opacity-50`,children:"Start Bridge"}),e.jsx("button",{onClick:g,disabled:c,className:`px-4 py-2 text-sm rounded-lg min-h-[44px] transition-colors font-medium ${t?"bg-slate-800 hover:bg-slate-700 text-slate-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"} disabled:opacity-50`,children:"Remove Config"})]})]}),e.jsxs("div",{className:`text-xs space-y-1 ${t?"text-slate-500":"text-gray-500"}`,children:[e.jsx("p",{children:"To use IM Bridge:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-0.5 ml-2",children:[e.jsx("li",{children:"Create a bot on your IM platform"}),e.jsx("li",{children:"Set the token(s) as environment variable(s)"}),e.jsx("li",{children:"Save the config and start the bridge"}),e.jsx("li",{children:"In your IM chat, send /subscribe to receive messages"})]})]})]})}function yr({isDark:t,busy:s,groupId:n,devActors:r,terminalVisibility:a,setTerminalVisibility:o,terminalNotifyTail:i,setTerminalNotifyTail:l,terminalNotifyLines:x,setTerminalNotifyLines:c,onSaveTranscriptSettings:d,tailActorId:g,setTailActorId:b,tailMaxChars:j,setTailMaxChars:N,tailStripAnsi:y,setTailStripAnsi:p,tailCompact:R,setTailCompact:v,tailText:f,tailHint:S,tailErr:B,tailBusy:A,tailCopyInfo:z,onLoadTail:h,onCopyTail:_,onClearTail:L}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Terminal transcript"}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-500"}`,children:"Readable tail for troubleshooting. User can always view; agent access is controlled by the policy below."})]}),e.jsxs("div",{className:Oe(t),children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Policy"}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs mb-1 ${t?"text-slate-400":"text-gray-600"}`,children:"Visibility to agents"}),e.jsxs("select",{value:a,onChange:C=>{const F=C.target.value;(F==="off"||F==="foreman"||F==="all")&&o(F)},className:ne(t),children:[e.jsx("option",{value:"off",children:"off (agents cannot read others)"}),e.jsx("option",{value:"foreman",children:"foreman (foreman can read peers)"}),e.jsx("option",{value:"all",children:"all (any agent can read others)"})]}),e.jsx("div",{className:`mt-1 text-[11px] ${t?"text-slate-500":"text-gray-600"}`,children:"Tip: This only affects agents. The Web UI user can always view transcripts."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:`inline-flex items-center gap-2 text-sm ${t?"text-slate-300":"text-gray-700"}`,children:[e.jsx("input",{type:"checkbox",checked:i,onChange:C=>l(C.target.checked),className:"h-4 w-4"}),"Include tail in idle notifications"]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs mb-1 ${t?"text-slate-400":"text-gray-600"}`,children:"Notification lines"}),e.jsx("input",{type:"number",value:x,min:1,max:80,onChange:C=>c(Number(C.target.value||20)),disabled:!i,className:`${ne(t)} disabled:opacity-60`})]})]}),e.jsx("button",{onClick:d,disabled:s,className:vt(),children:s?"Saving...":"Save transcript settings"})]})]}),e.jsxs("div",{className:Oe(t),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Tail viewer"}),e.jsx("div",{className:`text-xs mt-0.5 ${t?"text-slate-500":"text-gray-600"}`,children:"Best-effort transcript tail from the actor PTY ring buffer."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,disabled:!n||!g||A,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-800 hover:bg-slate-700 text-slate-200":"bg-white hover:bg-gray-50 text-gray-800 border border-gray-200"} disabled:opacity-50`,children:A?"Loading...":"Refresh"}),e.jsx("button",{onClick:()=>_(50),disabled:!f.trim(),className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-900 hover:bg-slate-800 text-slate-300 border border-slate-800":"bg-white hover:bg-gray-50 text-gray-700 border border-gray-200"} disabled:opacity-50`,children:"Copy last 50 lines"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2",children:[e.jsx("label",{className:`block text-xs ${t?"text-slate-400":"text-gray-600"}`,children:"Actor"}),e.jsxs("select",{value:g,onChange:C=>b(C.target.value),className:ne(t),children:[r.map(C=>e.jsxs("option",{value:C.id,children:[C.id,C.role?` (${C.role})`:""]},C.id)),!r.length&&e.jsx("option",{value:"",children:"(no actors)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs mb-1 ${t?"text-slate-400":"text-gray-600"}`,children:"Max chars"}),e.jsx("input",{type:"number",value:j,min:1e3,max:2e5,onChange:C=>N(Number(C.target.value||8e3)),className:ne(t)})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsx("button",{onClick:L,disabled:!n||!g||A,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-rose-900/30 hover:bg-rose-900/40 text-rose-200 border border-rose-900/30":"bg-rose-50 hover:bg-rose-100 text-rose-700 border border-rose-200"} disabled:opacity-50`,children:"Clear (truncate)"})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:`inline-flex items-center gap-2 text-sm ${t?"text-slate-300":"text-gray-700"}`,children:[e.jsx("input",{type:"checkbox",checked:y,onChange:C=>p(C.target.checked),className:"h-4 w-4"}),"Strip ANSI"]}),e.jsxs("label",{className:`inline-flex items-center gap-2 text-sm ${t?"text-slate-300":"text-gray-700"}`,children:[e.jsx("input",{type:"checkbox",checked:R,disabled:!y,onChange:C=>v(C.target.checked),className:"h-4 w-4"}),"Compact repeated frames"]})]})]}),!!z&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-emerald-300":"text-emerald-700"}`,children:z}),B&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-rose-300":"text-rose-600"}`,children:B}),S&&!B&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-slate-500":"text-gray-600"}`,children:S}),e.jsx("pre",{className:`${De(t)} max-h-[300px] overflow-y-auto`,children:e.jsx("code",{children:f||"â€”"})})]})]})}function vr({isDark:t}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Remote Access (Phone)"}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-500"}`,children:'Recommended for "anywhere access": use Cloudflare Tunnel or Tailscale. CCCC does not manage these for you yetâ€”this is a setup guide.'}),e.jsxs("div",{className:`mt-2 rounded-lg border px-3 py-2 text-[11px] ${t?"border-amber-500/30 bg-amber-500/10 text-amber-200":"border-amber-200 bg-amber-50 text-amber-800"}`,children:[e.jsx("div",{className:"font-medium",children:"Security note"}),e.jsxs("div",{className:"mt-1",children:["Treat the Web UI as ",e.jsx("span",{className:"font-medium",children:"high privilege"})," (it can control agents and access project files). Do not expose it to the public internet without access control (e.g., Cloudflare Access)."]})]})]}),e.jsxs("div",{className:Oe(t),children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Cloudflare Tunnel (recommended)"}),e.jsx("div",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-600"}`,children:"Easiest for phone access: no VPN app required. Pair with Cloudflare Zero Trust Access for login protection."}),e.jsx("div",{className:`mt-3 text-xs font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Quick (temporary URL)"}),e.jsx("pre",{className:De(t),children:e.jsx("code",{children:`# Install cloudflared first, then:
cloudflared tunnel --url http://127.0.0.1:8848
# It will print a https://....trycloudflare.com URL`})}),e.jsx("div",{className:`mt-3 text-xs font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Stable (your domain)"}),e.jsx("pre",{className:De(t),children:e.jsx("code",{children:`# 1) Authenticate
cloudflared tunnel login

# 2) Create a named tunnel
cloudflared tunnel create cccc

# 3) Route DNS (replace with your hostname)
cloudflared tunnel route dns cccc cccc.example.com

# 4) Create ~/.cloudflared/config.yml (example):
# tunnel: <TUNNEL-UUID>
# credentials-file: /home/<you>/.cloudflared/<TUNNEL-UUID>.json
# ingress:
#   - hostname: cccc.example.com
#     service: http://127.0.0.1:8848
#   - service: http_status:404

# 5) Run
cloudflared tunnel run cccc`})}),e.jsx("div",{className:`mt-2 text-[11px] ${t?"text-slate-500":"text-gray-600"}`,children:'Tip: In Cloudflare Zero Trust â†’ Access â†’ Applications, create a "Self-hosted" app for your hostname to require login.'})]}),e.jsxs("div",{className:Oe(t),children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Tailscale (VPN)"}),e.jsx("div",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-600"}`,children:"Strong option if you're okay installing Tailscale on your phone. You can keep CCCC bound to a private interface."}),e.jsx("pre",{className:De(t),children:e.jsx("code",{children:`# 1) Install Tailscale on the server + phone, then on the server:
tailscale up

# 2) Get your tailnet IP
TAILSCALE_IP=$(tailscale ip -4)

# 3) Bind Web UI to that IP (so it's only reachable via tailnet)
CCCC_WEB_HOST=$TAILSCALE_IP CCCC_WEB_PORT=8848 cccc

# 4) On phone browser:
# http://<TAILSCALE_IP>:8848/ui/`})})]}),e.jsx("div",{className:`text-xs ${t?"text-slate-500":"text-gray-500"}`,children:'Phone tip: On iOS/Android you can "Add to Home Screen" for an app-like launcher (PWA-style).'})]})}function jr({isDark:t,groupId:s,developerMode:n,setDeveloperMode:r,logLevel:a,setLogLevel:o,obsBusy:i,onSaveObservability:l,debugSnapshot:x,debugSnapshotErr:c,debugSnapshotBusy:d,onLoadDebugSnapshot:g,onClearDebugSnapshot:b,logComponent:j,setLogComponent:N,logLines:y,setLogLines:p,logText:R,logErr:v,logBusy:f,onLoadLogTail:S,onClearLogs:B}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium ${t?"text-slate-300":"text-gray-700"}`,children:"Developer Mode (Global)"}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-500"}`,children:"These settings apply to the whole CCCC instance (daemon + Web). Use this only when debugging."}),e.jsxs("div",{className:`mt-2 rounded-lg border px-3 py-2 text-[11px] ${t?"border-amber-500/30 bg-amber-500/10 text-amber-200":"border-amber-200 bg-amber-50 text-amber-800"}`,children:[e.jsx("div",{className:"font-medium",children:"Warning"}),e.jsx("div",{className:"mt-1",children:"Developer mode enables verbose logs and extra diagnostics. Only enable it when you need it."})]})]}),e.jsxs("div",{className:Oe(t),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Enable developer mode"}),e.jsx("div",{className:`text-xs mt-0.5 ${t?"text-slate-500":"text-gray-600"}`,children:"Enables debug snapshot and log tail tools."})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:n,onChange:A=>r(A.target.checked)}),e.jsx("div",{className:`w-11 h-6 rounded-full transition-colors ${n?t?"bg-emerald-600":"bg-emerald-500":t?"bg-slate-700":"bg-gray-300"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform mt-0.5 ${n?"translate-x-5":"translate-x-0.5"}`})})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:ue(t),children:"Log level"}),e.jsxs("select",{value:a,onChange:A=>o(A.target.value==="DEBUG"?"DEBUG":"INFO"),className:ne(t),children:[e.jsx("option",{value:"INFO",children:"INFO"}),e.jsx("option",{value:"DEBUG",children:"DEBUG"})]})]}),e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsx("button",{onClick:l,disabled:i,className:vt(),children:i?"Saving...":"Save Developer Settings"})})]}),e.jsxs("div",{className:Oe(t),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Debug snapshot (this group)"}),e.jsx("div",{className:`text-xs mt-0.5 ${t?"text-slate-500":"text-gray-600"}`,children:"Shows daemon/actors state + delivery throttle summary (developer mode only)."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:g,disabled:!n||!s||d,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-800 hover:bg-slate-700 text-slate-200":"bg-white hover:bg-gray-50 text-gray-800 border border-gray-200"} disabled:opacity-50`,children:d?"Loading...":"Refresh"}),e.jsx("button",{onClick:b,disabled:d,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-900 hover:bg-slate-800 text-slate-300 border border-slate-800":"bg-white hover:bg-gray-50 text-gray-700 border border-gray-200"} disabled:opacity-50`,children:"Clear"})]})]}),!s&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-slate-500":"text-gray-600"}`,children:"Open Settings from an active group to view group-scoped debug info."}),c&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-rose-300":"text-rose-600"}`,children:c}),e.jsx("pre",{className:De(t),children:e.jsx("code",{children:x||"â€”"})})]}),e.jsxs("div",{className:Oe(t),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-semibold ${t?"text-slate-200":"text-gray-800"}`,children:"Log tail"}),e.jsx("div",{className:`text-xs mt-0.5 ${t?"text-slate-500":"text-gray-600"}`,children:'Tails local log files (developer mode only). Component "im" is group-scoped.'})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:S,disabled:!n||f,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-800 hover:bg-slate-700 text-slate-200":"bg-white hover:bg-gray-50 text-gray-800 border border-gray-200"} disabled:opacity-50`,children:f?"Loading...":"Refresh"}),e.jsx("button",{onClick:B,disabled:!n||f,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${t?"bg-slate-900 hover:bg-slate-800 text-slate-300 border border-slate-800":"bg-white hover:bg-gray-50 text-gray-700 border border-gray-200"} disabled:opacity-50`,children:"Clear (truncate)"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:ue(t),children:"Component"}),e.jsxs("select",{value:j,onChange:A=>N(A.target.value==="im"?"im":A.target.value==="web"?"web":"daemon"),className:ne(t),children:[e.jsx("option",{value:"daemon",children:"daemon"}),e.jsx("option",{value:"web",children:"web"}),e.jsx("option",{value:"im",children:"im"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:ue(t),children:"Lines"}),e.jsx("input",{type:"number",value:y,min:50,max:2e3,onChange:A=>p(Number(A.target.value||200)),className:ne(t)})]})]}),j==="im"&&!s&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-slate-500":"text-gray-600"}`,children:"IM logs require a group_id; open Settings from a group."}),v&&e.jsx("div",{className:`mt-2 text-xs ${t?"text-rose-300":"text-rose-600"}`,children:v}),e.jsx("pre",{className:`${De(t)} max-h-[260px] overflow-y-auto`,children:e.jsx("code",{children:R||"â€”"})})]})]})}function Nr({isOpen:t,onClose:s,settings:n,onUpdateSettings:r,busy:a,isDark:o,groupId:i}){const[l,x]=u.useState(i?"group":"global"),[c,d]=u.useState("timing"),[g,b]=u.useState("remote"),[j,N]=u.useState(300),[y,p]=u.useState(600),[R,v]=u.useState(120),[f,S]=u.useState(600),[B,A]=u.useState(0),[z,h]=u.useState(900),[_,L]=u.useState("foreman"),[C,F]=u.useState(!1),[q,T]=u.useState(20),[E,P]=u.useState(""),[V,H]=u.useState(8e3),[X,ee]=u.useState(!0),[D,ie]=u.useState(!0),[ge,ce]=u.useState(""),[Se,me]=u.useState(""),[$e,w]=u.useState(""),[se,de]=u.useState(!1),[Ge,ae]=u.useState(""),[be,We]=u.useState(null),[pe,Te]=u.useState("telegram"),[qe,Ee]=u.useState(""),[ve,Ae]=u.useState(""),[Ie,le]=u.useState(!1),[fe,Pe]=u.useState(!1),[Je,Ve]=u.useState("INFO"),[st,Be]=u.useState(!1),[rt,nt]=u.useState([]),[at,_e]=u.useState(""),[lt,Re]=u.useState(""),[ke,Le]=u.useState(!1),[je,ot]=u.useState("daemon"),[Fe,it]=u.useState(200),[ct,Me]=u.useState(""),[Ue,oe]=u.useState(""),[He,Ne]=u.useState(!1);u.useEffect(()=>{t&&n&&(N(n.nudge_after_seconds),p(n.actor_idle_timeout_seconds),v(n.keepalive_delay_seconds),S(n.silence_timeout_seconds),A(n.min_interval_seconds),h(n.standup_interval_seconds??900),L(n.terminal_transcript_visibility||"foreman"),F(!!n.terminal_transcript_notify_tail),T(Number(n.terminal_transcript_notify_lines||20)))},[t,n]),u.useEffect(()=>{t&&x(i?"group":"global")},[t,i]),u.useEffect(()=>{t&&i&&he()},[t,i]),u.useEffect(()=>{t&&Ke()},[t]),u.useEffect(()=>{t&&i&&te()},[t,i]);const he=async()=>{if(i)try{const O=await rr(i);O.ok&&(We(O.result),O.result.platform&&Te(O.result.platform));const U=await nr(i);if(U.ok&&U.result.im){const Y=U.result.im;Y.platform&&Te(Y.platform),Ee(Y.bot_token_env||Y.token_env||Y.token||""),Ae(Y.app_token_env||"")}}catch(O){console.error("Failed to load IM status:",O)}},Ke=async()=>{var O;try{const U=await cr();if(U.ok&&((O=U.result)!=null&&O.observability)){const Y=U.result.observability;Pe(!!Y.developer_mode);const Q=String(Y.log_level||"INFO").toUpperCase();Ve(Q==="DEBUG"?"DEBUG":"INFO")}}catch{}},te=async()=>{var O;if(i)try{const U=await Rt(i);if(U.ok&&((O=U.result)!=null&&O.actors)){const Y=Array.isArray(U.result.actors)?U.result.actors:[];nt(Y),!E&&Y.length>0&&P(Y[0].id)}}catch{}},dt=async()=>{await r({nudge_after_seconds:j,actor_idle_timeout_seconds:y,keepalive_delay_seconds:R,silence_timeout_seconds:f,min_interval_seconds:B,standup_interval_seconds:z})},Ye=async()=>{await r({terminal_transcript_visibility:_,terminal_transcript_notify_tail:C,terminal_transcript_notify_lines:q})},M=async O=>{const U=Math.max(1,Math.min(200,Number(O||0)||50)),Y=String(ge||"");if(!Y.trim())return;const Q=Y.split(`
`),wt=Q.slice(Math.max(0,Q.length-U)).join(`
`).trimEnd();if(!wt)return;const Ct=ye=>{ae(ye),window.setTimeout(()=>ae(""),1200)};try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(wt),Ct(`Copied last ${U} lines`);return}}catch{}try{const ye=document.createElement("textarea");ye.value=wt,ye.style.position="fixed",ye.style.left="-9999px",ye.style.top="0",document.body.appendChild(ye),ye.focus(),ye.select();const Cs=document.execCommand("copy");document.body.removeChild(ye),Ct(Cs?`Copied last ${U} lines`:"Copy failed")}catch{Ct("Copy failed")}},k=async()=>{var O,U,Y;if(!(!i||!E)){de(!0),w("");try{const Q=await ur(i,E,V||8e3,X,D);Q.ok?(ce(String(((O=Q.result)==null?void 0:O.text)||"")),me(String(((U=Q.result)==null?void 0:U.hint)||""))):(ce(""),me(""),w(((Y=Q.error)==null?void 0:Y.message)||"Failed to load terminal transcript"))}catch{ce(""),me(""),w("Failed to load terminal transcript")}finally{de(!1)}}},G=async()=>{var O;if(!(!i||!E)){de(!0),w("");try{const U=await mr(i,E);if(!U.ok){w(((O=U.error)==null?void 0:O.message)||"Failed to clear terminal transcript");return}ce(""),me("")}catch{w("Failed to clear terminal transcript")}finally{de(!1)}}},re=async()=>{if(i){le(!0);try{(await ar(i,pe,qe,ve)).ok&&await he()}catch(O){console.error("Failed to save IM config:",O)}finally{le(!1)}}},xe=async()=>{if(i){le(!0);try{(await lr(i)).ok&&(Ee(""),Ae(""),await he())}catch(O){console.error("Failed to remove IM config:",O)}finally{le(!1)}}},Qe=async()=>{if(i){le(!0);try{await or(i),await he()}catch(O){console.error("Failed to start bridge:",O)}finally{le(!1)}}},jt=async()=>{if(i){le(!0);try{await ir(i),await he()}catch(O){console.error("Failed to stop bridge:",O)}finally{le(!1)}}},mt=async()=>{Be(!0);try{(await dr(fe,Je)).ok&&await Ke()}catch{}finally{Be(!1)}},ht=async()=>{var O;if(i){Le(!0),Re("");try{const U=await xr(i);U.ok?_e(JSON.stringify(U.result??{},null,2)):(_e(""),Re(((O=U.error)==null?void 0:O.message)||"Failed to load debug snapshot"))}catch{_e(""),Re("Failed to load debug snapshot")}finally{Le(!1)}}},gt=async()=>{var O,U;Ne(!0),oe("");try{const Y=await hr(je,i||"",Fe||200);if(Y.ok){const Q=Array.isArray((O=Y.result)==null?void 0:O.lines)?Y.result.lines:[];Me(Q.join(`
`))}else Me(""),oe(((U=Y.error)==null?void 0:U.message)||"Failed to tail logs")}catch{Me(""),oe("Failed to tail logs")}finally{Ne(!1)}},Nt=async()=>{var O;if(fe){if(je==="im"&&!i){oe("IM logs require a group_id; open Settings from a group.");return}Ne(!0),oe("");try{const U=await gr(je,i||"");if(!U.ok){oe(((O=U.error)==null?void 0:O.message)||"Failed to clear logs");return}Me("")}catch{oe("Failed to clear logs")}finally{Ne(!1)}}};if(!t)return null;const W=l==="group"?[{id:"timing",label:"Timing"},{id:"im",label:"IM Bridge"},{id:"transcript",label:"Transcript"}]:[{id:"remote",label:"Remote Access"},{id:"developer",label:"Developer"}],Z=l==="group"?c:g,J=O=>{l==="group"?d(O):b(O)};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-fade-in",children:[e.jsx("div",{className:o?"absolute inset-0 bg-black/60":"absolute inset-0 bg-black/40",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:`relative rounded-xl border shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col animate-scale-in ${o?"bg-slate-900 border-slate-700":"bg-white border-gray-200"}`,role:"dialog","aria-modal":"true","aria-labelledby":"settings-modal-title",children:[e.jsxs("div",{className:`flex items-center justify-between px-5 py-4 border-b ${o?"border-slate-800":"border-gray-200"}`,children:[e.jsx("h2",{id:"settings-modal-title",className:`text-lg font-semibold ${o?"text-slate-100":"text-gray-900"}`,children:"âš™ï¸ Settings"}),e.jsx("button",{onClick:s,className:`text-xl leading-none min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg transition-colors ${o?"text-slate-400 hover:text-slate-200 hover:bg-slate-800":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,"aria-label":"Close settings",children:"Ã—"})]}),e.jsxs("div",{className:`px-5 py-3 border-b ${o?"border-slate-800":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>x("group"),disabled:!i,className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${l==="group"?o?"bg-emerald-500/15 text-emerald-300 border border-emerald-500/30":"bg-emerald-50 text-emerald-700 border border-emerald-200":o?"bg-slate-900 text-slate-300 border border-slate-800 hover:bg-slate-800":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"} disabled:opacity-40`,children:"This group"}),e.jsx("button",{type:"button",onClick:()=>x("global"),className:`px-3 py-2 rounded-lg text-sm min-h-[44px] font-medium transition-colors ${l==="global"?o?"bg-emerald-500/15 text-emerald-300 border border-emerald-500/30":"bg-emerald-50 text-emerald-700 border border-emerald-200":o?"bg-slate-900 text-slate-300 border border-slate-800 hover:bg-slate-800":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:"Global"})]}),l==="group"&&i&&e.jsxs("div",{className:`mt-2 text-[11px] ${o?"text-slate-500":"text-gray-500"}`,children:["Applies to ",e.jsx("span",{className:"font-mono",children:i})," only."]}),l==="global"&&e.jsx("div",{className:`mt-2 text-[11px] ${o?"text-slate-500":"text-gray-500"}`,children:"Applies to your whole CCCC instance (daemon + Web)."})]}),e.jsx("div",{className:`flex border-b ${o?"border-slate-800":"border-gray-200"}`,children:W.map(O=>e.jsx("button",{onClick:()=>J(O.id),className:`px-4 py-2.5 text-sm font-medium transition-colors ${Z===O.id?o?"text-emerald-400 border-b-2 border-emerald-400":"text-emerald-600 border-b-2 border-emerald-600":o?"text-slate-400 hover:text-slate-200":"text-gray-500 hover:text-gray-700"}`,children:O.label},O.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-6",children:[Z==="timing"&&e.jsx(pr,{isDark:o,busy:a,nudgeSeconds:j,setNudgeSeconds:N,idleSeconds:y,setIdleSeconds:p,keepaliveSeconds:R,setKeepaliveSeconds:v,silenceSeconds:f,setSilenceSeconds:S,deliveryInterval:B,setDeliveryInterval:A,standupInterval:z,setStandupInterval:h,onSave:dt}),Z==="im"&&e.jsx(fr,{isDark:o,groupId:i,imStatus:be,imPlatform:pe,setImPlatform:Te,imBotTokenEnv:qe,setImBotTokenEnv:Ee,imAppTokenEnv:ve,setImAppTokenEnv:Ae,imBusy:Ie,onSaveConfig:re,onRemoveConfig:xe,onStartBridge:Qe,onStopBridge:jt}),Z==="transcript"&&e.jsx(yr,{isDark:o,busy:a,groupId:i,devActors:rt,terminalVisibility:_,setTerminalVisibility:L,terminalNotifyTail:C,setTerminalNotifyTail:F,terminalNotifyLines:q,setTerminalNotifyLines:T,onSaveTranscriptSettings:Ye,tailActorId:E,setTailActorId:P,tailMaxChars:V,setTailMaxChars:H,tailStripAnsi:X,setTailStripAnsi:ee,tailCompact:D,setTailCompact:ie,tailText:ge,tailHint:Se,tailErr:$e,tailBusy:se,tailCopyInfo:Ge,onLoadTail:k,onCopyTail:M,onClearTail:G}),Z==="remote"&&e.jsx(vr,{isDark:o}),Z==="developer"&&e.jsx(jr,{isDark:o,groupId:i,developerMode:fe,setDeveloperMode:Pe,logLevel:Je,setLogLevel:Ve,obsBusy:st,onSaveObservability:mt,debugSnapshot:at,debugSnapshotErr:lt,debugSnapshotBusy:ke,onLoadDebugSnapshot:ht,onClearDebugSnapshot:()=>{_e(""),Re("")},logComponent:je,setLogComponent:ot,logLines:Fe,setLogLines:it,logText:ct,logErr:Ue,logBusy:He,onLoadLogTail:gt,onClearLogs:Nt})]})]})]})}function pt(t){if(!t)return"â€”";try{const s=new Date(t);if(isNaN(s.getTime()))return t;const n=new Date,r=n.getTime()-s.getTime(),a=Math.floor(r/1e3),o=Math.floor(a/60),i=Math.floor(o/60),l=Math.floor(i/24);if(a<60)return"just now";if(o<60)return`${o}m ago`;if(i<24)return`${i}h ago`;if(l<7)return`${l}d ago`;const x=s.toLocaleString("en",{month:"short"}),c=s.getDate(),d=s.getFullYear(),g=n.getFullYear();return d===g?`${x} ${c}`:`${x} ${c}, ${d}`}catch{return t}}function ns(t){if(!t)return"";try{const s=new Date(t);return isNaN(s.getTime())?t:s.toLocaleString()}catch{return t}}function wr(t){if(t.kind==="chat.message"&&t.data&&typeof t.data=="object")return String(t.data.text||"");if(t.kind==="system.notify"&&t.data&&typeof t.data=="object"){const s=String(t.data.kind||"info"),n=String(t.data.title||""),r=String(t.data.message||""),a=t.data.target_actor_id?` â†’ ${t.data.target_actor_id}`:"";return`[${s}]${a}: ${n}${r?` - ${r}`:""}`}return String(t.kind||"event")}function Cr(t,s,n){const r=(s||"").trim();if(!r)return t;const a=t.toLowerCase(),o=r.toLowerCase();if(!o)return t;const i=[];let l=0,x=0;for(;;){const c=a.indexOf(o,l);if(c===-1)break;c>l&&i.push(t.slice(l,c));const d=t.slice(c,c+r.length);if(i.push(e.jsx("mark",{className:m("px-0.5 rounded",n?"bg-amber-500/20 text-amber-200":"bg-amber-200 text-amber-900"),children:d},`m${x++}-${c}`)),l=c+r.length,l>=t.length)break}return l<t.length&&i.push(t.slice(l)),i}async function Sr(t){var s;try{if((s=navigator.clipboard)!=null&&s.writeText)return await navigator.clipboard.writeText(t),!0}catch{}try{return window.prompt("Copy to clipboard:",t),!0}catch{return!1}}function $r({isOpen:t,onClose:s,groupId:n,actors:r,isDark:a,onReply:o}){const i=u.useRef(null),[l,x]=u.useState(""),[c,d]=u.useState("all"),[g,b]=u.useState(""),[j,N]=u.useState(!1),[y,p]=u.useState(""),[R,v]=u.useState([]),[f,S]=u.useState(!1),B=u.useMemo(()=>{const h=r.map(_=>String(_.id||"")).filter(Boolean);return h.sort(),h},[r]);u.useEffect(()=>{t&&(p(""),window.setTimeout(()=>{var h;return(h=i.current)==null?void 0:h.focus()},0))},[t]),u.useEffect(()=>{t&&(v([]),S(!1),p(""))},[n,t]);const A=async h=>{var _;if(t&&n){N(!0),p("");try{const L=new URLSearchParams;L.set("q",l),L.set("kind",c),g&&L.set("by",g),L.set("limit","50"),h!=null&&h.before&&L.set("before",h.before);const C=await I(`/api/v1/groups/${encodeURIComponent(n)}/ledger/search?${L.toString()}`);if(!C.ok){p(((_=C.error)==null?void 0:_.message)||"Search failed");return}const F=C.result.events||[];S(!!C.result.has_more),v(q=>(h==null?void 0:h.mode)==="prepend"?F.concat(q):F)}finally{N(!1)}}},z=async()=>{var _;const h=(_=R[0])!=null&&_.id?String(R[0].id):"";h&&await A({before:h,mode:"prepend"})};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-stretch sm:items-center justify-center p-0 sm:p-4 animate-fade-in",children:[e.jsx("div",{className:a?"absolute inset-0 bg-black/60":"absolute inset-0 bg-black/40",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:m("relative w-full h-full sm:h-auto sm:max-h-[80vh] sm:max-w-3xl flex flex-col border shadow-2xl animate-scale-in","rounded-none sm:rounded-xl",a?"bg-slate-900 border-slate-700":"bg-white border-gray-200"),role:"dialog","aria-modal":"true","aria-labelledby":"search-modal-title",children:[e.jsxs("div",{className:m("flex items-center justify-between px-4 pt-4 pb-3 border-b safe-area-inset-top",a?"border-slate-800":"border-gray-200"),children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{id:"search-modal-title",className:m("text-lg font-semibold truncate",a?"text-slate-100":"text-gray-900"),children:"ðŸ” Search Messages"}),e.jsx("div",{className:m("text-xs mt-0.5 truncate",a?"text-slate-400":"text-gray-500"),children:n})]}),e.jsx("button",{onClick:s,className:m("text-xl leading-none min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg transition-colors",a?"text-slate-400 hover:text-slate-200 hover:bg-slate-800":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"),"aria-label":"Close search modal",children:"Ã—"})]}),e.jsxs("div",{className:"px-4 py-3 border-b space-y-3 sm:space-y-0 sm:flex sm:items-end sm:gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{className:m("block text-xs font-medium mb-1",a?"text-slate-300":"text-gray-700"),children:"Query"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:i,value:l,onChange:h=>x(h.target.value),onKeyDown:h=>{h.key==="Enter"&&A({mode:"replace"})},className:m("flex-1 px-3 py-2 border rounded-lg text-sm min-h-[44px]",a?"bg-slate-800 border-slate-700 text-slate-100":"bg-white border-gray-300 text-gray-900"),placeholder:"Search text (case-insensitive)â€¦"}),e.jsx("button",{onClick:()=>void A({mode:"replace"}),disabled:j,className:m("px-4 py-2 rounded-lg text-sm font-medium min-h-[44px] disabled:opacity-50","bg-emerald-600 hover:bg-emerald-500 text-white"),children:j?"â€¦":"Search"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:m("block text-xs font-medium mb-1",a?"text-slate-300":"text-gray-700"),children:"Kind"}),e.jsx("div",{className:m("flex items-center gap-1 p-1 rounded-lg",a?"bg-slate-800/60":"bg-gray-100"),children:[["all","All"],["chat","Chat"],["notify","Notify"]].map(([h,_])=>e.jsx("button",{onClick:()=>d(h),className:m("px-2.5 py-1.5 rounded-md text-xs font-medium min-h-[36px] transition-colors",c===h?a?"bg-slate-700 text-white":"bg-white text-gray-900 shadow-sm":a?"text-slate-300 hover:text-white":"text-gray-600 hover:text-gray-900"),"aria-pressed":c===h,children:_},h))})]}),e.jsxs("div",{children:[e.jsx("label",{className:m("block text-xs font-medium mb-1",a?"text-slate-300":"text-gray-700"),children:"By"}),e.jsxs("select",{value:g,onChange:h=>b(h.target.value),className:m("px-3 py-2 border rounded-lg text-sm min-h-[44px] min-w-[140px]",a?"bg-slate-800 border-slate-700 text-slate-100":"bg-white border-gray-300 text-gray-900"),children:[e.jsx("option",{value:"",children:"Any"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"system",children:"system"}),B.map(h=>e.jsx("option",{value:h,children:h},h))]})]})]})]}),y&&e.jsx("div",{className:m("px-4 py-2 text-sm border-b",a?"border-rose-500/30 bg-rose-500/10 text-rose-300":"border-rose-300 bg-rose-50 text-rose-700"),role:"alert",children:y}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[f&&R.length>0&&e.jsx("button",{className:m("w-full px-4 py-2 rounded-lg text-sm font-medium min-h-[44px] transition-colors",a?"bg-slate-800 hover:bg-slate-700 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"),onClick:()=>void z(),disabled:j,children:"Load older results"}),R.map((h,_)=>{const L=wr(h),C=h.id?String(h.id):"",F=h.kind==="chat.message";return e.jsx("div",{className:m("rounded-lg border px-4 py-3",a?"border-slate-700/50 bg-slate-800/40":"border-gray-200 bg-gray-50"),children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:m("text-xs",a?"text-slate-400":"text-gray-500"),title:ns(h.ts),children:pt(h.ts)}),e.jsx("span",{className:m("text-xs font-medium",a?"text-slate-200":"text-gray-800"),children:h.by||"â€”"}),e.jsx("span",{className:m("text-[10px] px-2 py-0.5 rounded-full font-medium",h.kind==="system.notify"?a?"bg-blue-500/20 text-blue-300":"bg-blue-100 text-blue-700":a?"bg-slate-700/60 text-slate-300":"bg-white text-gray-600 border border-gray-200"),children:h.kind||"event"}),C&&e.jsx("span",{className:m("text-[10px] truncate",a?"text-slate-500":"text-gray-400"),title:C,children:C})]}),e.jsx("div",{className:m("mt-2 text-sm whitespace-pre-wrap break-words",a?"text-slate-100":"text-gray-800"),children:Cr(L,l,a)})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end sm:flex-col sm:items-end",children:[F&&e.jsx("button",{className:m("text-[10px] px-2 py-1 rounded border min-h-[36px] transition-colors",a?"bg-slate-900 border-slate-800 hover:bg-slate-800/60 text-slate-300 hover:text-slate-100":"bg-white border-gray-200 hover:bg-gray-100 text-gray-600 hover:text-gray-900"),onClick:()=>o(h),"aria-label":`Reply to ${String(h.by||"message")}`,title:"Reply",children:"â†© Reply"}),C&&e.jsx("button",{className:m("text-[10px] px-2 py-1 rounded border min-h-[36px] transition-colors",a?"bg-slate-900 border-slate-800 hover:bg-slate-800/60 text-slate-300 hover:text-slate-100":"bg-white border-gray-200 hover:bg-gray-100 text-gray-600 hover:text-gray-900"),onClick:()=>void Sr(C),"aria-label":"Copy event id",title:"Copy event id",children:"â§‰ Copy ID"})]})]})},C||`r${_}`)}),!j&&R.length===0&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”Ž"}),e.jsx("div",{className:m("text-sm",a?"text-slate-300":"text-gray-700"),children:"No results"}),e.jsx("div",{className:m("text-xs mt-1",a?"text-slate-500":"text-gray-500"),children:"Try a different query, sender, or kind filter."})]})]})]})]}):null}function ft(t,s){if(!t)return{label:"â—‹ STOP",colorClass:"bg-slate-700/50 text-slate-500"};switch(s){case"paused":return{label:"â¸ PAUSED",colorClass:"bg-amber-500/20 text-amber-500"};case"idle":return{label:"âœ“ IDLE",colorClass:"bg-blue-500/20 text-blue-400"};default:return{label:"â— RUN",colorClass:"bg-emerald-500/20 text-emerald-500"}}}function yt(t,s){if(!t)return{label:"â—‹ STOP",colorClass:"bg-gray-200 text-gray-500"};switch(s){case"paused":return{label:"â¸ PAUSED",colorClass:"bg-amber-100 text-amber-600"};case"idle":return{label:"âœ“ IDLE",colorClass:"bg-blue-100 text-blue-600"};default:return{label:"â— RUN",colorClass:"bg-emerald-100 text-emerald-600"}}}function as({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),e.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"})]})}function Tr({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"}),e.jsx("path",{d:"M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"}),e.jsx("path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"}),e.jsx("path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"})]})}function Lt({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polygon",{points:"6 3 20 12 6 21 6 3",fill:"currentColor",opacity:"0.15"}),e.jsx("polygon",{points:"6 3 20 12 6 21 6 3"})]})}function ls({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",fill:"currentColor",opacity:"0.15"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",fill:"currentColor",opacity:"0.15"}),e.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]})}function os({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",fill:"currentColor",opacity:"0.15"}),e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"})]})}function is({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}function cs({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}function Er({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"19",r:"1.5",fill:"currentColor"})]})}function Ar({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),e.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),e.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}function ds({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function _r({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}function Rr({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z",fill:"currentColor",opacity:"0.1"}),e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})]})}function xs({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}function us({className:t,size:s=18}){return e.jsx("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})}function Lr({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polyline",{points:"4 17 10 11 4 5"}),e.jsx("line",{x1:"12",y1:"19",x2:"20",y2:"19"})]})}function Mn({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12"}),e.jsx("path",{d:"M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"})]})}function On({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}function In({className:t,size:s=18}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})}function Mr({isOpen:t,isDark:s,selectedGroupId:n,groupDoc:r,selectedGroupRunning:a,actors:o,busy:i,onClose:l,onToggleTheme:x,onOpenSearch:c,onOpenContext:d,onOpenSettings:g,onOpenGroupEdit:b,onStartGroup:j,onStopGroup:N,onSetGroupState:y}){return t?e.jsxs("div",{className:"fixed inset-0 z-50 sm:hidden animate-fade-in",children:[e.jsx("div",{className:"absolute inset-0 glass-overlay",onClick:l,"aria-hidden":"true"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 rounded-t-3xl glass-modal animate-slide-up transform transition-transform",role:"dialog","aria-modal":"true","aria-label":"Menu",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-1",onClick:l,children:e.jsx("div",{className:`w-12 h-1.5 rounded-full ${s?"bg-white/20":"bg-black/15"}`})}),e.jsxs("div",{className:"px-6 pb-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:m("text-lg font-bold truncate",s?"text-slate-100":"text-gray-900"),children:(r==null?void 0:r.title)||n||"Menu"}),n&&r&&e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("span",{className:m("text-xs px-2 py-0.5 rounded-full font-medium",s?ft(a,r.state).colorClass:yt(a,r.state).colorClass),children:(s?ft(a,r.state):yt(a,r.state)).label})})]}),e.jsx("button",{onClick:l,className:m("p-2 rounded-full transition-colors glass-btn",s?"text-slate-400 hover:text-slate-200":"text-gray-400 hover:text-gray-600"),"aria-label":"Close menu",children:e.jsx(ds,{size:20})})]}),e.jsxs("div",{className:"p-4 space-y-2 safe-area-inset-bottom",children:[!n&&e.jsx("div",{className:m("text-sm px-1 pb-2",s?"text-slate-400":"text-gray-500"),children:"Select a group to enable actions."}),e.jsxs("button",{className:m("w-full flex items-center justify-center gap-3 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-200":"text-gray-800"),onClick:()=>{l(),c()},disabled:!n,children:[e.jsx(_r,{size:18}),e.jsx("span",{children:"Search Messages"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{className:m("w-full flex items-center justify-center gap-2 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-200":"text-gray-800"),onClick:()=>{l(),d()},disabled:!n,children:[e.jsx(as,{size:18}),e.jsx("span",{children:"Context"})]}),e.jsxs("button",{className:m("w-full flex items-center justify-center gap-2 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-200":"text-gray-800"),onClick:()=>{l(),g()},disabled:!n,children:[e.jsx(is,{size:18}),e.jsx("span",{children:"Settings"})]})]}),e.jsxs("button",{className:m("w-full flex items-center justify-center gap-3 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-200":"text-gray-800"),onClick:x,children:[s?e.jsx(xs,{size:18}):e.jsx(us,{size:18}),e.jsx("span",{children:s?"Light Mode":"Dark Mode"})]}),e.jsxs("button",{className:m("w-full flex items-center justify-center gap-3 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-200":"text-gray-800"),onClick:()=>{l(),b()},disabled:!n,children:[e.jsx(cs,{size:18}),e.jsx("span",{children:"Edit Group Details"})]}),e.jsx("div",{className:m("h-px my-3 mx-2",s?"bg-white/10":"bg-black/10")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{className:m("w-full flex flex-col items-center justify-center gap-2 px-2 py-3 rounded-2xl text-sm font-medium transition-all min-h-[64px] disabled:opacity-50",s?"glass-btn-accent text-emerald-300":"glass-btn-accent text-emerald-700"),style:{"--glass-accent-bg":s?"rgba(16, 185, 129, 0.15)":"rgba(16, 185, 129, 0.1)","--glass-accent-border":s?"rgba(16, 185, 129, 0.25)":"rgba(16, 185, 129, 0.2)","--glass-accent-glow":s?"0 0 20px rgba(16, 185, 129, 0.15)":"0 0 16px rgba(16, 185, 129, 0.1)"},onClick:()=>{l(),j()},disabled:!n||i==="group-start"||o.length===0,children:[e.jsx(Lt,{size:20}),e.jsx("span",{children:"Launch All"})]}),e.jsxs("button",{className:m("w-full flex flex-col items-center justify-center gap-2 px-2 py-3 rounded-2xl text-sm font-medium transition-all min-h-[64px] disabled:opacity-50 glass-btn",s?"text-slate-300":"text-gray-600"),onClick:()=>{l(),N()},disabled:!n||i==="group-stop",children:[e.jsx(os,{size:20}),e.jsx("span",{children:"Quit All"})]})]}),(r==null?void 0:r.state)==="paused"?e.jsxs("button",{className:m("w-full flex items-center justify-center gap-2 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50",s?"glass-btn-accent text-amber-300":"glass-btn-accent text-amber-700"),style:{"--glass-accent-bg":s?"rgba(245, 158, 11, 0.15)":"rgba(245, 158, 11, 0.1)","--glass-accent-border":s?"rgba(245, 158, 11, 0.25)":"rgba(245, 158, 11, 0.2)","--glass-accent-glow":s?"0 0 20px rgba(245, 158, 11, 0.15)":"0 0 16px rgba(245, 158, 11, 0.1)"},onClick:()=>{l(),y("active")},disabled:!n||i==="group-state",children:[e.jsx(Lt,{size:18}),e.jsx("span",{children:"Resume Message Delivery"})]}):e.jsxs("button",{className:m("w-full flex items-center justify-center gap-2 px-4 py-3.5 rounded-2xl text-sm font-medium transition-all min-h-[52px] disabled:opacity-50 glass-btn",s?"text-slate-300":"text-gray-600"),onClick:()=>{l(),y("paused")},disabled:!n||i==="group-state",children:[e.jsx(ls,{size:18}),e.jsx("span",{children:"Pause Message Delivery"})]})]})]})]}):null}const ms=["claude","codex","droid","amp","auggie","neovate","gemini","cursor","kilocode","opencode","copilot","custom"],ut={amp:{label:"Amp",desc:""},auggie:{label:"Auggie (Augment)",desc:""},claude:{label:"Claude Code",desc:""},codex:{label:"Codex CLI",desc:""},cursor:{label:"Cursor CLI",desc:"Manual MCP installation needed"},droid:{label:"Droid",desc:""},gemini:{label:"Gemini CLI",desc:""},kilocode:{label:"Kilo Code",desc:"Manual MCP installation needed"},neovate:{label:"Neovate Code",desc:""},opencode:{label:"OpenCode",desc:"Manual MCP installation needed"},copilot:{label:"GitHub Copilot",desc:"Manual MCP installation needed"},custom:{label:"Custom",desc:"Manual MCP installation needed"}},kt={amp:{bg:"bg-rose-900/30",text:"text-rose-300",border:"border-rose-600/50",dot:"bg-rose-400",bgLight:"bg-rose-50",textLight:"text-rose-700",borderLight:"border-rose-300",dotLight:"bg-rose-500"},auggie:{bg:"bg-teal-900/30",text:"text-teal-300",border:"border-teal-600/50",dot:"bg-teal-400",bgLight:"bg-teal-50",textLight:"text-teal-700",borderLight:"border-teal-300",dotLight:"bg-teal-500"},claude:{bg:"bg-orange-900/30",text:"text-orange-300",border:"border-orange-600/50",dot:"bg-orange-400",bgLight:"bg-orange-50",textLight:"text-orange-700",borderLight:"border-orange-300",dotLight:"bg-orange-500"},codex:{bg:"bg-emerald-900/30",text:"text-emerald-300",border:"border-emerald-600/50",dot:"bg-emerald-400",bgLight:"bg-emerald-50",textLight:"text-emerald-700",borderLight:"border-emerald-300",dotLight:"bg-emerald-500"},cursor:{bg:"bg-indigo-900/30",text:"text-indigo-300",border:"border-indigo-600/50",dot:"bg-indigo-400",bgLight:"bg-indigo-50",textLight:"text-indigo-700",borderLight:"border-indigo-300",dotLight:"bg-indigo-500"},droid:{bg:"bg-violet-900/30",text:"text-violet-300",border:"border-violet-600/50",dot:"bg-violet-400",bgLight:"bg-violet-50",textLight:"text-violet-700",borderLight:"border-violet-300",dotLight:"bg-violet-500"},gemini:{bg:"bg-yellow-900/30",text:"text-yellow-300",border:"border-yellow-600/50",dot:"bg-yellow-400",bgLight:"bg-yellow-50",textLight:"text-yellow-700",borderLight:"border-yellow-300",dotLight:"bg-yellow-500"},kilocode:{bg:"bg-pink-900/30",text:"text-pink-300",border:"border-pink-600/50",dot:"bg-pink-400",bgLight:"bg-pink-50",textLight:"text-pink-700",borderLight:"border-pink-300",dotLight:"bg-pink-500"},neovate:{bg:"bg-fuchsia-900/30",text:"text-fuchsia-300",border:"border-fuchsia-600/50",dot:"bg-fuchsia-400",bgLight:"bg-fuchsia-50",textLight:"text-fuchsia-700",borderLight:"border-fuchsia-300",dotLight:"bg-fuchsia-500"},opencode:{bg:"bg-cyan-900/30",text:"text-cyan-300",border:"border-cyan-600/50",dot:"bg-cyan-400",bgLight:"bg-cyan-50",textLight:"text-cyan-700",borderLight:"border-cyan-300",dotLight:"bg-cyan-500"},copilot:{bg:"bg-slate-800/50",text:"text-slate-300",border:"border-slate-500/50",dot:"bg-slate-400",bgLight:"bg-gray-100",textLight:"text-gray-700",borderLight:"border-gray-300",dotLight:"bg-gray-500"},custom:{bg:"bg-zinc-800/50",text:"text-zinc-300",border:"border-zinc-500/50",dot:"bg-zinc-400",bgLight:"bg-zinc-100",textLight:"text-zinc-700",borderLight:"border-zinc-300",dotLight:"bg-zinc-500"},user:{bg:"bg-sky-900/30",text:"text-sky-300",border:"border-sky-600/50",dot:"bg-sky-400",bgLight:"bg-sky-50",textLight:"text-sky-700",borderLight:"border-sky-300",dotLight:"bg-sky-500"}};function Pn(t,s=!0){const n=kt[t||"codex"]||kt.codex;return s?{bg:n.bg,text:n.text,border:n.border,dot:n.dot}:{bg:n.bgLight,text:n.textLight,border:n.borderLight,dot:n.dotLight}}const $t=[{ring:"ring-sky-400/35",text:"text-sky-300",ringLight:"ring-sky-300",textLight:"text-sky-700"},{ring:"ring-indigo-400/35",text:"text-indigo-300",ringLight:"ring-indigo-300",textLight:"text-indigo-700"},{ring:"ring-violet-400/35",text:"text-violet-300",ringLight:"ring-violet-300",textLight:"text-violet-700"},{ring:"ring-fuchsia-400/35",text:"text-fuchsia-300",ringLight:"ring-fuchsia-300",textLight:"text-fuchsia-700"},{ring:"ring-cyan-400/35",text:"text-cyan-300",ringLight:"ring-cyan-300",textLight:"text-cyan-700"},{ring:"ring-teal-400/35",text:"text-teal-300",ringLight:"ring-teal-300",textLight:"text-teal-700"},{ring:"ring-emerald-400/35",text:"text-emerald-300",ringLight:"ring-emerald-300",textLight:"text-emerald-700"},{ring:"ring-amber-400/35",text:"text-amber-300",ringLight:"ring-amber-300",textLight:"text-amber-700"}];function Or(t){let s=2166136261;for(let n=0;n<t.length;n++)s^=t.charCodeAt(n),s=Math.imul(s,16777619);return s>>>0}function Ir(t,s=!0){const n=String(t||"").trim(),r=n?Or(n)%$t.length:0,a=$t[r]||$t[0];return s?{ring:a.ring,text:a.text}:{ring:a.ringLight,text:a.textLight}}const hs=JSON.stringify({mcpServers:{cccc:{command:"cccc",args:["mcp"]}}},null,2),gs=JSON.stringify({mcpServers:{cccc:{command:"cccc",args:["mcp"],tools:["*"]}}},null,2),bs=JSON.stringify({mcp:{cccc:{type:"local",command:["cccc","mcp"]}}},null,2);function Pr({isOpen:t,isDark:s,busy:n,hasForeman:r,runtimes:a,suggestedActorId:o,newActorId:i,setNewActorId:l,newActorRole:x,setNewActorRole:c,newActorRuntime:d,setNewActorRuntime:g,newActorCommand:b,setNewActorCommand:j,showAdvancedActor:N,setShowAdvancedActor:y,addActorError:p,setAddActorError:R,canAddActor:v,addActorDisabledReason:f,onAddActor:S,onClose:B,onCancelAndReset:A}){var h,_;if(!t)return null;const z=((h=a.find(L=>L.name===d))==null?void 0:h.recommended_command)||"";return e.jsx("div",{className:`fixed inset-0 backdrop-blur-sm flex items-start justify-center p-4 sm:p-6 z-50 animate-fade-in ${s?"bg-black/50":"bg-black/30"}`,onMouseDown:L=>{L.target===L.currentTarget&&B()},role:"dialog","aria-modal":"true","aria-labelledby":"add-actor-title",children:e.jsxs("div",{className:`w-full max-w-lg mt-8 sm:mt-16 rounded-2xl border shadow-2xl max-h-[80vh] overflow-y-auto animate-scale-in ${s?"border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:`px-6 py-4 border-b sticky top-0 ${s?"border-slate-700/50 bg-slate-800":"border-gray-200 bg-white"}`,children:[e.jsx("div",{id:"add-actor-title",className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:"Add AI Agent"}),e.jsx("div",{className:`text-sm mt-1 ${s?"text-slate-400":"text-gray-500"}`,children:"Choose an AI runtime to add to your team"})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[p&&e.jsxs("div",{className:`rounded-xl border px-4 py-2.5 text-sm flex items-center justify-between gap-3 ${s?"border-rose-500/30 bg-rose-500/10 text-rose-300":"border-rose-300 bg-rose-50 text-rose-700"}`,role:"alert",children:[e.jsx("span",{children:p}),e.jsx("button",{className:s?"text-rose-300 hover:text-rose-100":"text-rose-500 hover:text-rose-700",onClick:()=>R(""),children:"Ã—"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:["Agent Name ",e.jsx("span",{className:s?"text-slate-500":"text-gray-400",children:"(supports Unicode, incl. CJK)"})]}),e.jsx("input",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white placeholder-slate-500 focus:border-blue-500":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-blue-500"}`,value:i,onChange:L=>l(L.target.value),placeholder:o}),e.jsxs("div",{className:`text-[10px] mt-1 ${s?"text-slate-500":"text-gray-500"}`,children:["Leave empty to use:"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-slate-800":"bg-gray-100"}`,children:o})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"AI Runtime"}),e.jsx("select",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,value:d,onChange:L=>{const C=L.target.value;g(C),j("")},children:ms.map(L=>{const C=ut[L],F=a.find(E=>E.name===L),q=(F==null?void 0:F.available)??!1,T=q||L==="custom";return e.jsxs("option",{value:L,disabled:!T,children:[(C==null?void 0:C.label)||L,!q&&L!=="custom"?" (not installed)":""]},L)})}),(_=ut[d])!=null&&_.desc?e.jsx("div",{className:`text-[10px] mt-1 ${s?"text-slate-500":"text-gray-500"}`,children:ut[d].desc}):null,(d==="cursor"||d==="kilocode"||d==="opencode"||d==="copilot"||d==="custom")&&e.jsxs("div",{className:`mt-2 rounded-xl border px-3 py-2 text-[11px] ${s?"border-amber-500/30 bg-amber-500/10 text-amber-200":"border-amber-200 bg-amber-50 text-amber-800"}`,children:[e.jsx("div",{className:"font-medium",children:"Manual MCP install required"}),d==="custom"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["Provide a command for your runtime in ",e.jsx("span",{className:"font-medium",children:"Advanced options â†’ Command Override"}),"."]}),e.jsxs("div",{className:"mt-1",children:["Configure your runtime to add an MCP stdio server named"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"cccc"})," that runs"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"cccc mcp"}),"."]})]}):d==="cursor"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.cursor/mcp.json"})," (or"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:".cursor/mcp.json"})," in this project)"]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):d==="kilocode"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:".kilocode/mcp.json"})," in this project root"]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):d==="opencode"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.config/opencode/opencode.json"})]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.copilot/mcp-config.json"})]}),e.jsxs("div",{className:"mt-1",children:["2) Add this MCP server config (or pass it via"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"--additional-mcp-config"}),"):"]})]}),d!=="custom"?e.jsx("pre",{className:`mt-1.5 p-2 rounded overflow-x-auto whitespace-pre ${s?"bg-amber-900/20 text-amber-100":"bg-amber-50 text-amber-900"}`,children:e.jsx("code",{children:d==="opencode"?bs:d==="copilot"?gs:hs})}):null,e.jsx("div",{className:`mt-1 text-[10px] ${s?"text-amber-200/80":"text-amber-800/80"}`,children:"Restart the runtime after updating this config."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Role"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:m("flex-1 px-4 py-2.5 rounded-xl border text-sm font-medium transition-all min-h-[44px]",x==="foreman"?"bg-amber-500/20 border-amber-500 text-amber-600":r?s?"bg-slate-900/30 border-slate-700/30 text-slate-500 cursor-not-allowed":"bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed":s?"bg-slate-800/50 border-slate-600/50 text-slate-300 hover:border-slate-500":"bg-gray-50 border-gray-200 text-gray-600 hover:border-gray-300"),onClick:()=>{r||c("foreman")},disabled:r,children:["â˜… Foreman ",r&&"(exists)"]}),e.jsxs("button",{className:m("flex-1 px-4 py-2.5 rounded-xl border text-sm font-medium transition-all min-h-[44px]",x==="peer"?"bg-blue-500/20 border-blue-500 text-blue-600":r?s?"bg-slate-800/50 border-slate-600/50 text-slate-300 hover:border-slate-500":"bg-gray-50 border-gray-200 text-gray-600 hover:border-gray-300":s?"bg-slate-900/30 border-slate-700/30 text-slate-500 cursor-not-allowed":"bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed"),onClick:()=>{r&&c("peer")},disabled:!r,children:["Peer ",!r&&"(need foreman first)"]})]}),e.jsx("div",{className:`text-[10px] mt-1.5 ${s?"text-slate-500":"text-gray-500"}`,children:r?"Foreman leads the team. Peers are worker agents.":"First agent must be the foreman (team leader)."})]}),e.jsxs("button",{className:`flex items-center gap-2 text-xs min-h-[36px] ${s?"text-slate-400 hover:text-slate-300":"text-gray-500 hover:text-gray-700"}`,onClick:()=>y(!N),children:[e.jsx("span",{className:m("transition-transform",N&&"rotate-90"),children:"â–¶"}),"Advanced options"]}),N&&e.jsx("div",{className:`space-y-4 pl-4 border-l-2 ${s?"border-slate-700/50":"border-gray-200"}`,children:e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Command Override"}),e.jsx("input",{className:`w-full rounded-xl border px-3 py-2 text-sm font-mono min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white placeholder-slate-500 focus:border-blue-500":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-blue-500"}`,value:b,onChange:L=>j(L.target.value),placeholder:z||"Enter command..."}),z.trim()?e.jsxs("div",{className:`text-[10px] mt-1 ${s?"text-slate-500":"text-gray-500"}`,children:["Default:"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-slate-800":"bg-gray-100"}`,children:z})]}):null]})}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("button",{className:"w-full rounded-xl bg-blue-600 hover:bg-blue-500 text-white px-4 py-2.5 text-sm font-semibold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all min-h-[44px]",onClick:S,disabled:!v,children:n==="actor-add"?"Adding...":"Add Agent"}),f&&e.jsx("div",{className:"text-[10px] text-amber-500 mt-1.5",children:f})]}),e.jsx("button",{className:`px-4 py-2.5 rounded-xl text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:A,children:"Cancel"})]})]})]})})}function Br({isOpen:t,isDark:s,busy:n,dirSuggestions:r,dirItems:a,currentDir:o,parentDir:i,showDirBrowser:l,createGroupPath:x,setCreateGroupPath:c,createGroupName:d,setCreateGroupName:g,onFetchDirContents:b,onCreateGroup:j,onClose:N,onCancelAndReset:y}){return t?e.jsx("div",{className:`fixed inset-0 backdrop-blur-sm flex items-start justify-center p-4 sm:p-6 z-50 animate-fade-in ${s?"bg-black/50":"bg-black/30"}`,onMouseDown:p=>{p.target===p.currentTarget&&N()},role:"dialog","aria-modal":"true","aria-labelledby":"create-group-title",children:e.jsxs("div",{className:`w-full max-w-lg mt-8 sm:mt-16 rounded-2xl border shadow-2xl animate-scale-in ${s?"border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${s?"border-slate-700/50":"border-gray-200"}`,children:[e.jsx("div",{id:"create-group-title",className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:"Create Working Group"}),e.jsx("div",{className:`text-sm mt-1 ${s?"text-slate-400":"text-gray-500"}`,children:"Select a project directory to start collaborating"})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[r.length>0&&!x&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Quick Select"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.slice(0,6).map(p=>e.jsxs("button",{className:`flex items-center gap-2 px-3 py-2 rounded-xl border transition-colors text-left min-h-[56px] ${s?"border-slate-600/50 bg-slate-800/50 hover:bg-slate-700/50 hover:border-slate-500":"border-gray-200 bg-gray-50 hover:bg-gray-100 hover:border-gray-300"}`,onClick:()=>{c(p.path),g(p.path.split("/").filter(Boolean).pop()||""),b(p.path)},children:[e.jsx("span",{className:"text-lg",children:p.icon}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:`text-sm font-medium truncate ${s?"text-slate-200":"text-gray-700"}`,children:p.name}),e.jsx("div",{className:`text-[10px] truncate ${s?"text-slate-500":"text-gray-500"}`,children:p.path})]})]},p.path))})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Project Directory"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:`flex-1 rounded-xl border px-4 py-2.5 text-sm font-mono min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white placeholder-slate-500 focus:border-blue-500":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-blue-500"}`,value:x,onChange:p=>{c(p.target.value);const R=p.target.value.split("/").filter(Boolean).pop()||"";(!d||d===o.split("/").filter(Boolean).pop())&&g(R)},placeholder:"/path/to/your/project",autoFocus:!0}),e.jsx("button",{className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:()=>b(x||"~"),children:"Browse"})]})]}),l&&e.jsxs("div",{className:`border rounded-xl max-h-48 overflow-auto ${s?"border-slate-600/50 bg-slate-900/50":"border-gray-200 bg-gray-50"}`,children:[o&&e.jsx("div",{className:`px-3 py-1.5 border-b text-xs font-mono truncate ${s?"border-slate-700/30 bg-slate-800/30 text-slate-400":"border-gray-200 bg-gray-100 text-gray-500"}`,children:o}),i&&e.jsxs("button",{className:`w-full flex items-center gap-2 px-3 py-2 text-left border-b min-h-[44px] ${s?"hover:bg-slate-800/50 border-slate-700/30":"hover:bg-gray-100 border-gray-200"}`,onClick:()=>{b(i),c(i),g(i.split("/").filter(Boolean).pop()||"")},children:[e.jsx("span",{className:s?"text-slate-400":"text-gray-400",children:"ðŸ“"}),e.jsx("span",{className:`text-sm ${s?"text-slate-400":"text-gray-500"}`,children:".."})]}),a.filter(p=>p.is_dir).length===0&&e.jsx("div",{className:`px-3 py-4 text-center text-sm ${s?"text-slate-500":"text-gray-500"}`,children:"No subdirectories"}),a.filter(p=>p.is_dir).map(p=>e.jsxs("button",{className:`w-full flex items-center gap-2 px-3 py-2 text-left min-h-[44px] ${s?"hover:bg-slate-800/50":"hover:bg-gray-100"}`,onClick:()=>{c(p.path),g(p.name),b(p.path)},children:[e.jsx("span",{className:"text-blue-500",children:"ðŸ“"}),e.jsx("span",{className:`text-sm ${s?"text-slate-200":"text-gray-700"}`,children:p.name})]},p.path))]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Group Name"}),e.jsx("input",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white placeholder-slate-500 focus:border-blue-500":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-blue-500"}`,value:d,onChange:p=>g(p.target.value),placeholder:"Auto-filled from directory name"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{className:"flex-1 rounded-xl bg-blue-600 hover:bg-blue-500 text-white px-4 py-2.5 text-sm font-semibold shadow-lg disabled:opacity-50 transition-all min-h-[44px]",onClick:j,disabled:!x.trim()||n==="create",children:n==="create"?"Creating...":"Create Group"}),e.jsx("button",{className:`px-4 py-2.5 rounded-xl text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:y,children:"Cancel"})]})]})]})}):null}function kr({isOpen:t,isDark:s,busy:n,actorId:r,runtimes:a,runtime:o,onChangeRuntime:i,command:l,onChangeCommand:x,onSave:c,onCancel:d}){if(!t)return null;const g=a.find(y=>y.name===o),b=(g==null?void 0:g.available)??!1,j=(g==null?void 0:g.recommended_command)||"",N=o==="custom"||!b;return e.jsx("div",{className:`fixed inset-0 flex items-start justify-center p-4 sm:p-6 z-50 animate-fade-in ${s?"bg-black/60":"bg-black/40"}`,onMouseDown:y=>{y.target===y.currentTarget&&d()},role:"dialog","aria-modal":"true","aria-labelledby":"edit-actor-title",children:e.jsxs("div",{className:`w-full max-w-md mt-8 sm:mt-16 rounded-2xl border shadow-2xl animate-scale-in ${s?"border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${s?"border-slate-700/50":"border-gray-200"}`,children:[e.jsxs("div",{id:"edit-actor-title",className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:["Edit Agent: ",r]}),e.jsx("div",{className:`text-sm mt-1 ${s?"text-slate-400":"text-gray-500"}`,children:"Change the AI runtime for this agent"})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Runtime"}),e.jsx("select",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,value:o,onChange:y=>{const p=y.target.value;i(p),x("")},children:ms.map(y=>{const p=ut[y],R=a.find(S=>S.name===y),v=(R==null?void 0:R.available)??!1,f=v||y==="custom";return e.jsxs("option",{value:y,disabled:!f,children:[(p==null?void 0:p.label)||y,!v&&y!=="custom"?" (not installed)":""]},y)})}),(o==="cursor"||o==="kilocode"||o==="opencode"||o==="copilot"||o==="custom")&&e.jsxs("div",{className:`mt-2 rounded-xl border px-3 py-2 text-[11px] ${s?"border-amber-500/30 bg-amber-500/10 text-amber-200":"border-amber-200 bg-amber-50 text-amber-800"}`,children:[e.jsx("div",{className:"font-medium",children:"Manual MCP install required"}),o==="custom"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-1",children:["Configure your runtime to add an MCP stdio server named"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"cccc"})," ","that runs ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"cccc mcp"}),"."]})}):o==="cursor"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.cursor/mcp.json"})," (or"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:".cursor/mcp.json"})," in this project)"]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):o==="kilocode"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:".kilocode/mcp.json"})," in this project root"]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):o==="opencode"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.config/opencode/opencode.json"})]}),e.jsx("div",{className:"mt-1",children:"2) Add this MCP server config:"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1",children:["1) Create/edit"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"~/.copilot/mcp-config.json"})]}),e.jsxs("div",{className:"mt-1",children:["2) Add this MCP server config (or pass it via"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-amber-900/30":"bg-amber-100"}`,children:"--additional-mcp-config"}),"):"]})]}),o!=="custom"?e.jsx("pre",{className:`mt-1.5 p-2 rounded overflow-x-auto whitespace-pre ${s?"bg-amber-900/20 text-amber-100":"bg-amber-50 text-amber-900"}`,children:e.jsx("code",{children:o==="opencode"?bs:o==="copilot"?gs:hs})}):null,e.jsx("div",{className:`mt-1 text-[10px] ${s?"text-amber-200/80":"text-amber-800/80"}`,children:"Restart the runtime after updating this config."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Command"}),e.jsx("input",{className:`w-full rounded-xl border px-4 py-2.5 text-sm font-mono min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,value:l,onChange:y=>x(y.target.value),placeholder:j||"Enter command..."}),j.trim()?e.jsxs("div",{className:`text-[10px] mt-1.5 ${s?"text-slate-500":"text-gray-500"}`,children:["Default:"," ",e.jsx("code",{className:`px-1 rounded ${s?"bg-slate-800":"bg-gray-100"}`,children:j})]}):null]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{className:"flex-1 rounded-xl bg-blue-600 hover:bg-blue-500 text-white px-4 py-2.5 text-sm font-semibold shadow-lg disabled:opacity-50 transition-all min-h-[44px]",onClick:c,disabled:n==="actor-update"||N&&!l.trim(),children:"Save"}),e.jsx("button",{className:`px-4 py-2.5 rounded-xl text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:d,children:"Cancel"})]})]})]})})}function Fr({isOpen:t,isDark:s,busy:n,title:r,topic:a,onChangeTitle:o,onChangeTopic:i,onSave:l,onCancel:x,onDelete:c}){return t?e.jsx("div",{className:`fixed inset-0 backdrop-blur-sm flex items-start justify-center p-4 sm:p-6 z-50 animate-fade-in ${s?"bg-black/50":"bg-black/30"}`,onMouseDown:d=>{d.target===d.currentTarget&&x()},role:"dialog","aria-modal":"true","aria-labelledby":"group-edit-title",children:e.jsxs("div",{className:`w-full max-w-md mt-8 sm:mt-16 rounded-2xl border shadow-2xl animate-scale-in ${s?"border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900":"border-gray-200 bg-white"}`,children:[e.jsx("div",{className:`px-6 py-4 border-b ${s?"border-slate-700/50":"border-gray-200"}`,children:e.jsx("div",{id:"group-edit-title",className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:"Edit Group"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Name"}),e.jsx("input",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,value:r,onChange:d=>o(d.target.value),placeholder:"Group name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs font-medium mb-2 ${s?"text-slate-400":"text-gray-500"}`,children:"Description (optional)"}),e.jsx("input",{className:`w-full rounded-xl border px-4 py-2.5 text-sm min-h-[44px] transition-colors ${s?"bg-slate-900/80 border-slate-600/50 text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500"}`,value:a,onChange:d=>i(d.target.value),placeholder:"What is this group working on?"})]}),e.jsxs("div",{className:"flex gap-3 pt-3 flex-wrap",children:[e.jsx("button",{className:"flex-1 rounded-xl bg-blue-600 hover:bg-blue-500 text-white px-4 py-2.5 text-sm font-semibold shadow-lg disabled:opacity-50 transition-all min-h-[44px]",onClick:l,disabled:!r.trim()||n==="group-update",children:"Save"}),e.jsx("button",{className:`px-4 py-2.5 rounded-xl text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:x,children:"Cancel"}),e.jsx("button",{className:`px-4 py-2.5 rounded-xl border text-sm font-medium disabled:opacity-50 transition-colors min-h-[44px] ${s?"bg-rose-500/20 border-rose-500/30 text-rose-400 hover:bg-rose-500/30":"bg-rose-50 border-rose-200 text-rose-600 hover:bg-rose-100"}`,onClick:()=>{x(),c()},disabled:n==="group-delete",title:"Delete this group permanently",children:"Delete"})]})]})]})}):null}function Ur(t){if(t.kind==="chat.message"&&t.data&&typeof t.data=="object")return String(t.data.text||"");if(t.kind==="system.notify"&&t.data&&typeof t.data=="object"){const r=String(t.data.kind||"info"),a=String(t.data.title||""),o=String(t.data.message||""),i=t.data.target_actor_id?` â†’ ${t.data.target_actor_id}`:"";return`[${r}]${i}: ${a}${o?` - ${o}`:""}`}const s=String(t.kind||"event"),n=t.by?` by ${t.by}`:"";return`${s}${n}`}function zr({isOpen:t,isDark:s,actorId:n,messages:r,busy:a,onClose:o,onMarkAllRead:i}){return t?e.jsx("div",{className:`fixed inset-0 backdrop-blur-sm flex items-start justify-center p-4 sm:p-6 z-50 animate-fade-in ${s?"bg-black/50":"bg-black/30"}`,onMouseDown:l=>{l.target===l.currentTarget&&o()},role:"dialog","aria-modal":"true","aria-labelledby":"inbox-title",children:e.jsxs("div",{className:`w-full max-w-2xl mt-8 sm:mt-16 rounded-2xl border shadow-2xl animate-scale-in ${s?"border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:`px-4 sm:px-6 py-4 border-b flex items-center justify-between gap-3 ${s?"border-slate-700/50":"border-gray-200"}`,children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{id:"inbox-title",className:`text-lg font-semibold truncate ${s?"text-white":"text-gray-900"}`,children:["Inbox Â· ",n]}),e.jsxs("div",{className:`text-sm ${s?"text-slate-400":"text-gray-500"}`,children:[r.length," unread messages"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:`rounded-xl px-4 py-2 text-sm font-medium disabled:opacity-50 transition-colors min-h-[44px] ${s?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,onClick:i,disabled:!r.length||a.startsWith("inbox"),children:"Mark all read"}),e.jsx("button",{className:`rounded-xl px-4 py-2 text-sm font-medium transition-colors min-h-[44px] ${s?"bg-slate-600 hover:bg-slate-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,onClick:o,children:"Close"})]})]}),e.jsxs("div",{className:"max-h-[60vh] overflow-auto p-4 space-y-2",children:[r.map((l,x)=>e.jsxs("div",{className:`rounded-xl border px-4 py-3 ${s?"border-slate-700/50 bg-slate-800/50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:`text-xs truncate ${s?"text-slate-400":"text-gray-500"}`,title:ns(l.ts),children:pt(l.ts)}),e.jsx("div",{className:`text-xs font-medium truncate ${s?"text-slate-300":"text-gray-700"}`,children:l.by||"â€”"})]}),e.jsx("div",{className:`mt-2 text-sm whitespace-pre-wrap break-words ${s?"text-slate-200":"text-gray-800"}`,children:Ur(l)})]},String(l.id||x))),!r.length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“­"}),e.jsx("div",{className:`text-sm ${s?"text-slate-400":"text-gray-500"}`,children:"No unread messages"})]})]})]})}):null}function Gr({isOpen:t,isDark:s,isSmallScreen:n,toLabel:r,entries:a,onClose:o}){return t?e.jsxs("div",{className:m("fixed inset-0 z-50 flex animate-fade-in",n?"items-end justify-center":"items-center justify-center p-4"),role:"dialog","aria-modal":"true","aria-label":"Recipient status",children:[e.jsx("div",{className:m("absolute inset-0",s?"bg-black/60":"bg-black/40"),onClick:o,"aria-hidden":"true"}),e.jsxs("div",{className:m("relative w-full border shadow-2xl",n?"rounded-t-2xl max-h-[80vh] animate-slide-up safe-area-inset-bottom":"max-w-md rounded-2xl animate-scale-in",s?"bg-slate-900 border-slate-700 text-slate-100":"bg-white border-gray-200 text-gray-900"),children:[e.jsxs("div",{className:m("px-5 py-4 border-b flex items-center justify-between gap-3",s?"border-slate-800":"border-gray-200"),children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:m("text-sm font-semibold truncate",s?"text-slate-100":"text-gray-900"),children:"Recipients"}),e.jsxs("div",{className:m("text-[11px] truncate",s?"text-slate-500":"text-gray-500"),title:`to ${r}`,children:["to ",r]})]}),e.jsx("button",{type:"button",className:m("touch-target-sm min-w-[36px] min-h-[36px] flex items-center justify-center rounded-lg",s?"text-slate-400 hover:text-slate-200 hover:bg-slate-800":"text-gray-400 hover:text-gray-700 hover:bg-gray-100"),onClick:o,"aria-label":"Close",children:"Ã—"})]}),e.jsxs("div",{className:"p-4 sm:p-5 overflow-auto max-h-[70vh]",children:[a.length>0?e.jsx("div",{className:m("rounded-xl border divide-y",s?"border-slate-800 divide-slate-800 bg-slate-950/40":"border-gray-200 divide-gray-200 bg-gray-50"),children:a.map(([i,l])=>e.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[e.jsx("div",{className:m("text-sm font-medium truncate",s?"text-slate-200":"text-gray-800"),children:i}),e.jsx("div",{className:m("text-sm font-semibold tracking-tight",l?s?"text-emerald-400":"text-emerald-600":s?"text-slate-500":"text-gray-500"),"aria-label":l?"read":"pending",children:l?"âœ“âœ“":"âœ“"})]},i))}):e.jsx("div",{className:m("text-sm py-6 text-center",s?"text-slate-400":"text-gray-500"),children:"No recipient tracking for this message."}),e.jsx("div",{className:m("text-[11px] mt-3",s?"text-slate-500":"text-gray-500"),children:"Legend: âœ“ pending Â· âœ“âœ“ read"})]})]})]}):null}const Ft=t=>{let s;const n=new Set,r=(c,d)=>{const g=typeof c=="function"?c(s):c;if(!Object.is(g,s)){const b=s;s=d??(typeof g!="object"||g===null)?g:Object.assign({},s,g),n.forEach(j=>j(s,b))}},a=()=>s,l={setState:r,getState:a,getInitialState:()=>x,subscribe:c=>(n.add(c),()=>n.delete(c))},x=s=t(r,a,l);return l},Wr=(t=>t?Ft(t):Ft),qr=t=>t;function Jr(t,s=qr){const n=we.useSyncExternalStore(t.subscribe,we.useCallback(()=>s(t.getState()),[t,s]),we.useCallback(()=>s(t.getInitialState()),[t,s]));return we.useDebugValue(n),n}const Ut=t=>{const s=Wr(t),n=r=>Jr(s,r);return Object.assign(n,s),n},et=(t=>t?Ut(t):Ut),zt=800;let Tt=!1,Et=!1;const At=new Set,_t=new Set,Ce=et((t,s)=>({groups:[],selectedGroupId:"",groupDoc:null,events:[],actors:[],groupContext:null,groupSettings:null,runtimes:[],setGroups:n=>t({groups:n}),setSelectedGroupId:n=>t({selectedGroupId:n}),setGroupDoc:n=>t({groupDoc:n}),setEvents:n=>t({events:n}),appendEvent:n=>t(r=>{const a=r.events.concat([n]);return{events:a.length>zt?a.slice(a.length-zt):a}}),setActors:n=>t({actors:n}),setGroupContext:n=>t({groupContext:n}),setGroupSettings:n=>t({groupSettings:n}),setRuntimes:n=>t({runtimes:n}),updateReadStatus:(n,r)=>t(a=>{const o=a.events.findIndex(l=>l.kind==="chat.message"&&String(l.id||"")===n);if(o<0)return a;const i=a.events.slice();for(let l=0;l<=o;l++){const x=i[l];if(!x||x.kind!=="chat.message")continue;const c=x._read_status&&typeof x._read_status=="object"?{...x._read_status}:null;!c||!Object.prototype.hasOwnProperty.call(c,r)||c[r]!==!0&&(c[r]=!0,i[l]={...x,_read_status:c})}return{events:i}}),refreshGroups:async()=>{if(Tt){Et=!0;return}Tt=!0;try{const n=await Ls();if(n.ok){const r=n.result.groups||[];t({groups:r});const a=s().selectedGroupId;!(!!a&&r.some(i=>String(i.group_id||"")===a))&&r.length>0&&t({selectedGroupId:String(r[0].group_id||"")})}}catch{}finally{Tt=!1,Et&&(Et=!1,s().refreshGroups())}},refreshActors:async n=>{const r=String(n||s().selectedGroupId||"").trim();if(r){if(At.has(r)){_t.add(r);return}At.add(r);try{const a=await Rt(r);a.ok&&s().selectedGroupId===r&&t({actors:a.result.actors||[]})}catch{}finally{At.delete(r),_t.has(r)&&(_t.delete(r),s().refreshActors(r))}}},loadGroup:async n=>{const r=String(n||"").trim();if(!r)return;const[a,o,i,l,x]=await Promise.all([Ms(r),zs(r),Rt(r),ts(r),ss(r)]);s().selectedGroupId===r&&t({groupDoc:a.ok?a.result.group:null,events:o.ok?(o.result.events||[]).filter(c=>c&&c.kind!=="context.sync"):[],actors:i.ok?i.result.actors||[]:[],groupContext:l.ok?l.result:null,groupSettings:x.ok&&x.result.settings?x.result.settings:null})}}));let ze=null;const tt=et(t=>({activeTab:"chat",busy:"",errorMsg:"",isTransitioning:!1,sidebarOpen:!0,showScrollButton:!1,chatUnreadCount:0,isSmallScreen:!1,setActiveTab:s=>t({activeTab:s}),setBusy:s=>t({busy:s}),setError:s=>t({errorMsg:s}),showError:s=>{ze&&window.clearTimeout(ze),t({errorMsg:s}),ze=window.setTimeout(()=>{t({errorMsg:""}),ze=null},8e3)},dismissError:()=>{ze&&(window.clearTimeout(ze),ze=null),t({errorMsg:""})},setTransitioning:s=>t({isTransitioning:s}),setSidebarOpen:s=>t({sidebarOpen:s}),setShowScrollButton:s=>t({showScrollButton:s}),setChatUnreadCount:s=>t({chatUnreadCount:s}),incrementChatUnread:()=>t(s=>({chatUnreadCount:s.chatUnreadCount+1})),setSmallScreen:s=>t({isSmallScreen:s})})),Ot=et(t=>({modals:{context:!1,settings:!1,search:!1,addActor:!1,createGroup:!1,groupEdit:!1,inbox:!1,mobileMenu:!1},recipientsEventId:null,editingActor:null,openModal:s=>t(n=>({modals:{...n.modals,[s]:!0}})),closeModal:s=>t(n=>({modals:{...n.modals,[s]:!1}})),setRecipientsModal:s=>t({recipientsEventId:s}),setEditingActor:s=>t({editingActor:s})})),ps=et(t=>({composerText:"",composerFiles:[],toText:"",replyTarget:null,setComposerText:s=>t(n=>({composerText:typeof s=="function"?s(n.composerText):s})),setComposerFiles:s=>t({composerFiles:s}),appendComposerFiles:s=>t(n=>{const r=i=>`${i.name}:${i.size}:${i.lastModified}`,a=new Set(n.composerFiles.map(r)),o=n.composerFiles.slice();for(const i of s){const l=r(i);a.has(l)||(a.add(l),o.push(i))}return{composerFiles:o}}),setToText:s=>t({toText:s}),setReplyTarget:s=>t({replyTarget:s}),clearComposer:()=>t({composerText:"",composerFiles:[],toText:"",replyTarget:null})})),fs=et(t=>({inboxActorId:"",inboxMessages:[],setInboxActorId:s=>t({inboxActorId:s}),setInboxMessages:s=>t({inboxMessages:s}),clearInbox:()=>t({inboxActorId:"",inboxMessages:[]})})),ys=et(t=>({editGroupTitle:"",editGroupTopic:"",editActorRuntime:"codex",editActorCommand:"",editActorTitle:"",newActorId:"",newActorRole:"peer",newActorRuntime:"codex",newActorCommand:"",showAdvancedActor:!1,addActorError:"",createGroupPath:"",createGroupName:"",dirItems:[],dirSuggestions:[],currentDir:"",parentDir:null,showDirBrowser:!1,setEditGroupTitle:s=>t({editGroupTitle:s}),setEditGroupTopic:s=>t({editGroupTopic:s}),setEditActorRuntime:s=>t({editActorRuntime:s}),setEditActorCommand:s=>t({editActorCommand:s}),setEditActorTitle:s=>t({editActorTitle:s}),setNewActorId:s=>t({newActorId:s}),setNewActorRole:s=>t({newActorRole:s}),setNewActorRuntime:s=>t({newActorRuntime:s}),setNewActorCommand:s=>t({newActorCommand:s}),setShowAdvancedActor:s=>t({showAdvancedActor:s}),setAddActorError:s=>t({addActorError:s}),resetAddActorForm:()=>t({newActorId:"",newActorCommand:"",newActorRole:"peer",showAdvancedActor:!1,addActorError:""}),setCreateGroupPath:s=>t({createGroupPath:s}),setCreateGroupName:s=>t({createGroupName:s}),setDirItems:s=>t({dirItems:s}),setDirSuggestions:s=>t({dirSuggestions:s}),setCurrentDir:s=>t({currentDir:s}),setParentDir:s=>t({parentDir:s}),setShowDirBrowser:s=>t({showDirBrowser:s}),resetCreateGroupForm:()=>t({createGroupPath:"",createGroupName:"",dirItems:[],showDirBrowser:!1})}));function Vr({isDark:t,composerRef:s,messageMeta:n,onStartReply:r,onThemeToggle:a,onStartGroup:o,onStopGroup:i,onSetGroupState:l,fetchContext:x}){const{selectedGroupId:c,groupDoc:d,actors:g,groupContext:b,groupSettings:j,runtimes:N,setSelectedGroupId:y,setGroupDoc:p,setGroupContext:R,setGroupSettings:v,refreshGroups:f,refreshActors:S,loadGroup:B}=Ce(),{busy:A,isSmallScreen:z,setBusy:h,showError:_,setActiveTab:L}=tt(),{modals:C,recipientsEventId:F,editingActor:q,openModal:T,closeModal:E,setRecipientsModal:P,setEditingActor:V}=Ot(),{inboxActorId:H,inboxMessages:X,setInboxMessages:ee}=fs(),{editGroupTitle:D,editGroupTopic:ie,setEditGroupTitle:ge,setEditGroupTopic:ce,editActorRuntime:Se,editActorCommand:me,editActorTitle:$e,setEditActorRuntime:w,setEditActorCommand:se,newActorId:de,newActorRole:Ge,newActorRuntime:ae,newActorCommand:be,showAdvancedActor:We,addActorError:pe,setNewActorId:Te,setNewActorRole:qe,setNewActorRuntime:Ee,setNewActorCommand:ve,setShowAdvancedActor:Ae,setAddActorError:Ie,resetAddActorForm:le,createGroupPath:fe,createGroupName:Pe,dirItems:Je,dirSuggestions:Ve,currentDir:st,parentDir:Be,showDirBrowser:rt,setCreateGroupPath:nt,setCreateGroupName:at,setDirItems:_e,setCurrentDir:lt,setParentDir:Re,setShowDirBrowser:ke,resetCreateGroupForm:Le}=ys(),je=Ce(M=>{var k;return((k=M.groups.find(G=>String(G.group_id||"")===M.selectedGroupId))==null?void 0:k.running)??!1}),ot=g.some(M=>M.role==="foreman"),Fe=async M=>{if(c){h("context-update");try{const k=await Ks(c,M);k.ok||_(`${k.error.code}: ${k.error.message}`),x(c)}finally{h("")}}},it=async M=>{if(c){h("context-update");try{const k=await Ys(c,M);k.ok||_(`${k.error.code}: ${k.error.message}`),x(c)}finally{h("")}}},ct=async M=>{if(c){h("settings-update");try{const k=await Qs(c,M);k.ok||_(`${k.error.code}: ${k.error.message}`);const G=await ss(c);G.ok&&G.result.settings&&v(G.result.settings)}finally{h("")}}},Me=async()=>{if(!c||!H)return;const M=X.length?X[X.length-1]:null,k=M!=null&&M.id?String(M.id):"";if(k){h(`inbox-read:${H}`);try{const G=await Xs(c,H,k);if(!G.ok){_(`${G.error.code}: ${G.error.message}`);return}const re=await rs(c,H);re.ok&&ee(re.result.messages||[])}finally{h("")}}},Ue=async()=>{if(c){h("group-update");try{const M=await Is(c,D,ie);if(!M.ok){_(`${M.error.code}: ${M.error.message}`);return}E("groupEdit"),await f(),await B(c)}finally{h("")}}},oe=async()=>{if(c&&window.confirm(`Delete group "${(d==null?void 0:d.title)||c}"?`)){h("group-delete");try{const M=await Ps(c);if(!M.ok){_(`${M.error.code}: ${M.error.message}`);return}y(""),p(null),Ce.getState().setEvents([]),Ce.getState().setActors([]),R(null),v(null),await f()}finally{h("")}}},He=async()=>{if(!(!c||!q)){h("actor-update");try{const M=await Ws(c,q.id,Se,me,$e);if(!M.ok){_(`${M.error.code}: ${M.error.message}`);return}V(null),await S()}finally{h("")}}},Ne=async M=>{var G;ke(!0);const k=await sr(M);k.ok?(_e(k.result.items||[]),lt(k.result.path||M),Re(k.result.parent||null)):_(((G=k.error)==null?void 0:G.message)||"Failed to list directory")},he=async()=>{const M=fe.trim();if(!M)return;const k=M.split("/").filter(Boolean).pop()||"working-group",G=Pe.trim()||k;h("create");try{const re=await Os(G);if(!re.ok){_(`${re.error.code}: ${re.error.message}`);return}const xe=re.result.group_id,Qe=await Bs(xe,M);Qe.ok||_(`Created group but failed to attach: ${Qe.error.message}`),Le(),E("createGroup"),await f(),y(xe)}finally{h("")}},Ke=async()=>{var k;if(!c)return;const M=de.trim();h("actor-add"),Ie("");try{const G=await Gs(c,M,Ge,ae,be);if(!G.ok){Ie(((k=G.error)==null?void 0:k.message)||"Failed to add agent");return}E("addActor"),le(),await S()}finally{h("")}},te=(()=>{const M=ae,k=new Set(g.map(G=>String(G.id||"")));for(let G=1;G<=999;G++){const re=`${M}-${G}`;if(!k.has(re))return re}return`${M}-${Date.now()}`})(),dt=(()=>{if(A==="actor-add")return!1;const M=N.find(G=>G.name===ae),k=(M==null?void 0:M.available)??!1;return!(ae==="custom"&&!be.trim()||!k&&!be.trim())})(),Ye=(()=>{var G;if(A==="actor-add")return"";const M=N.find(re=>re.name===ae),k=(M==null?void 0:M.available)??!1;return ae==="custom"&&!be.trim()?"Custom runtime requires a command.":!k&&!be.trim()?`${((G=ut[ae])==null?void 0:G.label)||ae} is not installed.`:""})();return e.jsxs(e.Fragment,{children:[e.jsx(Mr,{isOpen:C.mobileMenu,isDark:t,selectedGroupId:c,groupDoc:d,selectedGroupRunning:je,actors:g,busy:A,onClose:()=>E("mobileMenu"),onToggleTheme:a,onOpenSearch:()=>T("search"),onOpenContext:()=>{c&&x(c),T("context")},onOpenSettings:()=>T("settings"),onOpenGroupEdit:()=>{d&&(ge(d.title||""),ce(d.topic||""),T("groupEdit"))},onStartGroup:o,onStopGroup:i,onSetGroupState:l}),e.jsx($r,{isOpen:C.search,onClose:()=>E("search"),groupId:c,actors:g,isDark:t,onReply:M=>{r(M),L("chat"),E("search"),window.setTimeout(()=>{var k;return(k=s.current)==null?void 0:k.focus()},0)}}),e.jsx(br,{isOpen:C.context,onClose:()=>E("context"),groupId:c,context:b,onUpdateVision:Fe,onUpdateSketch:it,busy:A==="context-update",isDark:t}),e.jsx(Nr,{isOpen:C.settings,onClose:()=>E("settings"),settings:j,onUpdateSettings:ct,busy:A.startsWith("settings"),isDark:t,groupId:c}),e.jsx(Gr,{isOpen:!!n,isDark:t,isSmallScreen:z,toLabel:(n==null?void 0:n.toLabel)||"",entries:(n==null?void 0:n.entries)||[],onClose:()=>P(null)}),e.jsx(zr,{isOpen:C.inbox,isDark:t,actorId:H,messages:X,busy:A,onClose:()=>E("inbox"),onMarkAllRead:Me}),e.jsx(Fr,{isOpen:C.groupEdit,isDark:t,busy:A,title:D,topic:ie,onChangeTitle:ge,onChangeTopic:ce,onSave:Ue,onCancel:()=>E("groupEdit"),onDelete:oe}),e.jsx(kr,{isOpen:!!q,isDark:t,busy:A,actorId:(q==null?void 0:q.id)||"",runtimes:N,runtime:Se,onChangeRuntime:w,command:me,onChangeCommand:se,onSave:He,onCancel:()=>V(null)}),e.jsx(Br,{isOpen:C.createGroup,isDark:t,busy:A,dirSuggestions:Ve,dirItems:Je,currentDir:st,parentDir:Be,showDirBrowser:rt,createGroupPath:fe,setCreateGroupPath:nt,createGroupName:Pe,setCreateGroupName:at,onFetchDirContents:Ne,onCreateGroup:he,onClose:()=>E("createGroup"),onCancelAndReset:()=>{E("createGroup"),Le()}}),e.jsx(Pr,{isOpen:C.addActor,isDark:t,busy:A,hasForeman:ot,runtimes:N,suggestedActorId:te,newActorId:de,setNewActorId:Te,newActorRole:Ge,setNewActorRole:qe,newActorRuntime:ae,setNewActorRuntime:Ee,newActorCommand:be,setNewActorCommand:ve,showAdvancedActor:We,setShowAdvancedActor:Ae,addActorError:pe,setAddActorError:Ie,canAddActor:dt,addActorDisabledReason:Ye,onAddActor:Ke,onClose:()=>E("addActor"),onCancelAndReset:()=>{E("addActor"),le()}})]})}function Hr({theme:t,onThemeChange:s,isDark:n}){const r=()=>t==="light"?"dark":t==="dark"?"system":"light",a=t==="light"?xs:t==="dark"?us:Lr,o=t==="light"?"Light":t==="dark"?"Dark":"System";return e.jsx("button",{onClick:()=>s(r()),className:m("flex items-center justify-center w-9 h-9 rounded-xl transition-all min-h-[44px] min-w-[44px] glass-btn",n?"text-slate-300":"text-gray-600"),title:`Theme: ${o}. Click to change.`,"aria-label":`Current theme: ${o}. Click to cycle through themes.`,children:e.jsx(a,{size:18})})}function Kr({isDark:t,theme:s,onThemeChange:n,selectedGroupId:r,groupDoc:a,selectedGroupRunning:o,actors:i,busy:l,errorMsg:x,onDismissError:c,onOpenSidebar:d,onOpenGroupEdit:g,onOpenContext:b,onStartGroup:j,onStopGroup:N,onSetGroupState:y,onOpenSettings:p,onOpenMobileMenu:R}){return e.jsxs("header",{className:"flex-shrink-0 z-20 px-4 h-14 flex items-center justify-between gap-3 glass-header",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{className:m("md:hidden p-2 -ml-2 rounded-xl transition-all glass-btn",t?"text-slate-400 hover:text-white":"text-gray-500 hover:text-gray-900"),onClick:d,"aria-label":"Open sidebar",children:e.jsx(Ar,{size:18})}),e.jsx("div",{className:"min-w-0 flex flex-col",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:`text-sm font-semibold truncate ${t?"text-slate-100":"text-gray-900"}`,children:(a==null?void 0:a.title)||r||"Select a group"}),r&&a&&(()=>{const v=t?ft(o,a.state):yt(o,a.state);return e.jsx("span",{className:`w-2 h-2 rounded-full ${v.colorClass.replace("text-","bg-").split(" ")[0]}`,title:v.label})})()]})}),r&&e.jsx("button",{className:m("hidden sm:inline-flex items-center justify-center gap-1 text-xs px-2.5 py-1.5 rounded-xl transition-all glass-btn",t?"text-slate-200":"text-gray-700"),onClick:g,title:"Edit group","aria-label":"Edit group",children:e.jsx(cs,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-1.5 mr-2",children:[e.jsxs("button",{onClick:b,disabled:!r,className:m("p-2 rounded-xl transition-all glass-btn",t?"text-slate-400 hover:text-white":"text-gray-400 hover:text-gray-900"),title:"Context (Clipboard)",children:[e.jsx("span",{className:"sr-only",children:"Context"}),e.jsx(as,{size:18})]}),e.jsx("div",{className:`w-px h-4 mx-1 ${t?"bg-white/10":"bg-black/10"}`}),e.jsxs("button",{onClick:j,disabled:!r||l==="group-start"||i.length===0,className:m("p-2 rounded-xl transition-all",t?"text-emerald-400 hover:bg-emerald-500/15 glass-btn":"text-emerald-600 hover:bg-emerald-50/80 glass-btn"),title:"Launch All Agents",children:[e.jsx("span",{className:"sr-only",children:"Launch"}),e.jsx(Tr,{size:18})]}),(a==null?void 0:a.state)==="paused"?e.jsxs("button",{onClick:()=>void y("active"),disabled:!r||l==="group-state",className:m("p-2 rounded-xl transition-all glass-btn",t?"text-amber-400":"text-amber-600"),title:"Resume Delivery",children:[e.jsx("span",{className:"sr-only",children:"Resume"}),e.jsx(Lt,{size:18})]}):e.jsxs("button",{onClick:()=>void y("paused"),disabled:!r||l==="group-state",className:m("p-2 rounded-xl transition-all glass-btn",t?"text-slate-400 hover:text-amber-300":"text-gray-400 hover:text-amber-600"),title:"Pause Delivery",children:[e.jsx("span",{className:"sr-only",children:"Pause"}),e.jsx(ls,{size:18})]}),e.jsxs("button",{onClick:N,disabled:!r||l==="group-stop",className:m("p-2 rounded-xl transition-all glass-btn",t?"text-slate-400 hover:text-rose-400":"text-gray-400 hover:text-rose-600"),title:"Stop All Agents",children:[e.jsx("span",{className:"sr-only",children:"Stop"}),e.jsx(os,{size:18})]}),e.jsx("div",{className:`w-px h-4 mx-1 ${t?"bg-white/10":"bg-black/10"}`})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(Hr,{theme:s,onThemeChange:n,isDark:t})}),e.jsx("button",{onClick:p,disabled:!r,className:m("hidden sm:flex p-2 rounded-xl transition-all glass-btn",t?"text-slate-400 hover:text-slate-200":"text-gray-400 hover:text-gray-600"),title:"Settings",children:e.jsx(is,{size:18})}),e.jsx("button",{className:m("sm:hidden flex items-center justify-center w-8 h-8 rounded-xl transition-all glass-btn",t?"text-slate-400":"text-gray-400"),onClick:R,title:"Menu",children:e.jsx(Er,{size:18})})]}),x&&e.jsx("div",{className:"absolute top-16 left-1/2 -translate-x-1/2 z-50 animate-slide-up",children:e.jsxs("div",{className:m("rounded-2xl px-4 py-2.5 text-sm flex items-center gap-3 glass-modal",t?"border-rose-500/20 text-rose-300":"border-rose-200/50 text-rose-700"),role:"alert",children:[e.jsx("span",{children:x}),e.jsx("button",{className:m("p-1 rounded-lg transition-all glass-btn",t?"text-rose-400":"text-rose-600"),onClick:c,children:"Ã—"})]})})]})}function Yr({groups:t,selectedGroupId:s,isOpen:n,isDark:r,onSelectGroup:a,onCreateGroup:o,onClose:i}){return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:m("h-full flex flex-col glass-sidebar","fixed md:relative z-40 w-[280px] transition-all duration-300 ease-out",n?"translate-x-0":"-translate-x-full","md:translate-x-0"),children:[e.jsx("div",{className:`p-4 border-b ${r?"border-white/5":"border-black/5"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:m("w-9 h-9 rounded-xl flex items-center justify-center glass-btn",r?"text-cyan-400":"text-cyan-600"),children:e.jsx("img",{src:"/ui/logo.svg",alt:"CCCC Logo",className:"w-6 h-6 object-contain"})}),e.jsx("span",{className:`text-lg font-bold tracking-tight ${r?"text-white":"text-gray-900"}`,children:"CCCC"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:m("text-xs px-4 py-2 rounded-xl font-medium transition-all min-h-[36px] glass-btn-accent",r?"text-cyan-300":"text-cyan-700"),onClick:o,title:"Create new working group","aria-label":"Create new working group",children:"+ New"}),e.jsx("button",{className:m("md:hidden p-2 min-w-[44px] min-h-[44px] flex items-center justify-center rounded-xl transition-all glass-btn",r?"text-slate-400 hover:text-white":"text-gray-500 hover:text-gray-900"),onClick:i,"aria-label":"Close sidebar",children:e.jsx(ds,{size:18})})]})]})}),e.jsxs("div",{className:"flex-1 overflow-auto p-3",children:[e.jsx("div",{className:`text-[10px] font-medium uppercase tracking-wider mb-3 px-2 ${r?"text-slate-500":"text-gray-500"}`,children:"Working Groups"}),e.jsx("div",{className:"space-y-1.5",children:t.map(l=>{const x=String(l.group_id||""),c=x===s;return e.jsx("button",{className:m("w-full text-left px-3 py-2.5 rounded-xl transition-all min-h-[44px] group",c?"glass-btn-accent glow-pulse":"glass-btn hover:translate-x-1"),onClick:()=>{a(x),window.matchMedia("(max-width: 767px)").matches&&i()},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:m("text-sm font-medium truncate",c?r?"text-cyan-300":"text-cyan-700":r?"text-slate-300 group-hover:text-white":"text-gray-700 group-hover:text-gray-900"),children:l.title||x}),(()=>{const d=r?ft(l.running??!1,l.state):yt(l.running??!1,l.state);return e.jsx("div",{className:m("text-[9px] px-2 py-0.5 rounded-full font-medium backdrop-blur-sm",d.colorClass),children:d.label})})()]})},x)})}),!t.length&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:m("w-16 h-16 mx-auto mb-4 rounded-2xl flex items-center justify-center glass-card",r?"text-slate-400":"text-gray-400"),children:e.jsx(Rr,{size:32})}),e.jsx("div",{className:`text-sm mb-2 font-medium ${r?"text-slate-300":"text-gray-700"}`,children:"No working groups yet"}),e.jsx("div",{className:`text-xs mb-5 max-w-[200px] mx-auto leading-relaxed ${r?"text-slate-500":"text-gray-500"}`,children:"A working group is a collaboration space where multiple AI agents work together on a project."}),e.jsx("button",{className:m("text-sm px-5 py-2.5 rounded-xl font-medium min-h-[44px] transition-all glass-btn-accent",r?"text-cyan-300":"text-cyan-700"),onClick:o,children:"Create Your First Group"})]})]})]}),n&&e.jsx("div",{className:"fixed inset-0 z-30 md:hidden glass-overlay animate-fade-in",onClick:i,"aria-hidden":"true"})]})}const vs="cccc-theme";function js(){return typeof window>"u"||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Qr(){if(typeof window>"u")return"system";const t=localStorage.getItem(vs);return t==="light"||t==="dark"||t==="system"?t:"system"}function Xr(t){const s=document.documentElement,n=t==="system"?js():t;s.classList.remove("light","dark"),s.classList.add(n);const r=document.querySelector('meta[name="theme-color"]');r&&r.setAttribute("content",n==="dark"?"#020617":"#f8fafc")}function Zr(t){const s=window.matchMedia("(prefers-color-scheme: dark)");return s.addEventListener("change",t),()=>s.removeEventListener("change",t)}function Dr(){const[t,s]=u.useState(Qr),n=u.useSyncExternalStore(Zr,js,()=>"dark"),r=u.useMemo(()=>t==="system"?n:t,[t,n]);u.useEffect(()=>{Xr(t),localStorage.setItem(vs,t)},[t,n]);const a=u.useCallback(i=>{s(i)},[]),o=u.useCallback(()=>{s(i=>i==="light"?"dark":i==="dark"?"system":"light")},[]);return{theme:t,resolvedTheme:r,setTheme:a,toggleTheme:o,isDark:r==="dark"}}function Bn(t){return{background:t?"#0f172a":"#fafafa",foreground:t?"#e2e8f0":"#1e293b",cursor:t?"#e2e8f0":"#1e293b",cursorAccent:t?"#0f172a":"#fafafa",selectionBackground:t?"#334155":"#bfdbfe",black:t?"#1e293b":"#64748b",red:t?"#f87171":"#dc2626",green:t?"#4ade80":"#16a34a",yellow:t?"#facc15":"#ca8a04",blue:t?"#60a5fa":"#2563eb",magenta:t?"#c084fc":"#9333ea",cyan:t?"#22d3ee":"#0891b2",white:"#f1f5f9",brightBlack:t?"#475569":"#94a3b8",brightRed:t?"#fca5a5":"#ef4444",brightGreen:t?"#86efac":"#22c55e",brightYellow:t?"#fde047":"#eab308",brightBlue:t?"#93c5fd":"#3b82f6",brightMagenta:t?"#d8b4fe":"#a855f7",brightCyan:t?"#67e8f9":"#06b6d4",brightWhite:"#f8fafc"}}function en(t){const{refreshActors:s,loadGroup:n}=Ce(),{setBusy:r,setActiveTab:a,showError:o}=tt(),{openModal:i,setEditingActor:l}=Ot(),{setInboxActorId:x,setInboxMessages:c}=fs(),[d,g]=u.useState({}),b=u.useCallback(async v=>{if(!v||!t)return;const f=v.running??v.enabled??!1;r(`actor-${f?"stop":"start"}:${v.id}`);try{const S=f?await Vs(t,v.id):await Js(t,v.id);if(!S.ok){o(`${S.error.code}: ${S.error.message}`);return}await s()}finally{r("")}},[t,r,o,s]),j=u.useCallback(async v=>{if(!(!t||!v)){r(`actor-relaunch:${v.id}`);try{const f=await Hs(t,v.id);f.ok||o(`${f.error.code}: ${f.error.message}`),await s(),g(S=>({...S,[v.id]:(S[v.id]||0)+1}))}finally{r("")}}},[t,r,o,s]),N=u.useCallback(v=>{if(!v)return;if(v.running??v.enabled??!1){o("Stop the actor before editing.");return}l(v)},[l,o]),y=u.useCallback(async(v,f)=>{if(!(!v||!t)&&window.confirm(`Remove actor ${v.id}?`)){r(`actor-remove:${v.id}`);try{const S=await qs(t,v.id);if(!S.ok){o(`${S.error.code}: ${S.error.message}`);return}f===v.id&&a("chat"),await s(),await n(t)}finally{r("")}}},[t,r,o,s,n,a]),p=u.useCallback(async v=>{if(!(!v||!t)){r(`inbox:${v.id}`);try{x(v.id),c([]),i("inbox");const f=await rs(t,v.id);if(!f.ok){o(`${f.error.code}: ${f.error.message}`);return}c(f.result.messages||[])}finally{r("")}}},[t,r,o,x,c,i]),R=u.useCallback(v=>d[v]||0,[d]);return{termEpochByActor:d,getTermEpoch:R,toggleActorEnabled:b,relaunchActor:j,editActor:N,removeActor:y,openActorInbox:p}}function Ns(t,s){if(!s.length)return[];const n=s.map(d=>String(d.id||"")).filter(d=>d),r=new Set(n),a=t.data,i=(a&&Array.isArray(a.to)?a.to:[]).map(d=>String(d||"").trim()).filter(d=>d.length>0),l=new Set(i),x=String(t.by||"").trim();if(l.size===0||l.has("@all"))return n.filter(d=>d!==x);const c=new Set;for(const d of l)if(!(d==="user"||d==="@user")){if(d==="@peers"){for(const g of s)g.role==="peer"&&c.add(String(g.id));continue}if(d==="@foreman"){for(const g of s)g.role==="foreman"&&c.add(String(g.id));continue}r.has(d)&&c.add(d)}return c.delete(x),Array.from(c)}function tn({activeTabRef:t,chatAtBottomRef:s,actorsRef:n}){const{selectedGroupId:r,appendEvent:a,updateReadStatus:o,setGroupContext:i,refreshActors:l}=Ce(),{incrementChatUnread:x}=tt(),c=u.useRef(null),d=u.useRef(null),g=u.useRef([]),b=u.useRef("");u.useEffect(()=>{b.current=r},[r]);async function j(v){const f=await ts(v);f.ok&&f.result&&typeof f.result=="object"&&i(f.result)}function N(v){c.current&&(c.current.close(),c.current=null);const f=new EventSource(`/api/v1/groups/${encodeURIComponent(v)}/ledger/stream`);f.addEventListener("ledger",S=>{var A,z;const B=S;try{const h=JSON.parse(String(B.data||"{}"));if(h&&typeof h=="object"&&h.kind==="context.sync"){d.current&&window.clearTimeout(d.current),d.current=window.setTimeout(()=>{d.current=null,j(v)},150);return}if(h&&typeof h=="object"&&h.kind==="chat.read"){const L=String(((A=h.data)==null?void 0:A.actor_id)||""),C=String(((z=h.data)==null?void 0:z.event_id)||"");L&&C&&o(C,L),l(v);return}if(h&&typeof h=="object"&&h.kind==="chat.message"&&!h._read_status){const L=Ns(h,n.current);if(L.length>0){const C={};for(const F of L)C[F]=!1;h._read_status=C}}if(a(h),h&&typeof h=="object"&&h.kind==="chat.message"){const L=String(h.by||"");if(L&&L!=="user"){const C=t.current==="chat",F=s.current;(!C||!F)&&x()}}const _=String(h.kind||"");(_==="chat.message"||_==="chat.read"||_.startsWith("actor.")||_==="group.start"||_==="group.stop"||_==="group.set_state")&&l(v)}catch{}}),c.current=f}function y(){for(const v of g.current)window.clearTimeout(v);g.current=[]}function p(v){const f=String(v||"").trim();if(!f)return;y();const S=[1e3,2500,5e3,1e4,15e3];for(const B of S){const A=window.setTimeout(()=>{b.current===f&&l(f)},B);g.current.push(A)}}function R(){c.current&&(c.current.close(),c.current=null),d.current&&(window.clearTimeout(d.current),d.current=null),y()}return{connectStream:N,fetchContext:j,scheduleActorWarmupRefresh:p,clearActorWarmupTimers:y,cleanup:R,contextRefreshTimerRef:d}}const Mt=20,Gt=Mt*1024*1024;function sn({selectedGroupId:t}){const{showError:s}=tt(),{appendComposerFiles:n}=ps(),[r,a]=u.useState(!1),o=u.useRef(0),i=u.useCallback(x=>{const c=Array.from(x||[]);if(c.length===0)return;const d=c.filter(b=>b.size>Gt),g=c.filter(b=>b.size<=Gt);if(d.length>0){const b=d.slice(0,3).map(N=>N.name||"file"),j=d.length>3?` (+${d.length-3} more)`:"";s(`File too large (> ${Mt}MB): ${b.join(", ")}${j}`)}g.length>0&&n(g)},[s,n]);u.useEffect(()=>{const x=j=>{const N=j.dataTransfer;if(!N)return!1;try{if(N.types&&Array.from(N.types).includes("Files")||N.items&&Array.from(N.items).some(y=>y.kind==="file"))return!0}catch{}return N.files&&N.files.length>0},c=j=>{x(j)&&(j.preventDefault(),o.current+=1,a(!0))},d=j=>{x(j)&&j.preventDefault()},g=j=>{x(j)&&(o.current=Math.max(0,o.current-1),o.current===0&&a(!1))},b=j=>{var y;if(!x(j))return;j.preventDefault(),o.current=0,a(!1);const N=Array.from(((y=j.dataTransfer)==null?void 0:y.files)||[]);if(N.length!==0){if(!t){s("Select a group to attach files.");return}i(N)}};return window.addEventListener("dragenter",c,!0),window.addEventListener("dragover",d,!0),window.addEventListener("dragleave",g,!0),window.addEventListener("drop",b,!0),()=>{window.removeEventListener("dragenter",c,!0),window.removeEventListener("dragover",d,!0),window.removeEventListener("dragleave",g,!0),window.removeEventListener("drop",b,!0)}},[i,t,s]);const l=u.useCallback(()=>{o.current=0,a(!1)},[]);return{dropOverlayOpen:r,handleAppendComposerFiles:i,resetDragDrop:l,WEB_MAX_FILE_MB:Mt}}function rn(){const{selectedGroupId:t,groupDoc:s,setGroupDoc:n,refreshGroups:r,refreshActors:a}=Ce(),{setBusy:o,showError:i}=tt(),l=u.useCallback(async()=>{if(t){o("group-start");try{const d=await ks(t);if(!d.ok){i(`${d.error.code}: ${d.error.message}`);return}await a(),await r()}finally{o("")}}},[t,o,i,a,r]),x=u.useCallback(async()=>{if(t){o("group-stop");try{const d=await Fs(t);if(!d.ok){i(`${d.error.code}: ${d.error.message}`);return}await a(),await r()}finally{o("")}}},[t,o,i,a,r]),c=u.useCallback(async d=>{if(t){o("group-state");try{const g=await Us(t,d);g.ok?(n(s?{...s,state:d}:null),await r()):i(`${g.error.code}: ${g.error.message}`)}finally{o("")}}},[t,s,o,i,n,r]);return{handleStartGroup:l,handleStopGroup:x,handleSetGroupState:c}}function nn({tabs:t,activeTab:s,onTabChange:n,minSwipeDistance:r=50,swipeRatio:a=1.5}){const o=u.useRef(0),i=u.useRef(0),l=u.useCallback(c=>{o.current=c.touches[0].clientX,i.current=c.touches[0].clientY},[]),x=u.useCallback(c=>{const d=c.changedTouches[0].clientX,g=c.changedTouches[0].clientY,b=d-o.current,j=g-i.current;if(Math.abs(b)>r&&Math.abs(b)>Math.abs(j)*a){const N=t.indexOf(s);b>0&&N>0?n(t[N-1]):b<0&&N<t.length-1&&n(t[N+1])}},[t,s,n,r,a]);return{handleTouchStart:l,handleTouchEnd:x}}const an="modulepreload",ln=function(t){return"/ui/"+t},Wt={},on=function(s,n,r){let a=Promise.resolve();if(n&&n.length>0){let i=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),x=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=i(n.map(c=>{if(c=ln(c),c in Wt)return;Wt[c]=!0;const d=c.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${g}`))return;const b=document.createElement("link");if(b.rel=d?"stylesheet":an,d||(b.as="script"),b.crossOrigin="",b.href=c,x&&b.setAttribute("nonce",x),document.head.appendChild(b),d)return new Promise((j,N)=>{b.addEventListener("load",j),b.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return a.then(i=>{for(const l of i||[])l.status==="rejected"&&o(l.reason);return s().catch(o)})},cn=u.lazy(()=>on(()=>import("./chunk-AgentTab.js"),__vite__mapDeps([0,1,2])).then(t=>({default:t.AgentTab})));function dn({actor:t,groupId:s,termEpoch:n,busy:r,isDark:a,onToggleEnabled:o,onRelaunch:i,onEdit:l,onRemove:x,onInbox:c,onStatusChange:d}){return t?e.jsx(u.Suspense,{fallback:e.jsx("div",{className:`flex-1 flex items-center justify-center ${a?"text-slate-400":"text-gray-500"}`,children:"Loading agentâ€¦"}),children:e.jsx(cn,{actor:t,groupId:s,isVisible:!0,onQuit:o,onLaunch:o,onRelaunch:i,onEdit:l,onRemove:x,onInbox:c,busy:r,isDark:a,onStatusChange:d},`${s}:${t.id}:${n}`)}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-slate-500",children:"Agent not found"})}var xn=Zt();function Xe(t,s,n){let r=n.initialDeps??[],a,o=!0;function i(){var l,x,c;let d;n.key&&((l=n.debug)!=null&&l.call(n))&&(d=Date.now());const g=t();if(!(g.length!==r.length||g.some((N,y)=>r[y]!==N)))return a;r=g;let j;if(n.key&&((x=n.debug)!=null&&x.call(n))&&(j=Date.now()),a=s(...g),n.key&&((c=n.debug)!=null&&c.call(n))){const N=Math.round((Date.now()-d)*100)/100,y=Math.round((Date.now()-j)*100)/100,p=y/16,R=(v,f)=>{for(v=String(v);v.length<f;)v=" "+v;return v};console.info(`%câ± ${R(y,5)} /${R(N,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*p,120))}deg 100% 31%);`,n==null?void 0:n.key)}return n!=null&&n.onChange&&!(o&&n.skipInitialOnChange)&&n.onChange(a),o=!1,a}return i.updateDeps=l=>{r=l},i}function qt(t,s){if(t===void 0)throw new Error("Unexpected undefined");return t}const un=(t,s)=>Math.abs(t-s)<1.01,mn=(t,s,n)=>{let r;return function(...a){t.clearTimeout(r),r=t.setTimeout(()=>s.apply(this,a),n)}},Jt=t=>{const{offsetWidth:s,offsetHeight:n}=t;return{width:s,height:n}},hn=t=>t,gn=t=>{const s=Math.max(t.startIndex-t.overscan,0),n=Math.min(t.endIndex+t.overscan,t.count-1),r=[];for(let a=s;a<=n;a++)r.push(a);return r},bn=(t,s)=>{const n=t.scrollElement;if(!n)return;const r=t.targetWindow;if(!r)return;const a=i=>{const{width:l,height:x}=i;s({width:Math.round(l),height:Math.round(x)})};if(a(Jt(n)),!r.ResizeObserver)return()=>{};const o=new r.ResizeObserver(i=>{const l=()=>{const x=i[0];if(x!=null&&x.borderBoxSize){const c=x.borderBoxSize[0];if(c){a({width:c.inlineSize,height:c.blockSize});return}}a(Jt(n))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()});return o.observe(n,{box:"border-box"}),()=>{o.unobserve(n)}},Vt={passive:!0},Ht=typeof window>"u"?!0:"onscrollend"in window,pn=(t,s)=>{const n=t.scrollElement;if(!n)return;const r=t.targetWindow;if(!r)return;let a=0;const o=t.options.useScrollendEvent&&Ht?()=>{}:mn(r,()=>{s(a,!1)},t.options.isScrollingResetDelay),i=d=>()=>{const{horizontal:g,isRtl:b}=t.options;a=g?n.scrollLeft*(b&&-1||1):n.scrollTop,o(),s(a,d)},l=i(!0),x=i(!1);x(),n.addEventListener("scroll",l,Vt);const c=t.options.useScrollendEvent&&Ht;return c&&n.addEventListener("scrollend",x,Vt),()=>{n.removeEventListener("scroll",l),c&&n.removeEventListener("scrollend",x)}},fn=(t,s,n)=>{if(s!=null&&s.borderBoxSize){const r=s.borderBoxSize[0];if(r)return Math.round(r[n.options.horizontal?"inlineSize":"blockSize"])}return t[n.options.horizontal?"offsetWidth":"offsetHeight"]},yn=(t,{adjustments:s=0,behavior:n},r)=>{var a,o;const i=t+s;(o=(a=r.scrollElement)==null?void 0:a.scrollTo)==null||o.call(a,{[r.options.horizontal?"left":"top"]:i,behavior:n})};class vn{constructor(s){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let n=null;const r=()=>n||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:n=new this.targetWindow.ResizeObserver(a=>{a.forEach(o=>{const i=()=>{this._measureElement(o.target,o)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()})}));return{disconnect:()=>{var a;(a=r())==null||a.disconnect(),n=null},observe:a=>{var o;return(o=r())==null?void 0:o.observe(a,{box:"border-box"})},unobserve:a=>{var o;return(o=r())==null?void 0:o.unobserve(a)}}})(),this.range=null,this.setOptions=n=>{Object.entries(n).forEach(([r,a])=>{typeof a>"u"&&delete n[r]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:hn,rangeExtractor:gn,onChange:()=>{},measureElement:fn,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...n}},this.notify=n=>{var r,a;(a=(r=this.options).onChange)==null||a.call(r,this,n)},this.maybeNotify=Xe(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),n=>{this.notify(n)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(n=>n()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var n;const r=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==r){if(this.cleanup(),!r){this.maybeNotify();return}this.scrollElement=r,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((n=this.scrollElement)==null?void 0:n.window)??null,this.elementsCache.forEach(a=>{this.observer.observe(a)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,a=>{this.scrollRect=a,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(a,o)=>{this.scrollAdjustments=0,this.scrollDirection=o?this.getScrollOffset()<a?"forward":"backward":null,this.scrollOffset=a,this.isScrolling=o,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(n,r)=>{const a=new Map,o=new Map;for(let i=r-1;i>=0;i--){const l=n[i];if(a.has(l.lane))continue;const x=o.get(l.lane);if(x==null||l.end>x.end?o.set(l.lane,l):l.end<x.end&&a.set(l.lane,!0),a.size===this.options.lanes)break}return o.size===this.options.lanes?Array.from(o.values()).sort((i,l)=>i.end===l.end?i.index-l.index:i.end-l.end)[0]:void 0},this.getMeasurementOptions=Xe(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(n,r,a,o,i,l)=>(this.prevLanes!==void 0&&this.prevLanes!==l&&(this.lanesChangedFlag=!0),this.prevLanes=l,this.pendingMeasuredCacheIndexes=[],{count:n,paddingStart:r,scrollMargin:a,getItemKey:o,enabled:i,lanes:l}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=Xe(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:n,paddingStart:r,scrollMargin:a,getItemKey:o,enabled:i,lanes:l},x)=>{if(!i)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>n)for(const b of this.laneAssignments.keys())b>=n&&this.laneAssignments.delete(b);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(b=>{this.itemSizeCache.set(b.key,b.size)}));const c=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===n&&(this.lanesSettling=!1);const d=this.measurementsCache.slice(0,c),g=new Array(l).fill(void 0);for(let b=0;b<c;b++){const j=d[b];j&&(g[j.lane]=b)}for(let b=c;b<n;b++){const j=o(b),N=this.laneAssignments.get(b);let y,p;if(N!==void 0&&this.options.lanes>1){y=N;const S=g[y],B=S!==void 0?d[S]:void 0;p=B?B.end+this.options.gap:r+a}else{const S=this.options.lanes===1?d[b-1]:this.getFurthestMeasurement(d,b);p=S?S.end+this.options.gap:r+a,y=S?S.lane:b%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(b,y)}const R=x.get(j),v=typeof R=="number"?R:this.options.estimateSize(b),f=p+v;d[b]={index:b,start:p,size:v,end:f,key:j,lane:y},g[y]=b}return this.measurementsCache=d,d},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Xe(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(n,r,a,o)=>this.range=n.length>0&&r>0?jn({measurements:n,outerSize:r,scrollOffset:a,lanes:o}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Xe(()=>{let n=null,r=null;const a=this.calculateRange();return a&&(n=a.startIndex,r=a.endIndex),this.maybeNotify.updateDeps([this.isScrolling,n,r]),[this.options.rangeExtractor,this.options.overscan,this.options.count,n,r]},(n,r,a,o,i)=>o===null||i===null?[]:n({startIndex:o,endIndex:i,overscan:r,count:a}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=n=>{const r=this.options.indexAttribute,a=n.getAttribute(r);return a?parseInt(a,10):(console.warn(`Missing attribute name '${r}={index}' on measured element.`),-1)},this._measureElement=(n,r)=>{const a=this.indexFromElement(n),o=this.measurementsCache[a];if(!o)return;const i=o.key,l=this.elementsCache.get(i);l!==n&&(l&&this.observer.unobserve(l),this.observer.observe(n),this.elementsCache.set(i,n)),n.isConnected&&this.resizeItem(a,this.options.measureElement(n,r,this))},this.resizeItem=(n,r)=>{const a=this.measurementsCache[n];if(!a)return;const o=this.itemSizeCache.get(a.key)??a.size,i=r-o;i!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(a,i,this):a.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=i,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(a.index),this.itemSizeCache=new Map(this.itemSizeCache.set(a.key,r)),this.notify(!1))},this.measureElement=n=>{if(!n){this.elementsCache.forEach((r,a)=>{r.isConnected||(this.observer.unobserve(r),this.elementsCache.delete(a))});return}this._measureElement(n,void 0)},this.getVirtualItems=Xe(()=>[this.getVirtualIndexes(),this.getMeasurements()],(n,r)=>{const a=[];for(let o=0,i=n.length;o<i;o++){const l=n[o],x=r[l];a.push(x)}return a},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=n=>{const r=this.getMeasurements();if(r.length!==0)return qt(r[ws(0,r.length-1,a=>qt(r[a]).start,n)])},this.getOffsetForAlignment=(n,r,a=0)=>{const o=this.getSize(),i=this.getScrollOffset();r==="auto"&&(r=n>=i+o?"end":"start"),r==="center"?n+=(a-o)/2:r==="end"&&(n-=o);const l=this.getTotalSize()+this.options.scrollMargin-o;return Math.max(Math.min(l,n),0)},this.getOffsetForIndex=(n,r="auto")=>{n=Math.max(0,Math.min(n,this.options.count-1));const a=this.measurementsCache[n];if(!a)return;const o=this.getSize(),i=this.getScrollOffset();if(r==="auto")if(a.end>=i+o-this.options.scrollPaddingEnd)r="end";else if(a.start<=i+this.options.scrollPaddingStart)r="start";else return[i,r];const l=r==="end"?a.end+this.options.scrollPaddingEnd:a.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(l,r,a.size),r]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(n,{align:r="start",behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(n,r),{adjustments:void 0,behavior:a})},this.scrollToIndex=(n,{align:r="auto",behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),n=Math.max(0,Math.min(n,this.options.count-1));let o=0;const i=10,l=c=>{if(!this.targetWindow)return;const d=this.getOffsetForIndex(n,c);if(!d){console.warn("Failed to get offset for index:",n);return}const[g,b]=d;this._scrollToOffset(g,{adjustments:void 0,behavior:a}),this.targetWindow.requestAnimationFrame(()=>{const j=this.getScrollOffset(),N=this.getOffsetForIndex(n,b);if(!N){console.warn("Failed to get offset for index:",n);return}un(N[0],j)||x(b)})},x=c=>{this.targetWindow&&(o++,o<i?this.targetWindow.requestAnimationFrame(()=>l(c)):console.warn(`Failed to scroll to index ${n} after ${i} attempts.`))};l(r)},this.scrollBy=(n,{behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+n,{adjustments:void 0,behavior:r})},this.getTotalSize=()=>{var n;const r=this.getMeasurements();let a;if(r.length===0)a=this.options.paddingStart;else if(this.options.lanes===1)a=((n=r[r.length-1])==null?void 0:n.end)??0;else{const o=Array(this.options.lanes).fill(null);let i=r.length-1;for(;i>=0&&o.some(l=>l===null);){const l=r[i];o[l.lane]===null&&(o[l.lane]=l.end),i--}a=Math.max(...o.filter(l=>l!==null))}return Math.max(a-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(n,{adjustments:r,behavior:a})=>{this.options.scrollToFn(n,{behavior:a,adjustments:r},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(s)}}const ws=(t,s,n,r)=>{for(;t<=s;){const a=(t+s)/2|0,o=n(a);if(o<r)t=a+1;else if(o>r)s=a-1;else return a}return t>0?t-1:0};function jn({measurements:t,outerSize:s,scrollOffset:n,lanes:r}){const a=t.length-1,o=x=>t[x].start;if(t.length<=r)return{startIndex:0,endIndex:a};let i=ws(0,a,o,n),l=i;if(r===1)for(;l<a&&t[l].end<n+s;)l++;else if(r>1){const x=Array(r).fill(0);for(;l<a&&x.some(d=>d<n+s);){const d=t[l];x[d.lane]=d.end,l++}const c=Array(r).fill(n+s);for(;i>=0&&c.some(d=>d>=n);){const d=t[i];c[d.lane]=d.start,i--}i=Math.max(0,i-i%r),l=Math.min(a,l+(r-1-l%r))}return{startIndex:i,endIndex:l}}const Kt=typeof document<"u"?u.useLayoutEffect:u.useEffect;function Nn(t){const s=u.useReducer(()=>({}),{})[1],n={...t,onChange:(a,o)=>{var i;o?xn.flushSync(s):s(),(i=t.onChange)==null||i.call(t,a,o)}},[r]=u.useState(()=>new vn(n));return r.setOptions(n),Kt(()=>r._didMount(),[]),Kt(()=>r._willUpdate()),r}function wn(t){return Nn({observeElementRect:bn,observeElementOffset:pn,scrollToFn:yn,...t})}function Cn(t){return t.kind==="chat.message"&&t.data&&typeof t.data=="object"?String(t.data.text||""):""}const Sn=u.memo(function({event:s,actors:n,isDark:r,groupId:a,onReply:o,onShowRecipients:i}){const l=s.by==="user",x=l?null:Ir(String(s.by||""),r),c=s.data,d=c==null?void 0:c.quote_text,b=(Array.isArray(c==null?void 0:c.attachments)?c.attachments:[]).filter(f=>f!=null&&typeof f=="object").map(f=>({kind:String(f.kind||"file"),path:String(f.path||""),title:String(f.title||""),bytes:Number(f.bytes||0),mime_type:String(f.mime_type||"")})).filter(f=>f.path.startsWith("state/blobs/")),j=s._read_status,N=c==null?void 0:c.to,y=j?n.map(f=>String(f.id||"")).filter(f=>f&&Object.prototype.hasOwnProperty.call(j,f)).map(f=>[f,!!j[f]]):[],p=N&&N.length>0?N.join(", "):"@all",R=y.slice(0,3),v=Math.max(0,y.length-R.length);return e.jsxs("div",{className:m("flex gap-2 sm:gap-3 group",l?"flex-col items-end sm:items-start sm:flex-row-reverse":"flex-col items-start sm:flex-row"),children:[e.jsx("div",{className:m("hidden sm:flex flex-shrink-0 w-8 h-8 rounded-full items-center justify-center text-xs font-bold shadow-sm mt-1",l?"bg-gradient-to-br from-blue-500 to-blue-600 text-white":r?"bg-slate-700 text-slate-200":"bg-white border border-gray-200 text-gray-700",!l&&x?`ring-1 ring-inset ${x.ring}`:""),children:l?"U":(s.by||"?")[0].toUpperCase()}),e.jsxs("div",{className:m("flex flex-col w-full sm:w-auto sm:max-w-[75%]",l?"items-end":"items-start"),children:[e.jsxs("div",{className:m("flex items-center gap-2 mb-1 sm:hidden",l?"flex-row-reverse":"flex-row"),children:[e.jsx("div",{className:m("flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold shadow-sm",l?"bg-gradient-to-br from-blue-500 to-blue-600 text-white":r?"bg-slate-700 text-slate-200":"bg-white border border-gray-200 text-gray-700",!l&&x?`ring-1 ring-inset ${x.ring}`:""),children:l?"U":(s.by||"?")[0].toUpperCase()}),e.jsx("span",{className:m("text-xs font-medium",l?r?"text-slate-300":"text-gray-700":x?x.text:r?"text-slate-300":"text-gray-700"),children:s.by}),e.jsx("span",{className:`text-[10px] ${r?"text-slate-500":"text-gray-400"}`,children:pt(s.ts)})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 mb-1 px-1",children:[e.jsx("span",{className:m("text-[11px] font-medium",l?r?"text-slate-400":"text-gray-500":x?x.text:r?"text-slate-400":"text-gray-500"),children:s.by}),e.jsx("span",{className:`text-[10px] ${r?"text-slate-600":"text-gray-400"}`,children:pt(s.ts)})]}),e.jsxs("div",{className:m("relative px-4 py-2.5 shadow-sm text-sm leading-relaxed",l?"bg-blue-600 text-white rounded-2xl rounded-tr-none":r?"bg-slate-800 text-slate-200 border border-slate-700 rounded-2xl rounded-tl-none":"bg-white text-gray-800 border border-gray-200 rounded-2xl rounded-tl-none"),children:[d&&e.jsxs("div",{className:`mb-2 text-xs border-l-2 pl-2 italic truncate opacity-80 ${l?"border-blue-400":r?"border-slate-600":"border-gray-300"}`,children:['"',d,'"']}),e.jsx("div",{className:"whitespace-pre-wrap break-words",children:Cn(s)}),b.length>0&&a&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:b.map((f,S)=>{const B=f.path.split("/"),A=B[B.length-1]||"",z=`/api/v1/groups/${encodeURIComponent(a)}/blobs/${encodeURIComponent(A)}`,h=f.title||A||"file";return e.jsxs("a",{href:z,className:m("inline-flex items-center gap-2 rounded px-2 py-1.5 text-xs transition-colors max-w-full",l?"bg-blue-700/50 hover:bg-blue-700 text-white border border-blue-500":r?"bg-slate-900/50 hover:bg-slate-900 text-slate-300 border border-slate-700":"bg-gray-50 hover:bg-gray-100 text-gray-700 border border-gray-200"),title:`Download ${h}`,download:!0,children:[e.jsx("span",{className:"opacity-70",children:"ðŸ“Ž"}),e.jsx("span",{className:"truncate",children:h})]},`${A}:${S}`)})})]}),e.jsxs("div",{className:m("flex items-center justify-between gap-3 mt-1 px-1 text-[10px] transition-opacity","opacity-70 group-hover:opacity-100",r?"text-slate-500":"text-gray-500"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("button",{type:"button",className:m("touch-target-sm px-1 rounded hover:underline transition-colors",r?"text-slate-400 hover:text-slate-200":"text-gray-500 hover:text-gray-700"),onClick:o,children:"Reply"}),e.jsxs("span",{className:"min-w-0 truncate",title:`to ${p}`,children:["to ",p]})]}),y.length>0&&e.jsx("button",{type:"button",className:m("touch-target-sm flex items-center gap-2 min-w-0 rounded-lg px-2 py-1",r?"hover:bg-slate-800/60":"hover:bg-gray-100"),onClick:i,"aria-label":"Show recipient status",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[R.map(([f,S])=>e.jsxs("span",{className:"inline-flex items-center gap-1 min-w-0",children:[e.jsx("span",{className:"truncate max-w-[10ch]",children:f}),e.jsx("span",{className:m("text-[10px] font-semibold tracking-tight",S?r?"text-emerald-400":"text-emerald-600":r?"text-slate-500":"text-gray-500"),"aria-label":S?"read":"pending",children:S?"âœ“âœ“":"âœ“"})]},f)),v>0&&e.jsxs("span",{className:m("text-[10px]",r?"text-slate-500":"text-gray-500"),children:["+",v]})]})})]})]})]})},(t,s)=>t.event===s.event&&t.actors===s.actors&&t.isDark===s.isDark&&t.groupId===s.groupId),$n=u.memo(function({messages:s,actors:n,isDark:r,groupId:a,scrollRef:o,onReply:i,onShowRecipients:l,showScrollButton:x,onScrollButtonClick:c,chatUnreadCount:d,onScrollChange:g}){const b=u.useRef(null),j=u.useRef(s.length),N=u.useRef(!0),y=u.useRef(!1),p=u.useRef(null),R=wn({count:s.length,getScrollElement:()=>b.current,estimateSize:()=>120,overscan:5}),v=u.useCallback(()=>{const h=b.current;return h?h.scrollHeight-h.scrollTop-h.clientHeight<100:!0},[]),f=u.useCallback(()=>{const h=b.current;!h||s.length<=0||requestAnimationFrame(()=>{h.scrollTo({top:h.scrollHeight,behavior:"auto"})})},[s.length]),S=u.useCallback(()=>{const h=p.current;h!=null&&(p.current=null,window.clearTimeout(h))},[]),B=u.useCallback(h=>{S(),p.current=window.setTimeout(()=>{p.current=null,h()},0)},[S]),A=u.useCallback(h=>{B(()=>{h!=null&&h.requireAtBottom&&!N.current||f()})},[B,f]),z=u.useCallback(()=>{const h=v();N.current=h,g==null||g(h)},[v,g]);return u.useEffect(()=>{const h=j.current,_=s.length;j.current=_,_>h&&N.current&&A({requireAtBottom:!0})},[s.length,A]),u.useEffect(()=>{y.current||s.length<=0||(y.current=!0,A())},[s.length,A]),u.useEffect(()=>{j.current=0,N.current=!0,y.current=!1,S()},[a,S]),u.useEffect(()=>S,[S]),e.jsx("div",{ref:h=>{b.current=h,o&&(o.current=h)},className:"flex-1 min-h-0 overflow-auto px-4 py-4 relative",onScroll:s.length>0?z:void 0,role:"log","aria-label":"Chat messages",children:s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center pb-20 opacity-50",children:[e.jsx("div",{className:"text-4xl mb-4 grayscale",children:"ðŸ’¬"}),e.jsx("p",{className:`text-sm font-medium ${r?"text-slate-400":"text-gray-500"}`,children:"No messages yet"}),e.jsx("p",{className:`text-xs mt-1 ${r?"text-slate-600":"text-gray-400"}`,children:"Start the conversation with your AI team."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:`${R.getTotalSize()}px`,width:"100%",position:"relative",contain:"strict"},children:R.getVirtualItems().map(h=>{const _=s[h.index];return e.jsx("div",{"data-index":h.index,ref:R.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${h.start}px)`},className:"pb-6",children:e.jsx(Sn,{event:_,actors:n,isDark:r,groupId:a,onReply:()=>i(_),onShowRecipients:()=>{_.id&&l(String(_.id))}})},_.id||h.index)})}),x&&e.jsxs("button",{className:`fixed bottom-24 right-6 p-3 rounded-full shadow-xl transition-all z-10 ${r?"bg-slate-800 text-white hover:bg-slate-700 border border-slate-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-100"}`,onClick:()=>{f(),c()},"aria-label":"Scroll to bottom",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})}),d>0&&e.jsxs("span",{className:"absolute -top-1 -right-1 flex h-4 w-4",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-60"}),e.jsx("span",{className:"relative inline-flex rounded-full h-4 w-4 bg-indigo-500 text-[9px] text-white items-center justify-center font-bold",children:d>9?"!":d})]})]})]})})});async function Tn(t){try{await navigator.clipboard.writeText(t)}catch{window.prompt("Copy command:",t)}}function Yt({isDark:t,selectedGroupId:s,busy:n,needsScope:r,needsActors:a,needsStart:o,onAddAgent:i,onStartGroup:l,variant:x="compact"}){const c=x==="compact",d=`cccc attach . --group ${s}`;return!r&&!a&&!o?c?null:e.jsx("div",{className:m("text-xs mt-4",t?"text-slate-400":"text-gray-500"),children:"Team is ready. Say hi to your agents."}):e.jsxs("div",{className:m("space-y-2",c?"mt-3":"mt-4"),children:[r&&e.jsxs("div",{className:m("rounded-xl border px-3 py-2",c?t?"border-slate-700 bg-slate-900/60":"border-gray-200 bg-white":t?"rounded-2xl border-slate-700/50 bg-slate-900/40 p-4 text-left":"rounded-2xl border-gray-200 bg-white/70 p-4 text-left"),children:[e.jsx("div",{className:m("text-xs font-medium",t?"text-slate-200":"text-gray-800"),children:c?"Attach a project folder":""}),!c&&e.jsx("div",{className:"text-xs font-semibold",children:"Attach a project folder"}),e.jsxs("div",{className:m("flex items-center justify-between gap-2 text-[11px]",c?"mt-1":"mt-2",t?"text-slate-500":"text-gray-500"),children:[e.jsx("code",{className:m("truncate",t?"text-slate-300":"text-gray-700"),children:d}),e.jsx("button",{type:"button",className:m("flex-shrink-0 rounded-lg px-2 py-1 text-[11px] font-medium border",t?"border-slate-700 text-slate-300 hover:bg-slate-800":"border-gray-200 text-gray-700 hover:bg-gray-50"),onClick:()=>Tn(d),children:"Copy"})]})]}),a&&e.jsxs("div",{className:m(c?"flex items-center justify-between gap-3 rounded-xl border px-3 py-2":"rounded-2xl border p-4 text-left",t?c?"border-slate-700 bg-slate-900/60":"border-slate-700/50 bg-slate-900/40":c?"border-gray-200 bg-white":"border-gray-200 bg-white/70"),children:[e.jsxs("div",{className:c?"min-w-0":"",children:[e.jsx("div",{className:m("text-xs font-medium",t?"text-slate-200":"text-gray-800"),children:c?"Add an agent":""}),!c&&e.jsx("div",{className:"text-xs font-semibold",children:"Add an agent"}),e.jsx("div",{className:m(c?"text-[11px] truncate":"mt-1 text-[11px]",t?"text-slate-500":"text-gray-500"),children:"Add a foreman first, then peers."})]}),e.jsx("button",{type:"button",className:m("flex-shrink-0 font-semibold bg-blue-600 hover:bg-blue-500 text-white",c?"rounded-xl px-3 py-1.5 text-[11px]":"mt-3 w-full rounded-xl px-4 py-2 text-sm"),onClick:i,children:"Add Agent"})]}),o&&e.jsxs("div",{className:m(c?"flex items-center justify-between gap-3 rounded-xl border px-3 py-2":"rounded-2xl border p-4 text-left",t?c?"border-slate-700 bg-slate-900/60":"border-slate-700/50 bg-slate-900/40":c?"border-gray-200 bg-white":"border-gray-200 bg-white/70"),children:[e.jsxs("div",{className:c?"min-w-0":"",children:[e.jsx("div",{className:m("text-xs font-medium",t?"text-slate-200":"text-gray-800"),children:c?"Start the group":""}),!c&&e.jsx("div",{className:"text-xs font-semibold",children:"Start the group"}),e.jsx("div",{className:m(c?"text-[11px] truncate":"mt-1 text-[11px]",t?"text-slate-500":"text-gray-500"),children:"Launch your agents and begin chatting."})]}),e.jsx("button",{type:"button",className:m("flex-shrink-0 font-semibold bg-emerald-600 hover:bg-emerald-500 text-white",c?"rounded-xl px-3 py-1.5 text-[11px]":"mt-3 w-full rounded-xl px-4 py-2 text-sm",n==="group-start"?"opacity-60":""),onClick:l,disabled:n==="group-start",children:n==="group-start"?"Startingâ€¦":c?"Start":"Start Group"})]})]})}function Qt({isDark:t,isSmallScreen:s,selectedGroupId:n,actors:r,busy:a,replyTarget:o,onCancelReply:i,toTokens:l,onToggleRecipient:x,onClearRecipients:c,composerFiles:d,onRemoveComposerFile:g,appendComposerFiles:b,fileInputRef:j,composerRef:N,composerText:y,setComposerText:p,onSendMessage:R,showMentionMenu:v,setShowMentionMenu:f,mentionSuggestions:S,mentionSelectedIndex:B,setMentionSelectedIndex:A,setMentionFilter:z,onAppendRecipientToken:h}){const _=T=>{const E=T.clipboardData;if(!E)return;const P=[];try{const X=Array.from(E.items||[]);for(const ee of X){if(!ee||ee.kind!=="file")continue;const D=ee.getAsFile();D&&P.push(D)}}catch{}if(P.length===0)try{P.push(...Array.from(E.files||[]))}catch{}if(P.length===0||!n)return;const V=new Set,H=[];for(const X of P){const ee=`${X.name}:${X.size}:${X.type}`;V.has(ee)||(V.add(ee),H.push(X))}H.length!==0&&(T.preventDefault(),b(H))},L=T=>{const E=T.target.value;p(E);const P=T.target;requestAnimationFrame(()=>{P.style.height="auto",P.style.height=Math.min(P.scrollHeight,140)+"px"});const V=E.lastIndexOf("@");if(V>=0){const H=E.slice(V+1);(V===0||E[V-1]===" "||E[V-1]===`
`)&&!H.includes(" ")&&!H.includes(`
`)?(z(H),f(!0),A(0)):f(!1)}else f(!1)},C=T=>{if(v&&S.length>0){const E=Math.min(S.length,8)-1;if(T.key==="ArrowDown"){T.preventDefault(),A(P=>P>=E?0:P+1);return}if(T.key==="ArrowUp"){T.preventDefault(),A(P=>P<=0?E:P-1);return}if(T.key==="Enter"||T.key==="Tab"){T.preventDefault(),F(S[B]);return}if(T.key==="Escape"){T.preventDefault(),f(!1),A(0);return}}T.key==="Enter"&&!v?(T.ctrlKey||T.metaKey)&&(T.preventDefault(),R()):T.key==="Escape"&&(f(!1),i())},F=T=>{if(!T)return;const E=y.lastIndexOf("@");if(E>=0){const P=y.slice(0,E);p(P+T+" ")}l.includes(T)||h(T),f(!1),A(0)},q=y.trim()||d.length>0;return e.jsxs("footer",{className:m("flex-shrink-0 border-t px-4 py-3 safe-area-inset-bottom",t?"border-slate-800 bg-slate-950/80 backdrop-blur":"border-gray-200 bg-white/80 backdrop-blur"),children:[o&&e.jsxs("div",{className:m("mb-2 flex items-center gap-2 text-xs rounded-xl px-3 py-2",t?"text-slate-400 bg-slate-900/50":"text-gray-500 bg-gray-100"),children:[e.jsx("span",{className:t?"text-slate-500":"text-gray-400",children:"Replying to"}),e.jsx("span",{className:m("font-medium",t?"text-slate-300":"text-gray-700"),children:o.by}),e.jsxs("span",{className:m("truncate flex-1",t?"text-slate-500":"text-gray-400"),children:['"',o.text,'"']}),e.jsx("button",{className:m("p-1 rounded-full",t?"hover:bg-slate-800 text-slate-400 hover:text-slate-200":"hover:bg-gray-200 text-gray-400 hover:text-gray-600"),onClick:i,title:"Cancel reply","aria-label":"Cancel reply",children:"Ã—"})]}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("div",{className:m("text-xs font-medium flex-shrink-0",t?"text-slate-500":"text-gray-400"),children:"To"}),e.jsx("div",{className:"flex-1 min-w-0 overflow-x-auto scrollbar-hide sm:overflow-visible",children:e.jsx("div",{className:"flex items-center gap-1.5 flex-nowrap sm:flex-wrap",children:["@all","@foreman","@peers",...r.map(T=>String(T.id||""))].map(T=>{const E=T.trim();if(!E)return null;const P=l.includes(E);return e.jsx("button",{className:m("flex-shrink-0 whitespace-nowrap text-[11px] px-2.5 py-1 rounded-full border transition-all",P?"bg-emerald-600 text-white border-emerald-500 shadow-sm":t?"bg-slate-900 text-slate-400 border-slate-800 hover:border-slate-600 hover:text-slate-200":"bg-white text-gray-600 border-gray-200 hover:border-gray-300 hover:text-gray-800"),onClick:()=>x(E),disabled:!n||a==="send",title:P?"Remove recipient":"Add recipient","aria-pressed":P,children:E},E)})})}),l.length>0&&e.jsx("button",{className:m("flex-shrink-0 text-[10px] px-2 py-1 rounded-full transition-colors",t?"text-slate-500 hover:text-slate-300 hover:bg-slate-800":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"),onClick:c,disabled:a==="send",title:"Clear recipients",children:"clear"})]}),d.length>0&&e.jsx("div",{className:m("mb-3 flex flex-wrap gap-2",t?"text-slate-300":"text-gray-700"),children:d.map((T,E)=>e.jsxs("span",{className:m("inline-flex items-center gap-2 rounded-lg border px-2.5 py-1.5 text-xs max-w-full shadow-sm",t?"border-slate-700 bg-slate-900":"border-gray-200 bg-white"),title:T.name,children:[e.jsx("span",{className:"truncate",children:T.name}),e.jsx("button",{className:m("flex-shrink-0 p-0.5 rounded-full",t?"text-slate-400 hover:text-white hover:bg-slate-700":"text-slate-400 hover:text-gray-700 hover:bg-gray-100"),onClick:()=>g(E),title:"Remove file",children:"Ã—"})]},`${T.name}:${E}`))}),e.jsxs("div",{className:"flex gap-2 relative items-end",children:[e.jsx("input",{ref:j,type:"file",multiple:!0,className:"hidden",onChange:T=>{const E=Array.from(T.target.files||[]);E.length>0&&b(E),T.target.value=""}}),e.jsx("button",{className:m("rounded-full p-2.5 text-lg transition-colors flex-shrink-0 shadow-sm border",t?"bg-slate-800 border-slate-700 text-slate-400 hover:text-slate-200 hover:bg-slate-700 hover:border-slate-600":"bg-white border-gray-200 text-gray-400 hover:text-gray-600 hover:bg-gray-50 hover:border-gray-300"),onClick:()=>{var T;return(T=j.current)==null?void 0:T.click()},disabled:!n||a==="send",title:"Attach file",children:"ðŸ“Ž"}),e.jsx("textarea",{ref:N,className:m("w-full rounded-3xl border px-4 py-3 text-sm resize-none min-h-[48px] max-h-[140px] transition-all focus:ring-2 focus:ring-offset-1",t?"bg-slate-900 border-slate-700 text-slate-200 placeholder-slate-500 focus:border-blue-500/50 focus:ring-blue-500/20 focus:ring-offset-slate-900":"bg-white border-gray-200 text-gray-900 placeholder-gray-400 focus:border-blue-400 focus:ring-blue-100 focus:ring-offset-white"),placeholder:s?"Messageâ€¦":"Messageâ€¦ (@ to mention, Ctrl+Enter to send)",rows:1,value:y,onPaste:_,onChange:L,onKeyDown:C,onBlur:()=>setTimeout(()=>f(!1),150),"aria-label":"Message input"}),v&&S.length>0&&e.jsx("div",{className:m("absolute bottom-full left-0 mb-2 w-56 max-h-48 overflow-auto rounded-xl border shadow-xl z-20",t?"border-slate-700 bg-slate-900":"border-gray-200 bg-white"),role:"listbox","aria-label":"Mention suggestions",children:S.slice(0,8).map((T,E)=>e.jsx("button",{className:m("w-full text-left px-4 py-2.5 text-sm transition-colors",t?"text-slate-200":"text-gray-700",E===B?t?"bg-slate-800":"bg-blue-50 text-blue-700":t?"hover:bg-slate-800":"hover:bg-gray-50"),onMouseDown:P=>{var V;P.preventDefault(),F(T),(V=N.current)==null||V.focus()},onMouseEnter:()=>A(E),children:T},T))}),e.jsx("button",{className:m("rounded-full px-5 py-2.5 text-sm font-semibold disabled:opacity-50 min-h-[48px] shadow-sm transition-all flex items-center justify-center",a==="send"||!q?t?"bg-slate-800 text-slate-500":"bg-gray-100 text-gray-400":"bg-blue-600 hover:bg-blue-500 text-white shadow-blue-500/20"),onClick:R,disabled:a==="send"||!q,"aria-label":"Send message",children:a==="send"?e.jsx("span",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):"Send"})]})]})}function En({isDark:t,isSmallScreen:s,selectedGroupId:n,actors:r,busy:a,showSetupCard:o,needsScope:i,needsActors:l,needsStart:x,onAddAgent:c,onStartGroup:d,chatMessages:g,scrollRef:b,showScrollButton:j,chatUnreadCount:N,onScrollButtonClick:y,onScrollChange:p,onReply:R,onShowRecipients:v,replyTarget:f,onCancelReply:S,toTokens:B,onToggleRecipient:A,onClearRecipients:z,composerFiles:h,onRemoveComposerFile:_,appendComposerFiles:L,fileInputRef:C,composerRef:F,composerText:q,setComposerText:T,onSendMessage:E,showMentionMenu:P,setShowMentionMenu:V,mentionSuggestions:H,mentionSelectedIndex:X,setMentionSelectedIndex:ee,setMentionFilter:D,onAppendRecipientToken:ie}){return g.length===0&&o?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:b,className:"flex-1 min-h-0 overflow-auto px-4 py-4 relative",role:"log","aria-label":"Chat messages",children:e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center pb-20",children:e.jsxs("div",{className:m("w-full max-w-md",t?"text-slate-200":"text-gray-800"),children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ§­"}),e.jsx("div",{className:m("text-sm font-semibold",t?"text-slate-200":"text-gray-800"),children:"Next steps"}),e.jsx(Yt,{isDark:t,selectedGroupId:n,busy:a,needsScope:i,needsActors:l,needsStart:x,onAddAgent:c,onStartGroup:d,variant:"full"})]})})}),e.jsx(Qt,{isDark:t,isSmallScreen:s,selectedGroupId:n,actors:r,busy:a,replyTarget:f,onCancelReply:S,toTokens:B,onToggleRecipient:A,onClearRecipients:z,composerFiles:h,onRemoveComposerFile:_,appendComposerFiles:L,fileInputRef:C,composerRef:F,composerText:q,setComposerText:T,onSendMessage:E,showMentionMenu:P,setShowMentionMenu:V,mentionSuggestions:H,mentionSelectedIndex:X,setMentionSelectedIndex:ee,setMentionFilter:D,onAppendRecipientToken:ie})]}):e.jsxs(e.Fragment,{children:[o&&g.length>0&&e.jsx("div",{className:"flex-shrink-0 px-4 pt-4",children:e.jsxs("div",{className:m("rounded-2xl border p-4 sm:p-5",t?"border-slate-700/50 bg-slate-900/40":"border-gray-200 bg-white/70"),role:"region","aria-label":"Setup checklist",children:[e.jsx("div",{className:m("text-sm font-semibold",t?"text-slate-200":"text-gray-800"),children:"Next steps"}),e.jsx(Yt,{isDark:t,selectedGroupId:n,busy:a,needsScope:i,needsActors:l,needsStart:x,onAddAgent:c,onStartGroup:d,variant:"compact"})]})}),e.jsx($n,{messages:g,actors:r,isDark:t,groupId:n||"",scrollRef:b,onReply:R,onShowRecipients:v,showScrollButton:j,onScrollButtonClick:y,chatUnreadCount:N,onScrollChange:p}),e.jsx(Qt,{isDark:t,isSmallScreen:s,selectedGroupId:n,actors:r,busy:a,replyTarget:f,onCancelReply:S,toTokens:B,onToggleRecipient:A,onClearRecipients:z,composerFiles:h,onRemoveComposerFile:_,appendComposerFiles:L,fileInputRef:C,composerRef:F,composerText:q,setComposerText:T,onSendMessage:E,showMentionMenu:P,setShowMentionMenu:V,mentionSuggestions:H,mentionSelectedIndex:X,setMentionSelectedIndex:ee,setMentionFilter:D,onAppendRecipientToken:ie})]})}function An(t){if(!t)return"";const s=String(t.active_scope_key||"");if(!s)return"";const r=(Array.isArray(t.scopes)?t.scopes:[]).find(a=>String(a.scope_key||"")===s);return String((r==null?void 0:r.url)||"")}function _n(){const{theme:t,setTheme:s,isDark:n}=Dr(),{groups:r,selectedGroupId:a,groupDoc:o,events:i,actors:l,setSelectedGroupId:x,refreshGroups:c,refreshActors:d,loadGroup:g}=Ce(),{busy:b,errorMsg:j,isTransitioning:N,sidebarOpen:y,activeTab:p,showScrollButton:R,chatUnreadCount:v,isSmallScreen:f,setBusy:S,showError:B,dismissError:A,setSidebarOpen:z,setActiveTab:h,setShowScrollButton:_,setChatUnreadCount:L,setSmallScreen:C}=tt(),{recipientsEventId:F,openModal:q,setRecipientsModal:T}=Ot(),{composerText:E,composerFiles:P,toText:V,replyTarget:H,setComposerText:X,setComposerFiles:ee,setToText:D,setReplyTarget:ie,clearComposer:ge}=ps(),{setNewActorRole:ce,setEditGroupTitle:Se,setEditGroupTopic:me,setDirSuggestions:$e}=ys(),{getTermEpoch:w,toggleActorEnabled:se,relaunchActor:de,editActor:Ge,removeActor:ae,openActorInbox:be}=en(a),We=u.useRef(null),pe=u.useRef(null),Te=u.useRef(null),qe=u.useRef(null),Ee=u.useRef("chat"),ve=u.useRef(!0),Ae=u.useRef([]),[Ie,le]=we.useState(!1),[fe,Pe]=we.useState(""),[Je,Ve]=we.useState(0),{connectStream:st,fetchContext:Be,scheduleActorWarmupRefresh:rt,cleanup:nt}=tn({activeTabRef:Ee,chatAtBottomRef:ve,actorsRef:Ae}),{dropOverlayOpen:at,handleAppendComposerFiles:_e,resetDragDrop:lt,WEB_MAX_FILE_MB:Re}=sn({selectedGroupId:a}),{handleStartGroup:ke,handleStopGroup:Le,handleSetGroupState:je}=rn(),ot=u.useMemo(()=>["chat",...l.map($=>$.id)],[l]),Fe=we.useCallback($=>{h($)},[h]),{handleTouchStart:it,handleTouchEnd:ct}=nn({tabs:ot,activeTab:p,onTabChange:Fe});u.useEffect(()=>{if(Ee.current=p,p!=="chat")return;const $=Te.current;if(!$)return;const W=$.scrollHeight-$.scrollTop-$.clientHeight<100;ve.current=W,_(!W),W&&L(0)},[p,L,_]),u.useEffect(()=>{Ae.current=l},[l]),u.useEffect(()=>{const $=window.matchMedia("(max-width: 639px)"),K=()=>C($.matches);return K(),$.addEventListener("change",K),()=>$.removeEventListener("change",K)},[C]);const Me=u.useMemo(()=>An(o),[o]),Ue=u.useMemo(()=>l.some($=>$.role==="foreman"),[l]),oe=u.useMemo(()=>r.find($=>String($.group_id||"")===a)||null,[r,a]),He=(oe==null?void 0:oe.running)??!1,Ne=u.useMemo(()=>{const $=new Set(["@all","@foreman","@peers"]);for(const K of l){const W=String(K.id||"").trim();W&&$.add(W)}return $},[l]),he=u.useMemo(()=>{const K=V.split(",").map(J=>J.trim()).filter(J=>J.length>0).filter(J=>J!=="user"&&J!=="@user"&&J!=="@"),W=[],Z=new Set;for(const J of K)Ne.has(J)&&(Z.has(J)||(Z.add(J),W.push(J)));return W},[V,Ne]),Ke=u.useMemo(()=>{const $=["@all","@foreman","@peers"],K=l.map(J=>String(J.id||"")).filter(J=>J),W=[...$,...K];if(!fe)return W;const Z=fe.toLowerCase();return W.filter(J=>J.toLowerCase().includes(Z))},[l,fe]),te=u.useMemo(()=>p==="chat"?null:l.find($=>$.id===p)||null,[p,l]);u.useEffect(()=>{if(ge(),pe.current&&(pe.current.value=""),lt(),!!a)return g(a),st(a),rt(a),()=>{nt()}},[a]),u.useEffect(()=>{c(),dt(),Ye();const $=window.setInterval(c,5e3);return()=>window.clearInterval($)},[]);async function dt(){const $=await er();$.ok&&Ce.getState().setRuntimes($.result.runtimes||[])}async function Ye(){const $=await tr();$.ok&&$e($.result.suggestions||[])}function M($){const K=$.trim();if(!K)return;const W=he,Z=W.findIndex(J=>J===K);if(Z>=0){const J=W.slice(0,Z).concat(W.slice(Z+1));D(J.join(", "))}else D(W.concat([K]).join(", "))}async function k(){const $=E.trim();if(a&&!(!$&&P.length===0)){S("send");try{const K=he;let W;if(H){const Z=String(H.by||"").trim(),J=Z&&Z!=="user"&&Z!=="unknown"?[Z]:["@all"],O=K.length?K:J;W=await Ds(a,$,O,H.eventId,P.length>0?P:void 0)}else W=await Zs(a,$,K,P.length>0?P:void 0);if(!W.ok){B(`${W.error.code}: ${W.error.message}`);return}ge(),pe.current&&(pe.current.value="")}finally{S("")}}}function G($){if(!$.id||$.kind!=="chat.message")return;const K=$.data,W=K!=null&&K.text?String(K.text):"";ie({eventId:String($.id),by:String($.by||"unknown"),text:W.slice(0,100)+(W.length>100?"...":"")})}const re=()=>{ve.current=!0,_(!1),L(0)},xe=u.useMemo(()=>F&&i.find($=>$.kind==="chat.message"&&String($.id||"")===F)||null,[i,F]),Qe=u.useMemo(()=>{if(!xe)return null;const $=xe.data,W=($&&Array.isArray($.to)?$.to:[]).map(Q=>String(Q||"").trim()).filter(Q=>Q.length>0),Z=W.length>0?W.join(", "):"@all",J=xe._read_status&&typeof xe._read_status=="object"?xe._read_status:null,O=J?Object.keys(J):Ns(xe,l),U=new Set(O),Y=l.map(Q=>String(Q.id||"")).filter(Q=>Q&&U.has(Q)).map(Q=>[Q,!!(J&&J[Q])]);return{toLabel:Z,entries:Y}},[l,xe]),jt=i.filter($=>$.kind==="chat.message"),mt=!!a&&!Me,ht=!!a&&l.length===0,gt=!!a&&l.length>0&&!He,Nt=mt||ht||gt;return e.jsxs("div",{className:`h-full w-full relative overflow-hidden ${n?"bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950":"bg-gradient-to-br from-slate-50 via-white to-slate-100"}`,children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:`absolute -top-32 -left-32 w-96 h-96 rounded-full liquid-blob ${n?"bg-gradient-to-br from-cyan-500/20 via-cyan-600/10 to-transparent":"bg-gradient-to-br from-cyan-400/25 via-cyan-500/15 to-transparent"}`,style:{filter:"blur(60px)"}}),e.jsx("div",{className:`absolute top-1/4 -right-24 w-80 h-80 rounded-full liquid-blob ${n?"bg-gradient-to-bl from-purple-500/15 via-indigo-600/10 to-transparent":"bg-gradient-to-bl from-purple-400/20 via-indigo-500/10 to-transparent"}`,style:{filter:"blur(50px)",animationDelay:"-3s"}}),e.jsx("div",{className:`absolute -bottom-20 left-1/3 w-72 h-72 rounded-full liquid-blob ${n?"bg-gradient-to-tr from-blue-500/12 via-sky-600/8 to-transparent":"bg-gradient-to-tr from-blue-400/15 via-sky-500/10 to-transparent"}`,style:{filter:"blur(45px)",animationDelay:"-5s"}})]}),e.jsx("div",{className:"pointer-events-none absolute inset-0 opacity-[0.015]",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E")`}}),e.jsxs("div",{className:"relative h-full grid grid-cols-1 md:grid-cols-[280px_1fr] transition-all duration-300",children:[e.jsx(Yr,{groups:r,selectedGroupId:a,isOpen:y,isDark:n,onSelectGroup:$=>x($),onCreateGroup:()=>{q("createGroup"),Ye()},onClose:()=>z(!1)}),e.jsxs("main",{className:`h-full flex flex-col overflow-hidden backdrop-blur-sm ${n?"bg-slate-950/40":"bg-white/60"}`,children:[e.jsx(Kr,{isDark:n,theme:t,onThemeChange:s,selectedGroupId:a,groupDoc:o,selectedGroupRunning:He,actors:l,busy:b,errorMsg:j,onDismissError:A,onOpenSidebar:()=>z(!0),onOpenGroupEdit:()=>{o&&(Se(o.title||""),me(o.topic||""),q("groupEdit"))},onOpenContext:()=>{a&&Be(a),q("context")},onStartGroup:ke,onStopGroup:Le,onSetGroupState:je,onOpenSettings:()=>q("settings"),onOpenMobileMenu:()=>q("mobileMenu")}),a&&e.jsx(_s,{actors:l,activeTab:p,onTabChange:Fe,unreadChatCount:v,isDark:n,onAddAgent:()=>{ce(Ue?"peer":"foreman"),q("addActor")},canAddAgent:!!a}),e.jsxs("div",{ref:qe,className:`relative flex-1 min-h-0 flex flex-col overflow-hidden transition-opacity duration-150 ${N?"opacity-0":"opacity-100"}`,onTouchStart:it,onTouchEnd:ct,children:[e.jsx("div",{className:`absolute inset-0 flex min-h-0 flex-col ${p==="chat"?"":"invisible pointer-events-none"}`,"aria-hidden":p!=="chat",children:e.jsx(En,{isDark:n,isSmallScreen:f,selectedGroupId:a,actors:l,busy:b,showSetupCard:Nt,needsScope:mt,needsActors:ht,needsStart:gt,hasForeman:Ue,onAddAgent:()=>{ce(Ue?"peer":"foreman"),q("addActor")},onStartGroup:ke,chatMessages:jt,scrollRef:Te,showScrollButton:R,chatUnreadCount:v,onScrollButtonClick:re,onScrollChange:$=>{ve.current=$,_(!$),$&&L(0)},onReply:G,onShowRecipients:$=>T($),replyTarget:H,onCancelReply:()=>ie(null),toTokens:he,onToggleRecipient:M,onClearRecipients:()=>D(""),composerFiles:P,onRemoveComposerFile:$=>ee(P.filter((K,W)=>W!==$)),appendComposerFiles:_e,fileInputRef:pe,composerRef:We,composerText:E,setComposerText:X,onSendMessage:k,showMentionMenu:Ie,setShowMentionMenu:le,mentionSuggestions:Ke,mentionSelectedIndex:Je,setMentionSelectedIndex:Ve,setMentionFilter:Pe,onAppendRecipientToken:$=>D(V?V+", "+$:$)})}),p!=="chat"&&e.jsx("div",{className:"absolute inset-0 flex min-h-0 flex-col",children:e.jsx(dn,{actor:te,groupId:a,termEpoch:te?w(te.id):0,busy:b,isDark:n,onToggleEnabled:()=>te&&se(te),onRelaunch:()=>te&&de(te),onEdit:()=>te&&Ge(te),onRemove:()=>te&&ae(te,p),onInbox:()=>te&&be(te),onStatusChange:()=>void d()})})]})]})]}),e.jsx(Vr,{isDark:n,composerRef:We,messageMeta:Qe,onStartReply:G,onThemeToggle:()=>s(n?"light":"dark"),onStartGroup:ke,onStopGroup:Le,onSetGroupState:je,fetchContext:Be}),e.jsx(Rs,{isOpen:at,isDark:n,maxFileMb:Re})]})}As.createRoot(document.getElementById("root")).render(e.jsx(we.StrictMode,{children:e.jsx(_n,{})}));export{cs as E,Mn as I,Lt as P,ut as R,os as S,Lr as T,Bn as a,Tr as b,m as c,On as d,In as e,Pn as g,e as j,u as r};
